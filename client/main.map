{"version":3,"sources":["keycodes.js","tts.js","soundObject.js","scrollingText.js","strings.js","soundSource.js","soundHandler.js","utilities.js","input.js","menuItem.js","menu.js","menuHandler.js","oldtimer.js","timer.js","game.js","stateMachine.js","main.js"],"names":["KeyEvent","DOM_VK_CANCEL","DOM_VK_HELP","DOM_VK_BACK_SPACE","DOM_VK_TAB","DOM_VK_CLEAR","DOM_VK_RETURN","DOM_VK_ENTER","DOM_VK_SHIFT","DOM_VK_CONTROL","DOM_VK_ALT","DOM_VK_PAUSE","DOM_VK_CAPS_LOCK","DOM_VK_ESCAPE","DOM_VK_SPACE","DOM_VK_PAGE_UP","DOM_VK_PAGE_DOWN","DOM_VK_END","DOM_VK_HOME","DOM_VK_LEFT","DOM_VK_UP","DOM_VK_RIGHT","DOM_VK_DOWN","DOM_VK_PRINTSCREEN","DOM_VK_INSERT","DOM_VK_DELETE","DOM_VK_0","DOM_VK_1","DOM_VK_2","DOM_VK_3","DOM_VK_4","DOM_VK_5","DOM_VK_6","DOM_VK_7","DOM_VK_8","DOM_VK_9","DOM_VK_SEMICOLON","DOM_VK_EQUALS","DOM_VK_A","DOM_VK_B","DOM_VK_C","DOM_VK_D","DOM_VK_E","DOM_VK_F","DOM_VK_G","DOM_VK_H","DOM_VK_I","DOM_VK_J","DOM_VK_K","DOM_VK_L","DOM_VK_M","DOM_VK_N","DOM_VK_O","DOM_VK_P","DOM_VK_Q","DOM_VK_R","DOM_VK_S","DOM_VK_T","DOM_VK_U","DOM_VK_V","DOM_VK_W","DOM_VK_X","DOM_VK_Y","DOM_VK_Z","DOM_VK_CONTEXT_MENU","DOM_VK_NUMPAD0","DOM_VK_NUMPAD1","DOM_VK_NUMPAD2","DOM_VK_NUMPAD3","DOM_VK_NUMPAD4","DOM_VK_NUMPAD5","DOM_VK_NUMPAD6","DOM_VK_NUMPAD7","DOM_VK_NUMPAD8","DOM_VK_NUMPAD9","DOM_VK_MULTIPLY","DOM_VK_ADD","DOM_VK_SEPARATOR","DOM_VK_SUBTRACT","DOM_VK_DECIMAL","DOM_VK_DIVIDE","DOM_VK_F1","DOM_VK_F2","DOM_VK_F3","DOM_VK_F4","DOM_VK_F5","DOM_VK_F6","DOM_VK_F7","DOM_VK_F8","DOM_VK_F9","DOM_VK_F10","DOM_VK_F11","DOM_VK_F12","DOM_VK_F13","DOM_VK_F14","DOM_VK_F15","DOM_VK_F16","DOM_VK_F17","DOM_VK_F18","DOM_VK_F19","DOM_VK_F20","DOM_VK_F21","DOM_VK_F22","DOM_VK_F23","DOM_VK_F24","DOM_VK_NUM_LOCK","DOM_VK_SCROLL_LOCK","DOM_VK_COMMA","DOM_VK_PERIOD","DOM_VK_SLASH","DOM_VK_BACK_QUOTE","DOM_VK_OPEN_BRACKET","DOM_VK_BACK_SLASH","DOM_VK_CLOSE_BRACKET","DOM_VK_QUOTE","DOM_VK_META","useWebTTS","TTS","constructor","webTTS","synth","window","speechSynthesis","speak","text","utterThis","SpeechSynthesisUtterance","stop","document","getElementById","innerHTML","para","createElement","appendChild","createTextNode","setWebTTS","tts","speech","isElectron","playOnceTimer","SoundObjectItem","file","callback","tag","that","onMemory","fileName","sound","src","onload","doneLoading","timeout","setTimeout","checkProgress","loaded","timeToLoad","performance","now","state","clearTimeout","play","pause","destroy","unload","volume","v","loop","playing","playbackRate","rate","currentTime","seek","duration","position","time","SoundObject","sounds","Array","oneShots","debug","loadingQueue","queueCallback","loadedSounds","loadingSounds","loadedCallback","queue","queueLength","statusCallback","extension","directory","oneShotSound","setStatusCallback","findSound","i","findSoundIndex","resetQueuedInstance","length","splice","create","returnObject","push","enqueue","loadQueue","handleQueue","setQueueCallback","resetQueue","console","log","setCallback","result","isLoading","loading","stillLoading","playOnce","so","toDestroy","on","oneShotSounds","noMore","filename","found","kill","runningText","undefined","ScrollingText","delimiter","splitText","split","currentLine","sndOpen","sndContinue","sndClose","id","init","addEventListener","handleKeys","readCurrentLine","event","which","advance","handleTap","action","removeEventListener","Strings","strings","get","lang","what","SoundSource","x","y","z","pan","setPosition","speed","minRate","maxRate","rateShiftSpeed","currentPosition","pos","update","setDoppler","z1","direction","freq","setSpeed","SoundHandler","directional","staticSounds","dynamicSounds","currentDynamicSound","maxDynamicSounds","currentStaticSound","maxStaticSounds","reuseSounds","playStatic","slot","findFreeStaticSlot","SoundItem","findFreeDynamicSlot","findDynamicSound","reuse","threeD","GameUtils","distance3D","x1","y1","x2","y2","z2","Math","sqrt","distance","jx","jy","kx","ky","calculateAngle","angle","atan2","PI","isCollide3D","a","b","width","height","depth","randomInt","min","max","floor","random","getRandomArbitrary","sleep","ms","Promise","resolve","percent","int1","int2","utils","KeyboardInput","keyDown","justPressed","justReleased","justPressedEventCallback","handleKeyDown","handleKeyUp","isDown","isJustPressed","isJustReleased","keysDown","kd","forEach","keysPressed","keysReleased","MenuTypes","NORMAL","SELECTOR","SLIDER","EDIT","MenuItem","name","type","select","SelectorItem","options","defaultOption","selectCallback","currentOption","increase","decrease","SliderItem","from","to","currentValue","minValue","maxValue","EditItem","defaultText","addChar","char","removeChar","substring","Menu","menuData","music","cursor","sndKeyChar","sndKeyDelete","sndSliderLeft","sndSliderRight","sndBoundary","sndChoose","sndMove","sndSelector","sndWrap","nextItem","previousItem","insertCharacter","String","fromCharCode","removeCharacter","handleInput","destroySounds","fade","off","run","handleSwipe","selected","items","addItem","value","toReturn","mainMenu","fs","require","existsSync","s","setState","OldTimer","elapsed","paused","lastTime","pauseWhen","started","isActive","reset","resume","Game","canPause","actionCompleted","scoreTimer","pauseTime","timer","score","pool","bpms","level","fileData","input","levels","setup","readFileSync","error","pack","actions","keys","dt","render","setupLevel","queueLevels","currentAction","fail","numberOfActions","snd","failsound","quit","calculateScore","preSound","change","unpause","start","bpm","good","timev","remscore","ceil","levelLimit","StateMachine","currentState","intro","once","keydown","st","learnPack","browsePacks","rebuildHashes","actionKeys","mangle","langs","packdir","homedir","proceed","browsing","packs","JSON","parse","decrypt","err","browseArray","browsePosition","toRemove","exitNow","size","filesSync","pb","pf","stat","hash","preview","corrupts","newHash","dirsSync","next","theFiles","path","levelsa","temp","write","stringify","encrypt","writeFileSync"],"mappings":"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","file":"main.map","sourcesContent":["\r\n'use strict';\r\nif (typeof KeyEvent == \"undefined\") {\r\n    var KeyEvent = {\r\n        DOM_VK_CANCEL: 3,\r\n        DOM_VK_HELP: 6,\r\n        DOM_VK_BACK_SPACE: 8,\r\n        DOM_VK_TAB: 9,\r\n        DOM_VK_CLEAR: 12,\r\n        DOM_VK_RETURN: 13,\r\n        DOM_VK_ENTER: 14,\r\n        DOM_VK_SHIFT: 16,\r\n        DOM_VK_CONTROL: 17,\r\n        DOM_VK_ALT: 18,\r\n        DOM_VK_PAUSE: 19,\r\n        DOM_VK_CAPS_LOCK: 20,\r\n        DOM_VK_ESCAPE: 27,\r\n        DOM_VK_SPACE: 32,\r\n        DOM_VK_PAGE_UP: 33,\r\n        DOM_VK_PAGE_DOWN: 34,\r\n        DOM_VK_END: 35,\r\n        DOM_VK_HOME: 36,\r\n        DOM_VK_LEFT: 37,\r\n        DOM_VK_UP: 38,\r\n        DOM_VK_RIGHT: 39,\r\n        DOM_VK_DOWN: 40,\r\n        DOM_VK_PRINTSCREEN: 44,\r\n        DOM_VK_INSERT: 45,\r\n        DOM_VK_DELETE: 46,\r\n        DOM_VK_0: 48,\r\n        DOM_VK_1: 49,\r\n        DOM_VK_2: 50,\r\n        DOM_VK_3: 51,\r\n        DOM_VK_4: 52,\r\n        DOM_VK_5: 53,\r\n        DOM_VK_6: 54,\r\n        DOM_VK_7: 55,\r\n        DOM_VK_8: 56,\r\n        DOM_VK_9: 57,\r\n        DOM_VK_SEMICOLON: 59,\r\n        DOM_VK_EQUALS: 61,\r\n        DOM_VK_A: 65,\r\n        DOM_VK_B: 66,\r\n        DOM_VK_C: 67,\r\n        DOM_VK_D: 68,\r\n        DOM_VK_E: 69,\r\n        DOM_VK_F: 70,\r\n        DOM_VK_G: 71,\r\n        DOM_VK_H: 72,\r\n        DOM_VK_I: 73,\r\n        DOM_VK_J: 74,\r\n        DOM_VK_K: 75,\r\n        DOM_VK_L: 76,\r\n        DOM_VK_M: 77,\r\n        DOM_VK_N: 78,\r\n        DOM_VK_O: 79,\r\n        DOM_VK_P: 80,\r\n        DOM_VK_Q: 81,\r\n        DOM_VK_R: 82,\r\n        DOM_VK_S: 83,\r\n        DOM_VK_T: 84,\r\n        DOM_VK_U: 85,\r\n        DOM_VK_V: 86,\r\n        DOM_VK_W: 87,\r\n        DOM_VK_X: 88,\r\n        DOM_VK_Y: 89,\r\n        DOM_VK_Z: 90,\r\n        DOM_VK_CONTEXT_MENU: 93,\r\n        DOM_VK_NUMPAD0: 96,\r\n        DOM_VK_NUMPAD1: 97,\r\n        DOM_VK_NUMPAD2: 98,\r\n        DOM_VK_NUMPAD3: 99,\r\n        DOM_VK_NUMPAD4: 100,\r\n        DOM_VK_NUMPAD5: 101,\r\n        DOM_VK_NUMPAD6: 102,\r\n        DOM_VK_NUMPAD7: 103,\r\n        DOM_VK_NUMPAD8: 104,\r\n        DOM_VK_NUMPAD9: 105,\r\n        DOM_VK_MULTIPLY: 106,\r\n        DOM_VK_ADD: 107,\r\n        DOM_VK_SEPARATOR: 108,\r\n        DOM_VK_SUBTRACT: 109,\r\n        DOM_VK_DECIMAL: 110,\r\n        DOM_VK_DIVIDE: 111,\r\n        DOM_VK_F1: 112,\r\n        DOM_VK_F2: 113,\r\n        DOM_VK_F3: 114,\r\n        DOM_VK_F4: 115,\r\n        DOM_VK_F5: 116,\r\n        DOM_VK_F6: 117,\r\n        DOM_VK_F7: 118,\r\n        DOM_VK_F8: 119,\r\n        DOM_VK_F9: 120,\r\n        DOM_VK_F10: 121,\r\n        DOM_VK_F11: 122,\r\n        DOM_VK_F12: 123,\r\n        DOM_VK_F13: 124,\r\n        DOM_VK_F14: 125,\r\n        DOM_VK_F15: 126,\r\n        DOM_VK_F16: 127,\r\n        DOM_VK_F17: 128,\r\n        DOM_VK_F18: 129,\r\n        DOM_VK_F19: 130,\r\n        DOM_VK_F20: 131,\r\n        DOM_VK_F21: 132,\r\n        DOM_VK_F22: 133,\r\n        DOM_VK_F23: 134,\r\n        DOM_VK_F24: 135,\r\n        DOM_VK_NUM_LOCK: 144,\r\n        DOM_VK_SCROLL_LOCK: 145,\r\n        DOM_VK_COMMA: 188,\r\n        DOM_VK_PERIOD: 190,\r\n        DOM_VK_SLASH: 191,\r\n        DOM_VK_BACK_QUOTE: 192,\r\n        DOM_VK_OPEN_BRACKET: 219,\r\n        DOM_VK_BACK_SLASH: 220,\r\n        DOM_VK_CLOSE_BRACKET: 221,\r\n        DOM_VK_QUOTE: 222,\r\n        DOM_VK_META: 224\r\n    };\r\n\r\n\r\n\r\n}\r\nexport { KeyEvent }","'use strict';\r\nvar useWebTTS = true;\r\n\r\nclass TTS {\r\n\tconstructor(webTTS=false) {\r\n\t\tthis.synth = window.speechSynthesis;\r\n\t\tthis.webTTS = webTTS;\r\n\t\t\r\n\t}\r\n\t\r\n\tspeak(text) {\r\n\t\t\r\n\t\tif (this.webTTS) {\r\n\t\t\tvar utterThis = new SpeechSynthesisUtterance(text);\r\n\t\t\tthis.synth.stop();\r\n\t\t\tthis.synth.speak(utterThis);\r\n\t\t} else {\r\n\t\t\tdocument.getElementById(\"speech\").innerHTML = \"\"\r\n\t\t\tvar para = document.createElement(\"p\")\r\n\t\t\tpara.appendChild(document.createTextNode(text))\r\n\t\t\tdocument.getElementById(\"speech\").appendChild(para)\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t} // end speak()\r\n\t\r\n\tsetWebTTS(tts) {\r\n\t\tthis.webTTS = tts;\r\n\t}\r\n\t\r\n} // end class\r\nif (typeof speech == \"undefined\") var speech = new TTS();\r\nexport {TTS,speech}","import {Howl,Howler} from 'howler';\r\nimport {speech} from './tts';\r\n\r\nvar isElectron = true;\r\nvar playOnceTimer;\r\nclass SoundObjectItem {\r\n\tconstructor(file, callback=0, tag=0) {\r\n\t\tvar that = this;\r\n\t\t\t\tthis.onMemory=0;\r\n\t\t\t\tthis.fileName = file;\r\nthis.sound=new Howl({\r\nsrc: file,\r\nonload: function() { that.doneLoading()\r\n},\r\n});\r\n\t\t\t\tthis.timeout = setTimeout(function() { that.checkProgress();}, 2000);\r\n\t\tthis.loaded = false;\r\n\t\tthis.callback = callback;\r\n\t\tthis.timeToLoad = performance.now();\r\n\t\tthis.tag = tag;\r\n\t}\r\n\tcheckProgress() {\r\n\t\t\tif (this.sound.state() == \"loaded\") {\r\n\t\t\tthis.doneLoading();\r\n\t\t} else {\r\n\t\t\tvar that = this;\r\n\t\t\tthis.timeout = setTimeout(function() { that.checkProgress();}, 500);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\tdoneLoading() {\r\n\t\t\tclearTimeout(this.timeout);\r\n\t\tthis.loaded = true;\r\n\t\tif (this.callback!=0) {\r\n\t\t\tthis.callback();\r\n\t\t}\r\n\t}\r\n\tplay() {\r\n\t\tthis.sound.play();\r\n\t}\r\n\tstop() {\r\n\t\tthis.sound.stop();\r\n\t}\r\n\t\tpause() {\r\n\t\tthis.sound.pause();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tspeech.speak(\"yay\");\r\n\t\t\tthis.sound.unload();\r\n\t\t\t}\r\n\tunload() {\r\n\t\tthis.sound.unload();\r\n\t\t\t}\r\n\tget volume() {\r\n\treturn this.sound.volume();\r\n\t}\r\n\tset volume(v) {\r\n\treturn this.sound.volume(v);\r\n\t}\r\n\tset loop(v) {\r\n\treturn this.sound.loop(v);\r\n\t}\r\nget loop() {\r\n\treturn this.sound.loop();\r\n\t}\r\nget playing() {\r\n\treturn this.sound.playing();\r\n\t}\r\n\t\r\n\tget playbackRate() {\r\n\treturn this.sound.rate();\r\n\t}\r\n\tset playbackRate(v) {\r\n\treturn this.sound.rate(v);\r\n\t}\r\n\tget currentTime() {\r\n\treturn this.sound.seek();\r\n\t}\r\n\tget duration() {\r\n\treturn this.sound.duration;\r\n\t}\r\n\tget position() {\r\n\treturn this.sound.seek();\r\n\t}\r\n\t\r\n\tset currentTime(v) {\r\n\treturn this.sound.seek(v);\r\n\t}\r\n\tseek(time) {\r\n\treturn this.sound.seek(time);\r\n\t}\r\n}\r\nclass SoundObject {\r\n\tconstructor() {\r\n\t\tthis.sounds = new Array();\r\n\t\tthis.oneShots=new Array();\r\n\t\tthis.debug=false;\r\n\t\tthis.loadingQueue = false;\r\n\t\tthis.queueCallback = 0;\r\n\t\tthis.loadedSounds = 0;\r\n\t\tthis.loadingSounds = 0;\r\n\t\tthis.loadedCallback = 0;\r\n\t\tthis.queue = new Array();\r\n\t\tthis.queueLength = 0;\r\n\t\tthis.statusCallback = null;\r\n\t\t\r\n\t\tthis.extension = \".ogg\";\r\n\t\tif (isElectron == true) {\r\n\t\t\tthis.directory = \"./sounds/\";\r\n\t\t} else {\r\n\t\t\tthis.directory = \"../soundsopus/\";\r\n\t\t\t\tthis.extension=\".opus\";\r\n\t\t\t\t\t}\r\n\t\t\r\n\t\tthis.oneShotSound = null;\r\n\t}\r\n\tsetStatusCallback(callback) {\r\n\t\tthis.statusCallback = callback;\r\n\t}\r\n\tfindSound(file) {\r\n\t\tfor (var i in this.sounds) {\r\n\t\t\tif (this.sounds[i].fileName == file) {\r\n\t\t\t\treturn this.sounds[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n\tfindSoundIndex(file) {\r\n\t\tfor (var i in this.sounds) {\r\n\t\t\t\r\n\t\t\tif (this.sounds[i].fileName == file) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tresetQueuedInstance() {\r\n\t\tfor (var i=0;i<this.sounds.length;i++) {\r\n\t\t\tif (typeof this.sounds[i] != \"undefined\") {\r\n\t\t\t\tif (this.sounds[i].tag == 1) {\r\n\t\t\t\t\t\t\t\t\tthis.sounds[i].sound.unload();\r\n\t\t\t\t\tthis.sounds.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.loadingQueue = false;\r\n\t\tthis.queueCallback = 0;\r\n\t\tthis.loadedSounds = 0;\r\n\t\tthis.loadingSounds = 0;\r\n\t\tthis.loadedCallback = 0;\r\n\t\tthis.queue = new Array();\r\n\t\tthis.queueLength = 0;\r\n\t\tthis.statusCallback = null;\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\tcreate(file) {\r\n\t\tfile = this.directory + file + this.extension;\r\n\t\t\t\tvar returnObject = null;\r\n\t\t\tvar that = this;\r\n\t\t\treturnObject = new SoundObjectItem(file, function() { that.doneLoading(); });\r\n\t\t\t\t\t\t\t\tthis.sounds.push(returnObject);\r\n\t\t\t\t\treturn returnObject;\r\n\t}\r\n\t\r\n\tenqueue(file) {\r\n\t\t\r\n\t\tfile = this.directory + file + this.extension;\r\n\t\tthis.queue.push(file);\r\n\t\tthis.queueLength = this.queue.length;\r\n\t\t\r\n\t}\r\n\t\r\n\tloadQueue() {\r\n\t\t\r\n\t\t\tthis.handleQueue();\r\n\t\t\tthis.loadingQueue = true;\r\n\t\t\r\n\t}\r\n\tsetQueueCallback(callback) {\r\n\t\tthis.queueCallback = callback;\r\n\t}\r\n\tresetQueue() {\r\n\t\tthis.queue = new Array();\r\n\t\tthis.loadingQueue = false;\r\n\t}\r\n\thandleQueue() {\r\n\t\t\r\n\t\t\r\n\t\tif (this.queue.length > 0) {\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tvar that = this;\r\n\t\t\tif (typeof this.statusCallback != \"undefined\" && this.statusCallback!=null) {\r\n\t\t\t\tthis.statusCallback(1-this.queue.length/this.queueLength);\r\n\t\t\t}\r\n\t\t\tif (this.findSound(this.queue[0])!=-1) {\r\n\t\t\t\tthis.queue.splice(0, 1);\r\n\t\t\t\tthis.handleQueue();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.sounds.push(new SoundObjectItem(this.queue[0], function() { that.handleQueue(); }, 1));\r\n\t\t\tthis.queue.splice(0, 1);\r\n\t\t} else {\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tthis.loadingQueue = false;\r\n\t\t\t\tconsole.log(\"finished with queue.\");\r\n\t\t\t\tif (typeof this.queueCallback != \"undefined\" && this.queueCallback != 0) {\r\n\t\t\t\t\tthis.queueCallback();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\r\n\t}\r\n\tsetCallback(callback) {\r\n\t\tthis.loadedCallback = callback;\r\n\t}\r\n\tdoneLoading() {\r\n\t\tvar result = this.isLoading();\r\n\t\t\r\n\t\tif (result == 1) {\r\n\t\t\t\r\n\t\t\tif (typeof this.loadedCallback != \"undefined\" && this.loadedCallback != 0 && this.loadedCallback != null) {\r\n\t\t\t\tthis.loadedCallback();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tisLoading() {\r\n\t\tvar loading = 0;\r\n\t\tthis.loadedSounds = 0;\r\n\t\tthis.loadingSounds= 0;\r\n\t\tvar stillLoading = new Array();\r\n\t\tfor (var i=0;i<this.sounds.length;i++) {\r\n\t\t\tif (typeof this.sounds[i] != \"undefined\") {\r\n\t\t\t\tif (this.sounds[i].loaded == false) {\r\n\t\t\t\t\tthis.loadingSounds++;\r\n\t\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.loadedSounds++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn this.loadedSounds/this.sounds.length;\r\n\t}\r\n\t\r\n\tplayOnce(file) {\r\n\t\tthis.oneShotSound = so.create(file);\r\n\t\tthis.oneShots.push(this.oneShotSound);\r\n\t\tthis.oneShotSound.play();\r\n\t\tvar toDestroy=new Array();\r\n\t\tvar that = this;\r\n\t\tthis.oneShotSound.on(\"ended\", function() {\r\n\t\t\tfor (var i=0;i<that.oneShots.length;i++) {\r\n\t\t\t\tif (that.oneShots[i].playing==false) {\r\nthat.oneShots[i].unload();\r\ntoDestroy.push(i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (var i=0;i<toDestroy.length;i++) {\r\nif (that.oneShotSounds[i].playing==false) {\r\n\t\t\t\tthat.oneShotSounds.splice(toDestroy[i],1);\r\n\t\t\t\t\t\t\t\t\tspeech.speak(\"destroyed.\"+toDestroy[i]);\r\n}\r\n\t\t\t}\r\n\t\t });\r\n\t\t\r\n\t}\r\n\tdestroy(file,callback=0) {\r\n\t\tvar noMore=false;\r\n\t\t\t\tvar filename = this.directory + file + this.extension;\r\n\t\t\t\twhile (!noMore) {\r\n\t\t\t\t\t\t\tvar found = this.findSoundIndex(filename);\r\n\t\t\t\t\t\t\tconsole.log(\"found \"+found);\r\nif (found == -1) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tnoMore=true;\r\n}\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\t\tthis.sounds[found].sound.unload();\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"state after destroy\"+this.sounds[found].sound.state());\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.sounds.splice(found,1);\r\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"destroyed \"+this.sounds.length);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (callback!=0) callback();\r\n\t}\r\n\tkill(callback=0) {\r\n\t\t\t\twhile (this.sounds.length>0) {\r\n\t\t\t\t\tthis.sounds.splice(0,1);\r\n\t\t\t\t}\r\n\t\t\t\tHowler.unload();\r\n\t\t\t\tif (callback!=0) callback();\r\n\t}\r\n\r\n}\r\nlet so = new SoundObject();\r\nexport { so }","'use strict';\r\nimport $ from 'jquery'\r\nimport {KeyEvent} from './keycodes'\r\nimport {so} from './soundObject'\r\nimport {TTS,useWebTTS} from './tts'\r\nif (typeof speech == \"undefined\") var speech = new TTS();\r\nif (runningText == undefined) var runningText = 0;\r\nclass ScrollingText {\r\n\tconstructor(text, delimiter=\"\\n\", callback=0) {\r\n\t\tthis.text = text;\r\n\t\tthis.delimiter = delimiter;\r\n\t\tthis.splitText = this.text.split(delimiter);\r\n\t\tthis.currentLine=0;\r\n\t\tthis.sndOpen = so.create(\"UI/textOpen\");\r\n\t\tthis.sndContinue = so.create(\"UI/textScroll\");\r\n\t\tthis.sndClose = so.create(\"UI/textClose\");\r\n\t\tthis.callback = callback;\r\n\t\tvar id = document.getElementById(\"touchArea\");\r\n\t\t//this.hammer = new Hammer(id);\r\n\t\tthis.init();\r\n\t}\r\n\tinit() {\r\n\t\tvar that = this;\r\n\t\trunningText = this;\r\n\t\tdocument.addEventListener(\"keydown\", this.handleKeys);\r\n\t\t//this.hammer.on(\"swipeleft swiperight\", function() { that.handleTap(0); });\r\n\t\t//this.hammer.on(\"tap\", function() { that.handleTap(1); });\r\n\t\tthis.sndOpen.play();\r\n\t\tthis.currentLine = 0;\r\n\t\tthis.readCurrentLine();\r\n\t}\r\n\thandleKeys(event) {\r\n\t\tswitch(event.which) {\r\n\t\t\tcase KeyEvent.DOM_VK_UP:\r\n\t\t\tcase KeyEvent.DOM_VK_DOWN:\r\n\t\t\tcase KeyEvent.DOM_VK_LEFT:\r\n\t\t\tcase KeyEvent.DOM_VK_RIGHT:\r\n\t\t\t\trunningText.readCurrentLine();\r\n\t\t\t\tbreak;\r\n\t\t\tcase KeyEvent.DOM_VK_RETURN:\r\n\t\t\t\trunningText.advance();\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t}\r\n\t}\r\n\t\r\n\thandleTap(action) {\r\n\t\tif (action == 0) {\r\n\t\t\tthis.readCurrentLine();\r\n\t\t}\r\n\t\t\r\n\t\tif (action == 1) {\r\n\t\t\tthis.advance();\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\treadCurrentLine() {\r\n\t\tspeech.speak(this.splitText[this.currentLine]);\r\n\t}\r\n\tadvance() {\r\n\t\tif (this.currentLine < this.splitText.length-1) {\r\n\t\t\tthis.currentLine++;\r\n\t\t\tthis.sndContinue.play();\r\n\t\t\tthis.readCurrentLine();\r\n\t\t} else {\r\n\t\t\tthis.sndClose.play();\r\n\t\t\tthis.sndClose.unload();\r\n\t\t\tthis.sndOpen.unload();\r\n\t\t\tthis.sndContinue.unload();\r\ndocument.removeEventListener(\"keydown\", this.handleKeys);\r\n//\t\t\tthis.hammer.unload();\r\n\t\t\tif (this.callback!=0) this.callback();\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t}\r\n}\r\nexport {ScrollingText,speech}","'use strict';\r\nclass Strings {\r\nconstructor() {\r\nthis.strings={};\r\nthis.strings[1]={\r\n\"mStart\":\"Start Game\",\r\n\"mLearn\":\"Learn the pack\",\r\n\"tamperWarning\":\"This pack has been tampered with and is no longer unlocked. Press enter to continue.\",\r\n\"mNew\":\"Get new packs\",\r\n\"mBrowse\":\"Browse downloaded packs\",\r\n\"mHashes\":\"Rebuild packs folder\",\r\n}\r\n}\r\nget(lang,what) {\r\nreturn this.strings[lang][what];\r\n}\r\n}\r\nexport var strings=new Strings();","'use strict';\r\nimport { so } from './soundObject.js'\r\n\r\nclass SoundSource {\r\n\tconstructor(file, x=0, y=0, z=0, loop = true) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.z = z;\r\n\t\tthis.loop = loop;\r\n\t\tthis.sound = so.create(file);\r\n\t\t//this.pan = this.sound.effects.add(sono.panner());\r\n\t\tthis.sound.loop = loop;\r\n\t\tthis.pan.setPosition(this.x, this.y, this.z);\r\n\t\tthis.rate = 1;\r\n\t\tthis.speed = 0;\r\n\t\tthis.minRate = 0.8;\r\n\t\tthis.maxRate = 1.2;\r\n\t\tthis.toDestroy=false;\r\n\t\tthis.rateShiftSpeed = 0.015;\r\n\t\t// this.sound.currentPosition = getRandomArbitrary(0, this.sound.duration);\r\n\t\tthis.sound.currentPosition = 0;\r\n\t}\r\n\t\r\n\tplay() {\r\n\t\tthis.sound.seek(0);\r\n\t\tthis.sound.play();\r\n\t}\r\n\t\r\n\tpos(x, y, z) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.z = z;\r\n\t\tthis.pan.setPosition(this.x, this.y, this.z);\r\n\t}\r\n\t\r\n\tupdate() {\r\n\t\t\r\n\t}\r\n\t\r\n\tsetDoppler(z1, speed, direction) {\r\n\t\t\r\n\t\tif (speed >= 0) {\r\n\t\t\tif (direction == -1) {\r\n\t\t\t\tspeed = speed+this.speed;\r\n\t\t\t\t// this.rate = 1+Math.sin(((speed/10000)*(this.z-z1)));\r\n\t\t\t\tvar freq = 44100 *(1-(speed/240))\r\n\t\t\t\tthis.rate = freq/44100\r\n\t\t\t} else {\r\n\t\t\t\tspeed = speed+this.speed;\r\n\t\t\t\t// this.rate = 1-Math.sin(((speed/10000)*(z1-this.z)));\r\n\t\t\t\tvar freq = 44100 /(1-(speed/240))\r\n\t\t\t\tthis.rate = freq/44100\r\n\t\t\t}\r\n\t\t\r\n\t\t} else {\r\n\t\t\tthis.rate = 1;\r\n\t\t}\r\n\t\t\r\n\t\t// if (this.rate > this.maxRate) this.rate = this.maxRate;\r\n\t\t// if (this.rate < this.minRate) this.rate = this.minRate;\r\n\t\t// this.sound.playbackRate = this.rate;\r\n\t\tif (this.rate > this.sound.playbackRate+this.rateShiftSpeed) {\r\n\t\t\tthis.sound.playbackRate += this.rateShiftSpeed;\r\n\t\t} else if (this.rate < this.sound.playbackRate-this.rateShiftSpeed) {\r\n\t\t\tthis.sound.playbackRate -= this.rateShiftSpeed;\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\tsetSpeed(speed) {\r\n\t\tthis.speed = speed;\r\n\t}\r\n\tdestroy() {\r\n\t\tthis.sound.destroy();\r\n\t\tthis.toDestroy=true;\r\n\t}\r\n}\r\n\r\nexport {SoundSource}","import { SoundSource } from './soundSource.js'\r\nimport { so } from './soundObject.js'\r\nclass SoundHandler {\r\n\tconstructor(directional=false) {\r\n\t\tthis.staticSounds = []\r\n\t\tthis.dynamicSounds = []\r\n\t\tthis.currentDynamicSound = 0\r\n\t\tthis.maxDynamicSounds = 512;\r\n\t\tthis.currentStaticSound = 0;\r\n\t\tthis.maxStaticSounds = 512;\r\n\t\tthis.reuseSounds = true;\r\n\t\tthis.x = 0;\r\n\t\tthis.y = 0;\r\n\t\tthis.z = 0;\r\n\t\tthis.directional = directional;\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tplayStatic(file, loop = 1, slot = -1) {\r\n\t\tif (slot = -1) {\r\n\t\t\tslot = this.findFreeStaticSlot();\r\n\t\t}\r\n\t\tthis.staticSounds[slot] = new SoundItem(file, this.directional);\r\n\t\tif (loop == 1) {\r\n\t\t\tthis.staticSounds[slot].sound.loop = true;\r\n\t\t}\r\n\t\tthis.staticSounds[slot].sound.play();\r\n\t\tconsole.log(\"slot \"+slot);\r\n\t\treturn slot;\r\n\t}\r\n\tfindFreeStaticSlot() {\r\n\t\tfor (let i = 0;i<this.maxStaticSounds;i++) {\r\n\t\t\tif (this.staticSounds[i] == -1 || typeof this.staticSounds[i] == \"undefined\") {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.currentStaticSound < this.maxStaticSounds) {\r\n\t\t\tthis.currentStaticSound++;\r\n\t\t\treturn this.currentStaticSound;\r\n\t\t} else {\r\n\t\t\tthis.currentStaticSound = 0;\r\n\t\t\treturn this.currentStaticSound;\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tfindFreeDynamicSlot() {\r\n\t\tfor (let i = 0;i<this.maxDynamicSounds;i++) {\r\n\t\t\tif (this.dynamicSounds[i] == -1 || typeof this.dynamicSounds[i] == \"undefined\") {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.currentDynamicSound < this.maxDynamicSounds) {\r\n\t\t\tthis.currentDynamicSound++;\r\n\t\t\treturn this.currentDynamicSound;\r\n\t\t} else {\r\n\t\t\tthis.currentDynamicSound = 0;\r\n\t\t\treturn this.currentDynamicSound;\r\n\t\t}\r\n\t}\r\n\t\r\n\tfindDynamicSound(file) {\r\n\t\tfor (let i=0;i<this.dynamicSounds.length;i++) {\r\n\t\t\tif (this.dynamicSounds[i].file == file) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t\tplay(file) {\r\n\t\t\tlet slot = 0, reuse = 0;\r\n\t\tif (this.reuseSounds) {\r\n\t\t\tslot = this.findDynamicSound(file);\r\n\t\t\treuse = true;\r\n\t\t}\r\n\t\tif (slot == -1 || this.reuseSounds == false) {\r\n\t\t\tslot = this.findFreeDynamicSlot();\r\n\t\t\treuse = false;\r\n\t\t}\r\n\t\tif (typeof this.dynamicSounds[slot] == \"undefined\") {\r\n\t\t\tif (reuse == false) {\r\n\t\t\t\tthis.dynamicSounds[slot] = new SoundItem(file, this.directional);\r\n\t\t\t\tconsole.log(\"Created sound\");\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (reuse == false) {\r\n\t\t\t\tthis.dynamicSounds[slot].sound.destroy();\r\n\t\t\t\tthis.dynamicSounds[slot] = new SoundItem(file, directional);\r\n\t\t\t\tconsole.log(\"Destroyed and reloaded\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t\tconsole.log(\"playing sound\");\r\n\t\tthis.dynamicSounds[slot].sound.play();\r\n\t}\r\n\t\t\r\n\tupdate(position) {\r\n\t\tif (this.directional == true) {\r\n\t\t\tfor (let i=0;i<this.dynamicSounds.length;i++) {\r\n\t\t\t\tthis.dynamicSounds[i].sound.pos(position.x, position.y, position.z);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tdestroy() {\r\n\tfor (var i=0;i<this.dynamicSounds.length;i++) {\r\n\tconsole.log(\"destroying\"+i);\r\n\tthis.dynamicSounds[i].destroy();\r\n\tthis.dynamicSounds.splice(i,1);\r\n\t}\r\n\t\r\n\tfor (var i=0;i<this.staticSounds.length;i++) {\r\n\tthis.staticSounds[i].destroy();\r\n\tconsole.log(\"destroying\"+i);\r\n\tthis.staticSounds.splice(i,1);\r\n\t}\r\n\t}\r\n}\r\nclass SoundItem {\r\n\tconstructor(file, threeD=false) {\r\n\t\tthis.file = file;\r\n\t\tthis.threeD = threeD;\r\n\t\tif (this.threeD == true) {\r\n\t\t\tthis.sound = new SoundSource(file, 0, 0, 0);\r\n\t\t} else {\r\n\t\t\r\n\t\t\tthis.sound = so.create(file);\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t}\r\n\tdestroy() {\r\n\tthis.sound.destroy();\r\n\t}\r\n}\r\n\r\nexport { SoundHandler }","'use strict';\r\nclass GameUtils {\r\ndistance3D(x1, y1, z1, x2, y2, z2) {\r\n\treturn Math.sqrt((x2-x1)*(x2-x1) + \r\n(y2-y1)*(y2-y1) + \r\n(z2-z1)*(z2-z1));\r\n}\r\ndistance(jx, jy, kx, ky) {\r\n\t//return Math.hypot(jx-kx, jy-ky)\r\n\treturn Math.sqrt(((jx - kx) * (jx - kx)) + ((jy - ky)) * (jy - ky))\r\n}\r\n\r\ncalculateAngle(x1, y1, x2, y2) {\r\n\tvar angle = Math.atan2((y2-y1), (x2-x1));\r\n\tangle = (angle >= 0) ? 0 : (2*Math.PI) + angle;\r\n\treturn angle;\r\n\t// return Math.atan2((y2 - y1),(x2 - x1));\r\n}\r\nisCollide3D(a, b)\r\n{\r\n\treturn(a.x <= (b.x+b.width) && (a.x+a.width) >= b.x)&&(a.y <= (b.y+b.height) && (a.y+a.height) >= b.y)&&(a.z <= (b.z+b.depth) && (a.z+a.depth) >= b.z);\r\n}\r\nrandomInt(min, max) {\r\n    return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\ngetRandomArbitrary(min, max) {\r\nreturn Math.random() * (max - min) + min;\r\n  }\r\nsleep(ms) {\r\n\treturn new Promise(resolve => setTimeout(resolve, ms));\r\n}\r\npercent(int1,int2) {\r\nreturn int1*100/int2;\r\n}\r\n}\r\nexport var utils=new GameUtils();","import $ from \"jquery\";\r\n'use strict';\r\nclass KeyboardInput {\r\n\tconstructor() {\r\n\t\tthis.keyDown = [];\r\n\t\tthis.justPressed = [];\r\n\t\tthis.justReleased = [];\r\n\t\tthis.justPressedEventCallback = null;\r\n\t}\r\n\t\r\n\tinit() {\r\n\t\tvar that = this;\r\n// \t\t$(document).keydown(function(event) { that.handleKeyDown(event); });\r\n// \t\t$(document).keyup(function(event) { that.handleKeyUp(event); });\r\n\t\tdocument.addEventListener(\"keydown\", function(event) { that.handleKeyDown(event); });\r\n\t\tdocument.addEventListener(\"keyup\", function(event) { that.handleKeyUp(event); });\r\n\t\t\t}\r\n\t\r\n\thandleKeyDown(event) {\r\n\t\t\r\n\t\tif (this.keyDown[event.which] !=true || typeof this.keyDown[event.which] == \"undefined\") {\r\n\t\t\tthis.keyDown[event.which] = true;\r\n\t\t\tthis.justPressed[event.which] = true;\r\n\t\t\tthis.justReleased[event.which] = false;\r\n\t\t\tif (typeof this.justPressedEventCallback != \"undefined\" && this.justPressedEventCallback != null) this.justPressedEventCallback(event.which);\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\thandleKeyUp(event) {\r\n\t\t\r\n\t\tif (this.keyDown[event.which] == true) {\r\n\t\t\tthis.keyDown[event.which] = false;\r\n\t\t\tthis.justPressed[event.which] = false;\r\n\t\t\tthis.justReleased[event.which] = true;\r\n\t\t}\r\n\t}\r\n\t\r\n\tisDown(event) {\r\n\r\n\t\treturn this.keyDown[event];\r\n\t\t\r\n\t\t\r\n\t}\r\n\tisJustPressed(event) {\r\n\t\t\r\n\t\t\tif (this.justPressed[event] == true) {\r\n\t\t\t\tthis.justPressed[event] = false;\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\r\n\t}\r\n\tisJustReleased(event) {\r\n\t\tif (this.justReleased[event]) {\r\n\t\t\tthis.justReleased[event] = false;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tkeysDown() {\r\n\tvar kd=[];\r\n\tthis.keyDown.forEach(function(v,i) {\r\n\tif (v) {\r\n\tkd.push(i);\r\n\t\t}\r\n\t});\r\n\treturn kd;\r\n\t}\r\n\tkeysPressed() {\r\n\tvar kd=[];\r\n\tthis.justPressed.forEach(function(v,i) {\r\n\tif (v) {\r\n\tkd.push(i);\r\n\t\t\t}\r\n\t});\r\n\tthis.justPressed.splice();\r\n\treturn kd;\r\n\t}\r\n\t\r\n\tkeysReleased() {\r\n\tvar kd=[];\r\n\tthis.justReleased.forEach(function(v,i) {\r\n\tif (v) {\r\n\tkd.push(i);\r\n\t}\r\n\t});\r\n\tthis.justReleased.splice();\r\n\treturn kd;\r\n\t}\r\n\r\n}\r\n\r\nexport { KeyboardInput };","\"use strict\";\r\nimport {TTS,useWebTTS} from './tts'\r\nif (typeof speech == \"undefined\") var speech = new TTS();\r\nvar MenuTypes={\r\n\tNORMAL:0,\r\n\tSELECTOR:1,\r\n\tSLIDER:2,\r\n\tEDIT:3\r\n}\r\nclass MenuItem {\r\n\tconstructor(id, name) {\r\n\t\tthis.name = name;\r\n\t\tthis.id = id;\r\n\t\tthis.type = MenuTypes.NORMAL;\r\n\t}\r\n\t\r\n\tspeak() {\r\n\t\tspeech.speak(this.name);\r\n\t}\r\n\t\r\n\tselect() {\r\n\t\treturn this.id;\r\n\t}\r\n\t\r\n}\r\n\r\n\r\n\r\n\r\nclass SelectorItem extends MenuItem {\r\n\tconstructor(id, name, options, defaultOption=0, selectCallback) {\r\n\t\tsuper();\r\n\t\tthis.id = id;\r\n\t\tthis.name = name;\r\n\t\tthis.options = options;\r\n\t\tthis.type = MenuTypes.SELECTOR;\r\n\t\tthis.currentOption = defaultOption;\r\n\t\tthis.selectCallback = selectCallback;\r\n\t}\r\n\t\r\n\tspeak() {\r\n\t\tspeech.speak(this.name + \". Selector. Set to \" + this.options[this.currentOption]);\r\n\t}\r\n\t\r\n\tincrease() {\r\n\t\tif (this.currentOption < this.options.length-1) this.currentOption++;\r\n\t\tspeech.speak(this.options[this.currentOption]);\r\n\t\tif (typeof this.selectCallback != \"undefined\") {\r\n\t\t\tthis.selectCallback(this.options[this.currentOption]);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\tdecrease() {\r\n\t\tif (this.currentOption > 0) this.currentOption--;\r\n\t\tspeech.speak(this.options[this.currentOption]);\r\n\t\tif (typeof this.selectCallback != \"undefined\") {\r\n\t\t\tthis.selectCallback(this.options[this.currentOption]);\r\n\t\t}\r\n\t}\r\n\t\r\n\tselect() {\r\n\t\treturn this.id;\r\n\t}\r\n}\r\n\r\n\r\nclass SliderItem extends MenuItem {\r\n\tconstructor(id, name, from, to, currentValue=0) {\r\n\t\tsuper();\r\n\t\tthis.id = id;\r\n\t\tthis.name = name;\r\n\t\tthis.minValue = from;\r\n\t\tthis.maxValue = to;\r\n\t\tthis.currentValue = currentValue;\r\n\t\tthis.type = MenuTypes.SLIDER;\r\n\t}\r\n\t\r\n\tspeak() {\r\n\t\tspeech.speak(this.name + \". Slider. Set to \" + this.currentValue);\r\n\t}\r\n\t\r\n\tincrease() {\r\n\t\tif (this.currentValue < this.maxValue) this.currentValue++;\r\n\t\tspeech.speak(this.currentValue);\r\n\t}\r\n\t\r\n\tdecrease() {\r\n\t\tif (this.currentValue > this.minValue) this.currentValue--;\r\n\t\tspeech.speak(this.currentValue);\r\n\t}\r\n\t\r\n\tselect() {\r\n\t\treturn this.id;\r\n\t}\r\n\t\r\n}\r\n\r\n\r\nclass EditItem extends MenuItem {\r\n\tconstructor(id, name, defaultText=\"\") {\r\n\t\tsuper();\r\n\t\tthis.id = id;\r\n\t\tthis.name = name;\r\n\t\tthis.text = defaultText;\r\n\t\tthis.type = MenuTypes.EDIT;\r\n\t}\r\n\t\r\n\tspeak() {\r\n\t\tspeech.speak(this.name + \". Editable. \" + (this.text == \"\" ? \"Nothing entered.\" : \"Set to \" + this.text));\r\n\t}\r\n\t\r\n\taddChar(char) {\r\n\t\tthis.text += char;\r\n\t\tspeech.speak(char);\r\n\t}\r\n\t\r\n\tremoveChar() {\r\n\t\tthis.text = this.text.substring(0, this.text.length-1);\r\n\t\tspeech.speak(this.text);\r\n\t\t\r\n\t}\r\n\t\r\n\tselect() {\r\n\t\treturn this.text;\r\n\t}\r\n\t\r\n\t\r\n}\r\nexport {MenuItem,MenuTypes}","\"use strict\";\r\nimport {utils} from './utilities';\r\nimport {strings} from './strings';\r\nimport {speech,TTS,useWebTTS} from './tts'\r\nimport $ from 'jquery'\r\nimport {so} from './soundObject.js'\r\nimport {MenuTypes,MenuItem} from './menuItem'\r\nimport {KeyEvent} from './keycodes'\r\nimport {KeyboardInput} from './input'\r\nclass Menu {\r\n\tconstructor(name, menuData,music) {\r\n\t\t\tthis.menuData = menuData;\r\n\t\tthis.cursor = 0;\r\n\t\tthis.name = name;\r\n\t\tthis.sndKeyChar = so.create(\"ui/keyChar\");\r\n\t\tthis.sndKeyDelete = so.create(\"ui/keyDelete\");\r\n\t\tthis.sndSliderLeft = so.create(\"ui/menuSliderLeft\");\r\n\t\tthis.sndSliderRight = so.create(\"ui/menuSliderRight\");\r\n\t\tthis.sndBoundary = so.create(\"ui/menuBoundary\");\r\n\t\tthis.sndChoose = so.create(\"ui/menuChoose\");\r\n\t\tthis.sndMove = so.create(\"ui/menuMove\");\r\n\t\tthis.sndOpen = so.create(\"ui/menuOpen\");\r\n\t\tthis.sndSelector = so.create(\"ui/menuSelector\");\r\n\t\tthis.sndWrap = so.create(\"ui/menuWrap\");\r\n\t\tthis.selectCallback = null;\r\n\t\tif (typeof music!=\"undefined\") this.music=music;\r\n\t\tvar id = document.getElementById(\"touchArea\");\r\n\t\t//this.hammer = new Hammer(id);\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tnextItem() {\r\n\t\t\r\n\t\tif (this.cursor < this.menuData.length-1) this.cursor++;\r\n\t\tthis.sndMove.play();\r\n\t\t\r\n\t\tthis.menuData[this.cursor].speak();\r\n\t}\r\n\tpreviousItem() {\r\n\t\tif (this.cursor > 0) this.cursor--;\r\n\t\tthis.sndMove.play();\r\n\t\tthis.menuData[this.cursor].speak();\r\n\t}\r\n\t\r\n\tincrease() {\r\n\t\tif (this.menuData[this.cursor].type == MenuTypes.SLIDER || this.menuData[this.cursor].type == MenuTypes.SELECTOR) {\r\n\t\t\tthis.menuData[this.cursor].increase();\r\n\t\t\tif (this.menuData[this.cursor].type == MenuTypes.SLIDER) {\r\n\t\t\t\tthis.sndSliderRight.play();\r\n\t\t\t} else {\r\n\t\t\t\tthis.sndSelector.play();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\tdecrease() {\r\n\t\tif (this.menuData[this.cursor].type == MenuTypes.SLIDER || this.menuData[this.cursor].type == MenuTypes.SELECTOR) {\r\n\t\t\tthis.menuData[this.cursor].decrease();\r\n\t\t\tif (this.menuData[this.cursor].type == MenuTypes.SLIDER) {\r\n\t\t\t\tthis.sndSliderLeft.play();\r\n\t\t\t} else {\r\n\t\t\t\tthis.sndSelector.play();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\t\r\n\tinsertCharacter(char) {\r\n\t\tif (this.menuData[this.cursor].type == MenuTypes.EDIT) {\r\n\t\t\tthis.menuData[this.cursor].addChar(String.fromCharCode(char));\r\n\t\t\tthis.sndKeyChar.play();\r\n\t\t}\r\n\t}\r\n\t\r\n\tremoveCharacter() {\r\n\t\tif (this.menuData[this.cursor].type == MenuTypes.EDIT) {\r\n\t\t\tthis.menuData[this.cursor].removeChar();\r\n\t\t\tthis.sndKeyDelete.play();\r\n\t\t}\r\n\t}\r\n\thandleInput(event) {\r\n\t\t\r\n\t\t\r\n\t\t\tthis.insertCharacter(event.which);\r\n\t\t\r\n\t\t\r\n\t}\r\n\tdestroySounds() {\r\n\t\tthis.sndKeyChar.unload();\r\n\t\tthis.sndKeyDelete.unload();\r\n\t\tthis.sndSliderLeft.unload();\r\n\t\tthis.sndSliderRight.unload();\r\n\t\tthis.sndBoundary.unload();\r\n\t\tthis.sndChoose.unload();\r\n\t\tthis.sndMove.unload();\r\n\t\tthis.sndOpen.unload();\r\n\t\tthis.sndSelector.unload();\r\n\t\tthis.sndWrap.unload();\r\n\t\tif (typeof this.music!=\"undefined\") this.music.unload();\r\n\t}\r\n\tasync fade() {\r\n\tfor (var i=this.music.volume;i>0;i-=0.06) {\r\n\t\tthis.music.volume=i;\r\n\t\tawait utils.sleep(50);\r\n\t\t}\r\n\t\tthis.music.unload();\r\n\t\tthis.unload();\r\n\t\t\t}\r\n\tunload() {\r\n\t\t\t$(document).off(\"keydown\");\r\n\t\t$(document).off(\"keypress\");\r\n\t\t//this.hammer.unload();\r\n\t\tvar that = this;\r\n\t\tsetTimeout(function() { that.destroySounds(); }, 500);\r\n\t}\r\n\thandleKeys(event) {\r\n\t\t\r\n\t\t\r\n\t\t\tswitch(event.which) {\r\n\t\t\t\tcase KeyEvent.DOM_VK_RETURN:\r\n\t\t\t\t\tthis.select();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase KeyEvent.DOM_VK_PAGE_UP:\r\n\t\t\t\t\tthis.music.volume+=0.03;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\tcase KeyEvent.DOM_VK_PAGE_DOWN:\r\n\t\t\t\t\tthis.music.volume-=0.03;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KeyEvent.DOM_VK_BACK_SPACE:\r\n\t\t\t\t\tthis.removeCharacter();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\t\tcase KeyEvent.DOM_VK_DOWN:\r\n\t\t\t\t\r\n\t\t\t\t\tthis.nextItem();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KeyEvent.DOM_VK_UP:\r\n\t\t\t\t\tthis.previousItem();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KeyEvent.DOM_VK_RIGHT:\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.increase();\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KeyEvent.DOM_VK_LEFT:\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.decrease();\r\n\t\t\t\t\t\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\trun(callback) {\r\n\t\tif (typeof this.music==\"object\") {\r\n\t\tthis.music.volume=0.5;\r\n\t\t\tthis.music.loop=true;\r\n\tthis.music.play();\r\n\t}\r\n\telse if (typeof this.music==\"string\") {\r\n\tthis.music=so.create(this.music);\r\n\tthis.music.volume=0.5;\r\n\tthis.music.loop=true;\r\n\tthis.music.play();\r\n\t}\r\n\telse {\r\n\t}\r\n\t\tthis.selectCallback = callback;\r\n\t\tvar that = this;\r\n\t\t$(document).on(\"keypress\", function(event) { that.handleInput(event) });\r\n\t\t$(document).on(\"keydown\", function(event) { that.handleKeys(event) });\r\n\t\t/*\r\n\t\tthis.hammer.on(\"swipeleft\", function(event) { that.handleSwipe(0); });\r\n\t\tthis.hammer.on(\"swiperight\", function(event) { that.handleSwipe(1); });\r\n\t\tthis.hammer.on(\"panup\", function(event) { that.handleSwipe(3); });\r\n\t\tthis.hammer.on(\"pandown\", function(event) { that.handleSwipe(4); });\r\n\t\tthis.hammer.on(\"tap\", function(event) { that.handleSwipe(2); });\r\n\t\t*/\r\n\t\tspeech.speak(this.name);\r\n\t\tthis.sndOpen.play();\r\n\t\t\r\n\t}\r\n\t\r\n\thandleSwipe(action) {\r\n\t\tif (action == 3) {\r\n\t\t\tthis.decrease();\r\n\t\t}\r\n\t\tif (action == 4) {\r\n\t\t\tthis.increase();\r\n\t\t}\r\n\t\t\r\n\t\tif (action == 0) {\r\n\t\t\tthis.previousItem();\r\n\t\t}\r\n\t\tif (action == 1) {\r\n\t\t\tthis.nextItem();\r\n\t\t}\r\n\t\tif (action == 2) {\r\n\t\t\tthis.select();\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\tselect() {\r\n\t\t\r\n\t\tvar selected = this.menuData[this.cursor].id;\r\n\t\t\r\n\t\tvar items=[];\r\n\t\tfor (var i=0;i<this.menuData.length;i++) {\r\n\t\t\tvar addItem = null;\r\n\t\t\tif (this.menuData[i].type == MenuTypes.SLIDER) {\r\n\t\t\t\taddItem = {\r\n\t\t\t\t\tid:this.menuData[i].id,\r\n\t\t\t\t\tvalue:this.menuData[i].currentValue,\r\n\t\t\t\t\tname:this.menuData[i].options[this.menuData[i].currentValue]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.menuData[i].type == MenuTypes.EDIT) {\r\n\t\t\t\taddItem = {\r\n\t\t\t\t\tid:this.menuData[i].id,\r\n\t\t\t\t\tvalue:this.menuData[i].text\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.menuData[i].type == MenuTypes.SELECTOR) {\r\n\t\t\t\taddItem = {\r\n\t\t\t\t\tid:this.menuData[i].id,\r\n\t\t\t\t\tvalue:this.menuData[i].currentOption,\r\n\t\t\t\t\tname:this.menuData[i].options[this.menuData[i].currentOption]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\titems.push(addItem);\r\n\t\t}\r\n\t\t\r\n\t\tvar toReturn = {\r\n\t\t\tselected:selected,\r\n\t\t\tcursor:this.cursor,\r\n\t\t\titems:items\r\n\t\t}\r\n\t\tthis.sndChoose.play();\r\n\t\t$(document).off(\"keydown\");\r\n\t\t$(document).off(\"keypress\");\r\n\t\tif (typeof this.music!=\"undefined\") this.fade();\r\n\t\tvar that=this;\r\n\t\t\t\tsetTimeout(function(){\r\nthat.selectCallback(toReturn);\r\n\t\t},700);\r\n\t}\r\n}\r\nexport {Menu}","'use strict'\r\nimport {so} from './soundObject';\r\nimport {langs,lang} from './main';\r\nimport {st} from './stateMachine';\r\nimport {strings} from './strings';\r\nimport {MenuItem} from './menuItem';\r\nimport {pack,packdir,rebuildHashes} from './main';\r\nimport {Menu} from './menu';\r\n\texport function mainMenu() {\r\n\tvar items=new Array();\r\n\titems.push(new MenuItem(0,strings.get(lang,\"mStart\")));\r\nitems.push(new MenuItem(1,strings.get(lang,\"mLearn\")));\r\nitems.push(new MenuItem(2,strings.get(lang,\"mBrowse\")));\r\nitems.push(new MenuItem(3,strings.get(lang,\"mHashes\")));\r\n\tvar mainMenu=new Menu(\"main menu\",items);\r\n\tso.directory=\"\";\r\n\tmainMenu.music=packdir+\"loop\";\r\n\tvar fs=require('fs');\r\n\tif (fs.existsSync(packdir+\"select.ogg\")) {\r\n\tmainMenu.sndChoose.unload();\r\n\tmainMenu.sndChoose=so.create(packdir+\"select\");\r\n}\r\n\tmainMenu.run(function(s) {\r\n\t\t\tso.directory=\"./sounds/\";\r\n\tswitch(s.selected) {\r\n\tcase 0: st.setState(3); break;\r\n\tcase 1: st.setState(4); break;\r\n\tcase 2: \r\n\t\tst.setState(5); break;\r\n\t\tcase 3: rebuildHashes(); break;\r\n\t}\r\n\r\n\t});\r\n\t}","\"use strict\";\r\nclass OldTimer {\r\nconstructor() {\r\nthis.elapsed;\r\nthis.paused=true;\r\nthis.lastTime=0;\r\nthis.pauseWhen=0;\r\nthis.started=true;\r\n}\r\nisActive() {\r\nreturn !paused & started;\r\n}\r\nget elapsed() {\r\nif (this.paused) {\r\nreturn this.pauseWhen-this.lastTime;\r\n}\r\nreturn performance.now()-this.lastTime;\r\n}\r\npause() {\r\nthis.paused=true;\r\nthis.pauseWhen=performance.now()\r\n}\r\nreset(){\r\nthis.lastTime=performance.now();\r\nthis.pauseWhen=0;\r\nthis.paused=false;\r\nthis.started=true;\r\n}\r\nresume() {\r\nthis.paused=false;\r\nthis.started=true;\r\nthis.lastTime+=performance.now()-this.pauseWhen\r\n}\r\n}\r\nexport {OldTimer}","function Timer(callbacks, step) {\r\n  var last = 0;\r\n  var active=false;\r\n      var acc = 0;\r\n      var tick = 0;\r\n      var inc = step || 1/120;\r\n      var frameId;\r\n\r\n  function onFrame(time) {\r\n    if (last !== null) {\r\n      acc = acc + (time - last) / 1000;\r\n      while (acc > inc) {\r\n        callbacks.update(inc, tick);\r\n        tick = tick + 1;\r\n        acc = acc - inc;\r\n      }\r\n    }\r\n    last = time;\r\n    callbacks.render();\r\nif (active)     frameId = requestAnimationFrame(onFrame);\r\n  }\r\n\r\n  function start() {\r\n    last = null;\r\n    active=true;\r\n    frameId = requestAnimationFrame(onFrame);\r\n  }\r\n\r\n  function stop() {\r\n    active=false;\r\n    cancelAnimationFrame(frameId);\r\n    console.log(frameId);\r\n  }\r\nfunction change(value) {\r\n  inc =value|| 1/120;\r\n  acc=inc;\r\n  tick=0;\r\n  stop();\r\n  start();\r\n}\r\n  return {\r\n    start: start,\r\n    stop: stop,\r\n    change: change,\r\n  };\r\n}\r\n\r\nmodule.exports = Timer;\r\n","'use strict';\r\nimport fs from 'fs';\r\nimport os from 'os'\r\nimport speech from './tts';\r\nimport {actionKeys} from './main';\r\nimport {pack,packdir} from './main';\r\nimport $ from 'jquery';\r\nimport {OldTimer} from './oldtimer';\r\n//var os=require('os');\r\nimport {SoundHandler} from './soundHandler';\r\nimport {utils} from './utilities';\r\nimport {so} from './soundObject';\r\nimport {st} from './stateMachine';\r\nimport Timer from './timer'\r\nimport {ScrollingText} from './scrollingText';\r\n//var fs=require('fs');\r\nimport { KeyboardInput } from './input.js'\r\nimport { KeyEvent } from './keycodes.js'\r\nclass Game {\r\n\tconstructor() {\r\n\tthis.canPause=true;\r\n\t\tthis.actionCompleted=false;\r\n\t\tthis.toDestroy=new Array();\r\n\t\tthis.scoreTimer=new OldTimer();\r\n\t\tvar that=this;\r\n\t\t$(document).on(\"blur\",function() {\r\n\t\tthat.pause();\r\n\t\t});\r\n\t\t\t\tthis.pauseTime=0;\r\n\tthis.timer=null;\r\n\tthis.music=null;\r\n\t\t\t\tthis.score=0;\r\n\t\tthis.pool=new SoundHandler();\r\nthis.bpms=null;\r\nthis.level=0;\r\nthis.fileData=null;\r\n\t\tthis.input = new KeyboardInput();\r\n\t\tthis.input.init();\r\n\t\tthis.levels=null;\r\n\t\tvar that=this;\r\n\t\tthis.setup();\r\n\t}\r\n\tsetup() {\r\n\t\tif (fs.existsSync(packdir+\"bpm.txt\")) {\r\n\t\t\tthis.fileData=fs.readFileSync(packdir+\"bpm.txt\",\"utf8\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar error=new ScrollingText(\"There was an error loading the pack \"+this.pack+\".\",\"\\n\",function() {\r\n\t\t\t\tst.setState(2);\r\n\t\t\t\treturn;\r\n\t\t\t})\r\n\t\t}\r\n\t\tthis.bpms=this.fileData.split(\",\");\r\n\t\tthis.levels=this.bpms.length-1;\r\n\t\tif (this.bpms[this.levels]==\"\") this.levels--;\r\n\t\t\t\tthis.level++;\r\n\t\t\t\tso.directory=\"\";\r\n\t\tif (fs.existsSync(packdir+\"nlevel.ogg\"))  so.enqueue(packdir+\"nlevel\");\r\n\t\t\t\tif (fs.existsSync(packdir+\"fail.ogg\"))  so.enqueue(packdir+\"fail\");\r\n\t\t\t\t\t\t\t\t\t\t\t\tfor (var i=1;i<=10;i++) {\r\n\t\t\t\tif (fs.existsSync(packdir+\"a\"+i+\".ogg\")) {\r\n\t\tso.enqueue(packdir+\"a\"+i);\r\n\t\tthis.actions=i;\r\n\t\t}\r\n\t\tif (fs.existsSync(packdir+\"o\"+i+\".ogg\")) {\r\n\t\tso.enqueue(packdir+\"o\"+i);\r\n\t\t}\r\n\t}\r\nthis.keys=actionKeys;\r\nvar that=this;\r\n    \t\t\t\t\tthis.timer = Timer({update: function(dt) { that.update(dt); }, render: function() { that.render(); }}, this.bpms[this.level]/1000.0);\r\n    \t\t\t\t\tso.setQueueCallback(function() {\r\n    \t\t\t\t\tso.directory=\"./sounds/\";\r\n    \t\t\t\t\tthat.setupLevel();\r\n    \t\t\t\t\t});\r\n    \t\t\t\t\tthis.queueLevels();\r\nso.loadQueue();\r\n\t}\r\n\tupdate(dt) {\r\n\tif (this.currentAction==0) {\r\n\tthis.currentAction++;\r\n\treturn;\r\n\t}\r\n\t\t\t\t\tif (!this.actionCompleted && this.action>1) {\r\n\t\t\t\tthis.fail();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\nthis.currentAction++;\r\n//action and level checks go here\r\nif (this.currentAction>=this.numberOfActions) {\r\nso.directory=\"\";\r\n\tso.destroy(packdir+this.level+\"music\");\r\n\t\tso.destroy(packdir+\"pre\"+this.level);\r\n\tso.directory=\"./sounds/\";\r\nthis.level++;\r\nthis.timer.stop();\r\nthis.setupLevel();\r\nreturn;\r\n}\r\n\tthis.action=utils.randomInt(1,this.actions);\r\n\tthis.actionCompleted=false;\r\n\tso.directory=\"\";\r\n\tthis.pool.playStatic(packdir+\"a\"+this.action,0);\r\n\tso.directory=\"./sounds/\";\r\n\t//\t\tif (this.action==1) this.actionCompleted=true;//freeze\r\n\t\tthis.scoreTimer.reset();\r\n\t}\r\nasync fail() {\r\n\tthis.timer.stop();\r\n\t\t\tvar snd=this.music;\r\n\t\t\tso.directory=\"\";\r\n\t\t\tvar failsound=this.pool.playStatic(packdir+\"fail\",0);\r\n\t\t\tso.directory=\"./sounds/\";\r\n\t\tfor (var i=snd.playbackRate;i>0;i-=0.05) {\r\n\t\t\tsnd.playbackRate=i;\r\n\t\t\tawait utils.sleep(30);\r\n\t\t}\r\n\t\tsnd.unload();\r\n\t\twhile(this.pool.staticSounds[failsound].sound.playing) {\r\n\t\tawait utils.sleep(10);\r\n\t\tif (this.input.isDown(KeyEvent.DOM_VK_RETURN)) {\r\n\t\tspeech.speak(\"meow\");\r\n\t\tthis.pool.staticSounds[failsound].sound.unload();\r\n\t\t}\r\n\t\t}\r\n\t\tso.resetQueue();\r\nso.resetQueuedInstance();\r\nso.kill(function() {st.setState(2)});\r\n\t}\r\n\tasync quit() {\r\n\t\tthis.timer.stop();\r\n\t\t\tvar snd=this.music;\r\n\t\t\t\t\t\t\t\t\t\t\tfor (var i=snd.playbackRate;i>0;i-=0.045) {\r\n\t\t\tsnd.playbackRate=i;\r\n\t\t\tawait utils.sleep(30);\r\n\t\t}\r\n\t\t\t\tsnd.unload();\r\n\t\t\t\tso.resetQueue();\r\nso.resetQueuedInstance();\r\n\t\tst.setState(2);\r\n\t}\r\n\r\n\trender() {\r\n\tif (this.input.isJustPressed(KeyEvent.DOM_VK_Q)) {\r\n\tthis.quit();\r\n\treturn;\r\n\t}\r\n\t\tif (this.input.isJustPressed(KeyEvent.DOM_VK_P)) {\r\n\t\tthis.pause();\r\n\t\treturn;\r\n\t\t}\r\n\t\t\t\tthis.handleKeys();\r\n\t}\r\n\thandleKeys() {\r\n\tif (this.actionCompleted) return;\r\n\tvar keys=this.input.keysPressed();\r\n\tif (keys.length>0 && this.action==1) {\r\n\tthis.fail();\r\n\treturn;\r\n\t}\r\n\t\tif (keys.length>1){\r\n\t\tthis.fail();\r\n\treturn;\r\n\t}\r\n\tif (keys.length==1 && keys[0]==this.keys[this.action]){\r\n\tso.directory=\"\";\r\n\tthis.pool.playStatic(packdir+\"o\"+this.action,0);\r\n\tso.directory=\"./sounds/\";\r\n\t\tthis.actionCompleted  =true;\r\n\tthis.calculateScore();\r\n\treturn;\r\n\t\t}\r\n\t\t\tif (keys.length==1 && keys[0]!=this.keys[this.action]){\r\n\t\t\t\t\t\tthis.fail();\r\n\t\t\treturn;\r\n\t\t\t}\r\n\t}\r\nasync setupLevel() {\r\nthis.canPause=true;\r\n\tthis.playing=false;\r\n\t\t\t\tif (fs.existsSync(packdir+\"pre\"+this.level+\".ogg\")) {\r\n\t\t\t\t\tso.directory=\"\";\r\nthis.preSound=so.create(packdir+\"pre\"+this.level);\r\nso.directory=\"./sounds/\";\r\nthis.preSound.play();\r\nthis.playing=true;\r\n}\r\nif (fs.existsSync(packdir+\"nlevel.ogg\") && !this.playing && this.level>1) {\r\n\tso.directory=\"\";\r\nthis.preSound=so.create(packdir+\"nlevel\");\r\nso.directory=\"./sounds/\";\r\nthis.preSound.play();\r\nthis.playing=true;\r\n}\r\nif (this.playing) {\r\n\t\tthis.queueLevels();\r\n\t\twhile(this.preSound.playing) {\r\n\t\tawait utils.sleep(5);\r\n\t\tif (this.input.isJustPressed(KeyEvent.DOM_VK_RETURN)) {\r\n\t\tthis.preSound.stop();\r\n\t\t}\r\n\t\t}\r\n}\r\nso.directory=\"\";\r\nvar that=this;\r\n\t\t\t\tthis.music=so.create(packdir+this.level+\"music\");\r\n\t\t\t\tthis.music.loop=true;\r\n\t\t\t\tso.directory=\"./sounds/\";\r\nthis.music.play();\r\n\tthis.timer.change(that.bpms[that.level]/1000.0)\r\nif (!this.playing && this.level>1) {\r\n\t\t\t\t\t\t\t\t\tthis.queueLevels();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tthis.action=0;\r\n\t\t\t\t\t\tthis.actionCompleted=false;\r\n\tthis.currentAction=0;\r\n\tthis.numberOfActions=utils.randomInt(6+this.level,this.level*2+6);\r\n\t}\r\nunload() {\r\n}\r\nasync pause() {\r\nif (!this.canPause) return;\r\nthis.canPause=false;\r\nvar snd=this.music;\r\nthis.timer.stop();\r\nthis.scoreTimer.pause();\r\nthis.pauseTime=snd.currentTime;\r\nfor (var i=snd.playbackRate;i>0;i-=0.05) {\r\n\t\t\tsnd.playbackRate=i;\r\n\t\t\tawait utils.sleep(30);\r\n\t\t}\r\n\t\tsnd.pause();\r\n\t\twhile (!this.input.isDown(KeyEvent.DOM_VK_P)) {\r\n\t\tawait utils.sleep(10);\r\n\t\t}\r\n\t\tthis.unpause();\r\n}\r\nasync unpause() {\r\nvar snd=this.music;\r\nsnd.play();\r\nfor (var i=snd.playbackRate;i<=1;i+=0.05) {\r\n\t\t\tsnd.playbackRate=i;\r\n\t\t\tawait utils.sleep(8);\r\n\t\t}\r\n\t\tsnd.seek(this.pauseTime);\r\n\t\tthis.timer.start();\r\n\t\tthis.scoreTimer.resume();\r\n}\r\ncalculateScore() {\r\nvar bpm=this.bpms[this.level-1];\r\nvar score=utils.percent(this.scoreTimer.elapsed,bpm/2);\r\nif (this.scoreTimer.elapsed>bpm/2) score=100;\r\nif (this.scoreTimer.elapsed>bpm/2-20 && this.scoreTimer.elapsed<bpm/2+20) score=200;\r\nvar good=bpm/2;\r\nvar timev=this.scoreTimer.elapsed-good;\r\nvar remscore=timev/bpm*100;\r\nthis.score=Math.ceil(score-remscore);\r\nspeech.speak(this.score);\r\n}\r\nqueueLevels() {\r\nvar levelLimit=this.level+1;\r\n\t\t\tif (this.levels<levelLimit) levelLimit=this.levels;\r\n\t\t\t\t\t\t\t\t\t\tso.directory=\"\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var i=this.level;i<=levelLimit;i++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tso.enqueue(packdir+i+\"music\");\r\n\t\tif (fs.existsSync(packdir+\"pre\"+i+\".ogg\")) {\r\n\t\tso.enqueue(packdir+\"pre\"+i);\r\n\t\t}\r\n\t\t}\r\n\t\tif (this.level>1) {\r\n\t\t\tso.setQueueCallback(0);\r\n\t\tso.loadQueue();\r\n\t\tso.directory=\"./sounds/\";\r\n\t\t\t\t}\r\n}\r\n}\r\nexport { Game };","'use strict'\r\n\tvar event=new KeyboardInput();\r\n\t\r\nimport {KeyboardInput} from './input';\r\nimport {speech} from './tts';\r\nimport {learnPack,browsePacks} from './main';\r\nimport {Menu} from './menuHandler';\r\nimport $ from 'jquery';\r\nimport {so} from './soundObject';\r\nimport {KeyEvent} from './keycodes'\r\nimport {Game} from './game';\r\nclass StateMachine {\r\n\tconstructor() {\r\n\t\tthis.state = 0;\r\n\t\tthis.currentState = 0;\r\n\t}\r\n\t\r\n\tsetState(state) {\r\n\tif (state==1) {\r\nevent=new KeyboardInput();\r\n\tevent.init();\r\n\tvar intro=so.create(\"logo\");\r\n\tvar that=this;\r\n\tintro.volume=0.5;\r\n\tintro.play();\r\n\tintro.sound.once(\"end\",function() {\r\n\t\tintro.unload();\r\n\t$(document).off(\"keydown\");\r\n\t\t\tthat.setState(2);\r\n\t});\r\n\t$(document).keydown(function(event) {\r\n\t\tif (event.which==KeyEvent.DOM_VK_SPACE || event.which==KeyEvent.DOM_VK_ESCAPE) {\r\n\t\t\t\t\t\tintro.unload();\r\n\t\t\t\t\t$(document).off(\"keydown\");\r\n\t\t\tthat.setState(2);\r\n\t\t}\r\n\t\t})\r\n\t\tthis.state = state;\r\n\r\n\t}\r\n\telse if (state==2) {\r\n\tevent=null;\r\n\tmainMenu();\r\n\tthis.state = state;\r\n\t}\r\n\t\t\t\telse if (state == 3) {\r\n\t\t\t\t\t\r\n\t\t\tthis.currentState = new Game();\r\n\t\t\tthis.state = state;\r\n\t\t}\r\n\r\nelse if (state==4) { learnPack();\r\n}\r\n//new states\r\nelse if (state==5) {\r\nbrowsePacks();\r\nthis.state = state;\r\n}\r\n\t}\r\n\t\r\n}\r\nvar st=new StateMachine();\r\nexport {st};\r\nimport {mainMenu} from './menuHandler';","import $ from 'jquery';\r\nimport Cryptr from 'cryptr';\r\nimport 'hash-files';\r\nimport walk from 'fs-walk';\r\nimport fs from 'fs';\r\nimport os from 'os'\r\nimport {ScrollingText} from './scrollingText';\r\nimport {strings} from './strings';\r\nimport {SoundHandler} from './soundHandler';\r\nimport {speech} from './tts';\r\nimport {utils} from './utilities';\r\nimport {so} from './soundObject';\r\nimport {KeyEvent} from './keycodes';\r\nimport {st} from './stateMachine';\r\n//import test from './test.js'\r\nexport var actionKeys=[0,0,KeyEvent.DOM_VK_SPACE,KeyEvent.DOM_VK_TAB,KeyEvent.DOM_VK_RETURN,KeyEvent.DOM_VK_BACK_SPACE,KeyEvent.DOM_VK_UP,KeyEvent.DOM_VK_DOWN,KeyEvent.DOM_VK_RIGHT,KeyEvent.DOM_VK_LEFT];\r\nexport var mangle=new Cryptr(\"sdf jkl wer uio\");\r\nimport {KeyboardInput} from './input.js'\r\nexport var lang=1;\r\nexport var langs=[\"\",\"english\",\"spanish\"]\r\nexport var pack=\"default\";\r\nexport var packdir=os.homedir()+\"/beatpacks/\"+pack+\"/\";\r\ndocument.addEventListener(\"DOMContentLoaded\",setup);\r\nso.debug=true;\r\nfunction setup() {\r\n/*\r\n\tso.enqueue(\"memtest\");\r\n\tso.setQueueCallback(function() { proceed(); });\r\n\tso.loadQueue();\r\n\t*/\r\n\tst.setState(1);\r\n}\r\n\tfunction proceed() {\r\n\t\tvar sound=so.create(\"memtest\");\r\n\t\tsound.volume=0.3;\r\n\t\tsound.play();\r\n\t\tso.destroy(\"memtest\");\r\n\t}\r\n//st.setState(1);\r\n//document.removeEventListener(\"DOMContentLoaded\",setup);\r\n\r\nexport async function learnPack() {\r\n\r\nvar pool=new SoundHandler();\r\nvar actions=0;\r\n\t\t\t\tfor (var i=1;i<=10;i++) {\r\n\t\t\t\tif (fs.existsSync(packdir+\"a\"+i+\".ogg\")) {\r\n\t\t\t\tactions=i;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (lang==1) speech.speak(\"This pack has \"+actions+\" actions. Typical keys are space, tab, enter, backspace, and optionally arrows up, down, left, right. If you have mapped your keyboard differently, use your custom keys instead. To hear the stop action, press the period key (to the right of comma).\");\r\n\t\t\t\tif (lang==2) speech.speak(\"Este pack tiene \"+actions+\" acciones. Las teclas tpicas son espacio, tabulador, enter, bretroceso, y opcionalmente las flechas. Si has reasignado las teclas, puedes usarlas. Para escuchar la accin de parar, pulsa la tecla del punto (a la derecha de la coma).\");\r\n\t\t\t\tvar event=new KeyboardInput();\r\n\t\t\t\tevent.init();\r\n\t\t\t\tso.directory=\"\";\r\n\t\t\t\twhile (!event.isJustPressed(KeyEvent.DOM_VK_Q)) {\r\n\t\t\t\tawait utils.sleep(10);\r\n\t\t\t\tif (event.isJustPressed(actionKeys[2]))\r\n\t\t\t\tpool.playStatic(packdir+\"a\"+2,0);\r\n\t\t\t\t\t\t\t\tif (event.isJustPressed(actionKeys[3]))\r\n\t\t\t\tpool.playStatic(packdir+\"a\"+3,0);\r\n\t\t\t\tif (event.isJustPressed(actionKeys[4]))\r\n\t\t\t\tpool.playStatic(packdir+\"a\"+4,0);\r\n\t\t\t\tif (event.isJustPressed(actionKeys[5]))\r\n\t\t\t\tpool.playStatic(packdir+\"a\"+5,0);\r\n\t\t\t\tif (event.isJustPressed(actionKeys[6]))\r\n\t\t\t\tpool.playStatic(packdir+\"a\"+6,0);\r\n\t\t\t\tif (event.isJustPressed(actionKeys[7]))\r\n\t\t\t\tpool.playStatic(packdir+\"a\"+7,0);\r\n\t\t\t\tif (event.isJustPressed(actionKeys[8]))\r\n\t\t\t\tpool.playStatic(packdir+\"a\"+8,0);\r\n\t\t\t\tif (event.isJustPressed(actionKeys[9]))\r\n\t\t\t\tpool.playStatic(packdir+\"a\"+9,0);\r\n\t\t\t\tif (event.isJustPressed(KeyEvent.DOM_VK_PERIOD))\r\n\t\t\t\tpool.playStatic(packdir+\"a\"+1,0);\r\n\t\t\t\t}\r\n\t\t\t\tpool.destroy();\r\n\t\t\t\tso.directory=\"./sounds/\";\r\n\t\t\t\tst.setState(2);\r\n}\r\nexport async function browsePacks(browsing=1) {\r\nif (!fs.existsSync(os.homedir()+\"/beatpacks/hashes.db\")) {\r\nvar error=0;\r\nif (lang==1) error=new ScrollingText(\"The packs folder hashes need to be rebuilt to continue. This can take a few seconds...\",\"\\n\",function() { rebuildHashes() });\r\nif (lang==2) error=new ScrollingText(\"Para continuar, debo reconstruir la carpeta de packs. Esto puede tardar unos segundos...\",\"\\n\",function() { rebuildHashes() });\r\nreturn;\r\n}\r\ntry {\r\nvar packs=JSON.parse(mangle.decrypt(fs.readFileSync(os.homedir()+\"/beatpacks/hashes.db\")));\r\n}\r\ncatch(err) {\r\nvar error=0;\r\nif (lang==1) error=new ScrollingText(\"The packs folder hashes need to be rebuilt to continue. This can take a long while, so go get a coffee or something...\",\"\\n\",function() { rebuildHashes() });\r\nif (lang==2) error=new ScrollingText(\"Para continuar, debo reconstruir la carpeta de packs. Esto puede tardar un buen rato as que ves a por un caf o algo...\",\"\\n\",function() { rebuildHashes() });\r\nreturn;\r\n}\r\nvar timeout=-1;\r\nvar browseArray=[];\r\nvar browsePosition=-1;\r\n\r\nif (browsing==1) browseArray=packs;\r\nso.directory=\"\";\r\nvar toRemove=new Array();\r\nbrowseArray.forEach(function(i,v) {\r\n\t\tif (!fs.existsSync(os.homedir()+\"/beatpacks/\"+i.name+\"/bpm.txt\")) {\r\n\ttoRemove.push(v);\r\n\treturn;\r\n\t}\r\n});\r\ntoRemove.forEach(function(i) {\r\n\tbrowseArray.splice(i,1);\r\n});\r\nif (browseArray.length<1) {\r\n\tnew ScrollingText(strings.get(lang,\"nopacks\"),\"\\n\",st.setState(2));\r\n\treturn;\r\n}\r\nvar event=new KeyboardInput();\r\nevent.init();\r\nvar snd;\r\nif (lang==1) speech.speak(\"ready. Browsing \"+browseArray.length+\" packs. Press arrows to move, q to exit, enter to choose a pack, or page up and page down to move by larger increments.\");\r\nif (lang==2) speech.speak(\"listo. tienes \"+browseArray.length+\" packs. Pulsa flechas para moverte, q para salir, enter para elegir uno, o pulsa retroceder pgina y avanzar pgina para moverte de 20 en 20.\");\r\nvar exitNow=0;\r\nwhile (!event.isJustPressed(KeyEvent.DOM_VK_Q) && browsing>0) {\r\n//enter\r\nif (event.isJustPressed(KeyEvent.DOM_VK_RETURN)) {\r\nif (typeof snd!=\"undefined\") snd.destroy();\r\nif (timeout!=-1) clearTimeout(timeout);\r\nif (browsePosition!=-1) {\r\nvar size=0;\r\nwalk.filesSync(os.homedir()+\"/beatpacks/\"+browseArray[browsePosition].name,function(pb,pf,stat) {\r\nsize+=stat.size;\r\n});\r\nif (size!=browseArray[browsePosition].hash){\r\nbrowsing=0;\r\n//todo: remove from unlocked\r\nspeech.speak(strings.get(lang,\"tamperWarning\"));\r\nsetTimeout(function() {\r\nspeech.speak(strings.get(lang,\"tamperWarning\"));\r\n},4500);\r\nwhile(!event.isJustPressed(KeyEvent.DOM_VK_RETURN)) {\r\nawait utils.sleep(10);\r\n}\r\n}\r\nif (browsing>0) {\r\npack=browseArray[browsePosition].name;\r\npackdir=os.homedir()+\"/beatpacks/\"+pack+\"/\";\r\nso.directory=\"./sounds/\";\r\nso.kill(function() {\r\nst.setState(2);\r\n});\r\nreturn;\r\n}\r\n}\r\n}\r\n//down arrow\r\nif (event.isJustPressed(KeyEvent.DOM_VK_DOWN)) {\r\nif (typeof snd!=\"undefined\") snd.destroy();\r\nif (timeout!=-1) clearTimeout(timeout);\r\nbrowsePosition++;\r\nif (browsePosition>browseArray.length-1) browsePosition=0;\r\nif (lang==1) speech.speak(browseArray[browsePosition].name+\". \"+browseArray[browsePosition].levels+\" levels.\");\r\nif (lang==2) speech.speak(browseArray[browsePosition].name+\". \"+browseArray[browsePosition].levels+\" niveles.\");\r\ntimeout=setTimeout(function() {\r\nsnd=so.create(browseArray[browsePosition].preview);\r\nsnd.play();\r\n},1000);\r\n}\r\n//up arrow\r\nif (event.isJustPressed(KeyEvent.DOM_VK_UP)) {\r\nif (typeof snd!=\"undefined\") snd.destroy();\r\nif (timeout!=-1) clearTimeout(timeout);\r\nbrowsePosition--;\r\nspeech.speak(browsePosition);\r\nif (browsePosition<0) browsePosition=browseArray.length-1;\r\nif (lang==1) speech.speak(browseArray[browsePosition].name+\". \"+browseArray[browsePosition].levels+\" levels.\");\r\nif (lang==2) speech.speak(browseArray[browsePosition].name+\". \"+browseArray[browsePosition].levels+\" niveles.\");\r\ntimeout=setTimeout(function() {\r\nsnd=so.create(browseArray[browsePosition].preview);\r\nsnd.play();\r\n},1000);\r\n}\r\nawait utils.sleep(5);\r\n}\r\nif (timeout!=-1) clearTimeout(-1);\r\nso.directory=\"./sounds/\";\r\nso.kill(function() {\r\nst.setState(2);\r\n});\r\n}\r\nexport function rebuildHashes() {\r\n//var hash=require('hash-files');\r\nvar corrupts=\"\";\r\n//var walk=require('fs-walk');\r\n//var fs=require('fs');\r\nvar newHash=\"abc\";\r\nvar packs=new Array();\r\nso.directory=\"\";\r\nwalk.dirsSync(os.homedir()+\"/beatpacks\",function(pb,pf,stat,next) {\r\nif (!fs.existsSync(pb+\"/\"+pf+\"/bpm.txt\")) {\r\ncorrupts+=\"\\n\"+pf;\r\nreturn; //discard non packs\r\n}\r\nvar theFiles=0;\r\nvar path=pb+\"/\"+pf+\"/\";\r\nwalk.filesSync(path,function(pb,pf,stat) {\r\ntheFiles+=stat.size;\r\n});\r\nnewHash=theFiles;\r\nvar fileData=fs.readFileSync(path+\"bpm.txt\",\"utf8\");\r\nvar levelsa=fileData.split(\",\");\r\nvar levels=levelsa.length-1;\r\nif (levelsa[levels]==\"\") levels--;\r\nvar temp={\r\n\"name\":pf,\r\n\"preview\":path+\"name\",\r\n\"levels\":levels,\r\n\"hash\":newHash,\r\n}\r\npacks.push(temp);\r\n});\r\nso.directory=\"./sounds/\";\r\nvar write=JSON.stringify(packs);\r\nwrite=mangle.encrypt(write);\r\nfs.writeFileSync(os.homedir()+\"/beatpacks/hashes.db\",write);\r\nif (corrupts!=\"\") {\r\nif (lang==1) new ScrollingText(\"one thing before you go... the following packs are corrupt and should be looked at.\"+corrupts,\"\\n\",function() {st.setState(2)});\r\nif (lang==2) new ScrollingText(\"Antes de que te vayas... los siguientes packs estn corruptos y deberas echar un vistazo a ver qu pasa.\"+corrupts,\"\\n\",function() {\r\n\tst.setState(2)});\r\n}\r\nelse {\r\nst.setState(2);\r\n}\r\n}\r\n"]}