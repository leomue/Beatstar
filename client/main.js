process.env.HMR_PORT=0;process.env.HMR_HOSTNAME="localhost";parcelRequire=function(e,r,n){var t="function"==typeof parcelRequire&&parcelRequire,i="function"==typeof require&&require;function u(n,o){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!o&&f)return f(n,!0);if(t)return t(n,!0);if(i&&"string"==typeof n)return i(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}a.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,a,l,l.exports)}return r[n].exports;function a(e){return u(a.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=t;for(var o=0;o<n.length;o++)u(n[o]);return u}({12:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=!0;class t{constructor(e=!1){this.synth=window.speechSynthesis,this.webTTS=e}speak(e){if(this.webTTS){const t=new SpeechSynthesisUtterance(e);this.synth.stop(),this.synth.speak(t)}else{document.getElementById("speech").innerHTML="";const t=document.createElement("p");t.appendChild(document.createTextNode(e)),document.getElementById("speech").appendChild(t)}}setWebTTS(e){this.webTTS=e}}if(void 0===s)var s=new t;exports.TTS=t,exports.speech=s;
},{}],4:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.OldTimer=void 0;var e=require("./tts");class s{constructor(){this.elapsed,this.paused=!1,this.lastTime=0,this.pauseWhen=0,this.started=!0}isActive(){return!paused&started}get elapsed(){return this.paused?this.pauseWhen-this.lastTime:performance.now()-this.lastTime}pause(){this.paused=!0,this.pauseWhen=performance.now()}reset(){this.lastTime=performance.now(),this.pauseWhen=0,this.paused=!1,this.started=!0}restart(){this.lastTime=performance.now(),this.pauseWhen=0,this.paused=!1,this.started=!0}resume(){this.paused=!1,this.started=!0,this.lastTime+=performance.now()-this.pauseWhen}}exports.OldTimer=s;
},{"./tts":12}],21:[function(require,module,exports) {
!function(){"use strict";const e=function(){this.init()};e.prototype={init(){const e=this||n;return e._counter=1e3,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.mobileAutoEnable=!0,e._setup(),e},volume(e){const t=this||n;if(e=parseFloat(e),t.ctx||u(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,n.ctx.currentTime);for(let n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio){const o=t._howls[n]._getSoundIds();for(let r=0;r<o.length;r++){const i=t._howls[n]._soundById(o[r]);i&&i._node&&(i._node.volume=i._volume*e)}}return t}return t._volume},mute(e){const t=this||n;t.ctx||u(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,n.ctx.currentTime);for(let n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio){const o=t._howls[n]._getSoundIds();for(let r=0;r<o.length;r++){const i=t._howls[n]._soundById(o[r]);i&&i._node&&(i._node.muted=!!e||i._muted)}}return t},unload(){const e=this||n;for(let n=e._howls.length-1;n>=0;n--)e._howls[n].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,u()),e},codecs(e){return(this||n)._codecs[e.replace(/^x-/,"")]},_setup(){const e=this||n;if(e.state=e.ctx&&e.ctx.state||"running",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(n){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs(){const e=this||n;let t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(n){return e}if(!t||"function"!=typeof t.canPlayType)return e;const o=t.canPlayType("audio/mpeg;").replace(/^no$/,""),r=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),i=r&&parseInt(r[0].split("/")[1],10)<33;return e._codecs={mp3:Boolean(!i&&(o||t.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:Boolean(o),opus:Boolean(t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")),ogg:Boolean(t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")),oga:Boolean(t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")),wav:Boolean(t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")),aac:Boolean(t.canPlayType("audio/aac;").replace(/^no$/,"")),caf:Boolean(t.canPlayType("audio/x-caf;").replace(/^no$/,"")),m4a:Boolean((t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,"")),mp4:Boolean((t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,"")),weba:Boolean(t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:Boolean(t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:Boolean(t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,"")),flac:Boolean((t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,""))},e},_enableMobileAudio(){const e=this||n,t=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(e._navigator&&e._navigator.userAgent),o=Boolean("ontouchend"in window||e._navigator&&e._navigator.maxTouchPoints>0||e._navigator&&e._navigator.msMaxTouchPoints>0);if(!e._mobileEnabled&&e.ctx&&(t||o)){e._mobileEnabled=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var r=function(){n._autoResume();const t=e.ctx.createBufferSource();t.buffer=e._scratchBuffer,t.connect(e.ctx.destination),void 0===t.start?t.noteOn(0):t.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),t.addEventListener("ended",()=>{t.disconnect(0),e._mobileEnabled=!0,e.mobileAutoEnable=!1,document.removeEventListener("touchstart",r,!0),document.removeEventListener("touchend",r,!0)})};return document.addEventListener("touchstart",r,!0),document.addEventListener("touchend",r,!0),e}},_autoSuspend(){const e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&n.usingWebAudio){for(let n=0;n<e._howls.length;n++)if(e._howls[n]._webAudio)for(let t=0;t<e._howls[n]._sounds.length;t++)if(!e._howls[n]._sounds[t]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(()=>{e.autoSuspend&&(e._suspendTimer=null,e.state="suspending",e.ctx.suspend().then(()=>{e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())}))},3e4),e}},_autoResume(){const e=this;if(e.ctx&&void 0!==e.ctx.resume&&n.usingWebAudio)return"running"===e.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state?(e.ctx.resume().then(()=>{e.state="running";for(let n=0;n<e._howls.length;n++)e._howls[n]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var n=new e;const t=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};t.prototype={init(e){const t=this;return n.ctx||u(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhrWithCredentials=e.xhrWithCredentials||!1,t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onresume=[],t._webAudio=n.usingWebAudio&&!t._html5,void 0!==n.ctx&&n.ctx&&n.mobileAutoEnable&&n._enableMobileAudio(),n._howls.push(t),t._autoplay&&t._queue.push({event:"play",action(){t.play()}}),t._preload&&t.load(),t},load(){const e=this;let t=null;if(n.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(let o=0;o<e._src.length;o++){var r,a;if(e._format&&e._format[o])r=e._format[o];else{if("string"!=typeof(a=e._src[o])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(r=/^data:audio\/([^;,]+);/i.exec(a))||(r=/\.([^.]+)$/.exec(a.split("?",1)[0])),r&&(r=r[1].toLowerCase())}if(r||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),r&&n.codecs(r)){t=e._src[o];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new o(e),e._webAudio&&i(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play(e,t){const o=this;let r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===o._state&&!o._sprite[e])return null;if(void 0===e){e="__default";let n=0;for(let e=0;e<o._sounds.length;e++)o._sounds[e]._paused&&!o._sounds[e]._ended&&(n++,r=o._sounds[e]._id);1===n?e=null:r=null}}const i=r?o._soundById(r):o._inactiveSound();if(!i)return null;if(r&&!e&&(e=i._sprite||"__default"),"loaded"!==o._state){i._sprite=e,i._ended=!1;const n=i._id;return o._queue.push({event:"play",action(){o.play(n)}}),n}if(r&&!i._paused)return t||o._loadQueue("play"),i._id;o._webAudio&&n._autoResume();const a=Math.max(0,i._seek>0?i._seek:o._sprite[e][0]/1e3),s=Math.max(0,(o._sprite[e][0]+o._sprite[e][1])/1e3-a),d=1e3*s/Math.abs(i._rate);i._paused=!1,i._ended=!1,i._sprite=e,i._seek=a,i._start=o._sprite[e][0]/1e3,i._stop=(o._sprite[e][0]+o._sprite[e][1])/1e3,i._loop=Boolean(i._loop||o._sprite[e][2]);const u=i._node;if(o._webAudio){const e=function(){o._refreshBuffer(i);const e=i._muted||o._muted?0:i._volume;u.gain.setValueAtTime(e,n.ctx.currentTime),i._playStart=n.ctx.currentTime,void 0===u.bufferSource.start?i._loop?u.bufferSource.noteGrainOn(0,a,86400):u.bufferSource.noteGrainOn(0,a,s):i._loop?u.bufferSource.start(0,a,86400):u.bufferSource.start(0,a,s),d!==1/0&&(o._endTimers[i._id]=setTimeout(o._ended.bind(o,i),d)),t||setTimeout(()=>{o._emit("play",i._id)},0)};"running"===n.state?e():(o.once("resume",e),o._clearTimer(i._id))}else{const r=function(){u.currentTime=a,u.muted=i._muted||o._muted||n._muted||u.muted,u.volume=i._volume*n.volume(),u.playbackRate=i._rate;try{const n=u.play();if("undefined"!=typeof Promise&&n instanceof Promise){o._playLock=!0;const e=function(){o._playLock=!1,t||o._emit("play",i._id)};n.then(e,e)}else t||o._emit("play",i._id);if(u.paused)return void o._emit("playerror",i._id,"Playback was unable to start. This is most commonly an issue on mobile devices where playback was not within a user interaction.");"__default"!==e?o._endTimers[i._id]=setTimeout(o._ended.bind(o,i),d):(o._endTimers[i._id]=function(){o._ended(i),u.removeEventListener("ended",o._endTimers[i._id],!1)},u.addEventListener("ended",o._endTimers[i._id],!1))}catch(e){o._emit("playerror",i._id,e)}},s=window&&window.ejecta||!u.readyState&&n._navigator.isCocoonJS;if(u.readyState>=3||s)r();else{var _=function(){r(),u.removeEventListener(n._canPlayEvent,_,!1)};u.addEventListener(n._canPlayEvent,_,!1),o._clearTimer(i._id)}}return i._id},pause(e){const n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"pause",action(){n.pause(e)}}),n;const t=n._getSoundIds(e);for(let e=0;e<t.length;e++){n._clearTimer(t[e]);const o=n._soundById(t[e]);if(o&&!o._paused&&(o._seek=n.seek(t[e]),o._rateSeek=0,o._paused=!0,n._stopFade(t[e]),o._node))if(n._webAudio){if(!o._node.bufferSource)continue;void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),n._cleanBuffer(o._node)}else isNaN(o._node.duration)&&o._node.duration!==1/0||o._node.pause();arguments[1]||n._emit("pause",o?o._id:null)}return n},stop(e,n){const t=this;if("loaded"!==t._state)return t._queue.push({event:"stop",action(){t.stop(e)}}),t;const o=t._getSoundIds(e);for(let e=0;e<o.length;e++){t._clearTimer(o[e]);const r=t._soundById(o[e]);r&&(r._seek=r._start||0,r._rateSeek=0,r._paused=!0,r._ended=!0,t._stopFade(o[e]),r._node&&(t._webAudio?r._node.bufferSource&&(void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),t._cleanBuffer(r._node)):isNaN(r._node.duration)&&r._node.duration!==1/0||(r._node.currentTime=r._start||0,r._node.pause())),n||t._emit("stop",r._id))}return t},mute(e,t){const o=this;if("loaded"!==o._state)return o._queue.push({event:"mute",action(){o.mute(e,t)}}),o;if(void 0===t){if("boolean"!=typeof e)return o._muted;o._muted=e}const r=o._getSoundIds(t);for(let t=0;t<r.length;t++){const i=o._soundById(r[t]);i&&(i._muted=e,i._interval&&o._stopFade(i._id),o._webAudio&&i._node?i._node.gain.setValueAtTime(e?0:i._volume,n.ctx.currentTime):i._node&&(i._node.muted=!!n._muted||e),o._emit("mute",i._id))}return o},volume(){const e=this,t=arguments;let o,r,i;if(0===t.length)return e._volume;if(1===t.length||2===t.length&&void 0===t[1]){e._getSoundIds().indexOf(t[0])>=0?r=parseInt(t[0],10):o=parseFloat(t[0])}else t.length>=2&&(o=parseFloat(t[0]),r=parseInt(t[1],10));if(!(void 0!==o&&o>=0&&o<=1))return(i=r?e._soundById(r):e._sounds[0])?i._volume:0;if("loaded"!==e._state)return e._queue.push({event:"volume",action(){e.volume.apply(e,t)}}),e;void 0===r&&(e._volume=o),r=e._getSoundIds(r);for(let a=0;a<r.length;a++)(i=e._soundById(r[a]))&&(i._volume=o,t[2]||e._stopFade(r[a]),e._webAudio&&i._node&&!i._muted?i._node.gain.setValueAtTime(o,n.ctx.currentTime):i._node&&!i._muted&&(i._node.volume=o*n.volume()),e._emit("volume",i._id));return e},fade(e,t,o,r){const i=this;if("loaded"!==i._state)return i._queue.push({event:"fade",action(){i.fade(e,t,o,r)}}),i;i.volume(e,r);const a=i._getSoundIds(r);for(let s=0;s<a.length;s++){const d=i._soundById(a[s]);if(d){if(r||i._stopFade(a[s]),i._webAudio&&!d._muted){const r=n.ctx.currentTime,i=r+o/1e3;d._volume=e,d._node.gain.setValueAtTime(e,r),d._node.gain.linearRampToValueAtTime(t,i)}i._startFadeInterval(d,e,t,o,a[s],void 0===r)}}return i},_startFadeInterval(e,n,t,o,r,i){const a=this;let s=n;const d=t-n,u=Math.abs(d/.01),_=Math.max(4,u>0?o/u:o);let l=Date.now();e._fadeTo=t,e._interval=setInterval(()=>{const r=(Date.now()-l)/o;l=Date.now(),s+=d*r,s=Math.max(0,s),s=Math.min(1,s),s=Math.round(100*s)/100,a._webAudio?e._volume=s:a.volume(s,e._id,!0),i&&(a._volume=s),(t<n&&s<=t||t>n&&s>=t)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,a.volume(t,e._id),a._emit("fade",e._id))},_)},_stopFade(e){const t=this,o=t._soundById(e);return o&&o._interval&&(t._webAudio&&o._node.gain.cancelScheduledValues(n.ctx.currentTime),clearInterval(o._interval),o._interval=null,t.volume(o._fadeTo,e),o._fadeTo=null,t._emit("fade",e)),t},loop(){const e=this,n=arguments;let t,o,r;if(0===n.length)return e._loop;if(1===n.length){if("boolean"!=typeof n[0])return!!(r=e._soundById(parseInt(n[0],10)))&&r._loop;t=n[0],e._loop=t}else 2===n.length&&(t=n[0],o=parseInt(n[1],10));const i=e._getSoundIds(o);for(let n=0;n<i.length;n++)(r=e._soundById(i[n]))&&(r._loop=t,e._webAudio&&r._node&&r._node.bufferSource&&(r._node.bufferSource.loop=t,t&&(r._node.bufferSource.loopStart=r._start||0,r._node.bufferSource.loopEnd=r._stop)));return e},rate(){const e=this,t=arguments;let o,r,i;if(0===t.length)r=e._sounds[0]._id;else if(1===t.length){e._getSoundIds().indexOf(t[0])>=0?r=parseInt(t[0],10):o=parseFloat(t[0])}else 2===t.length&&(o=parseFloat(t[0]),r=parseInt(t[1],10));if("number"!=typeof o)return(i=e._soundById(r))?i._rate:e._rate;if("loaded"!==e._state)return e._queue.push({event:"rate",action(){e.rate.apply(e,t)}}),e;void 0===r&&(e._rate=o),r=e._getSoundIds(r);for(let t=0;t<r.length;t++)if(i=e._soundById(r[t])){i._rateSeek=e.seek(r[t]),i._playStart=e._webAudio?n.ctx.currentTime:i._playStart,i._rate=o,e._webAudio&&i._node&&i._node.bufferSource?i._node.bufferSource.playbackRate.setValueAtTime(o,n.ctx.currentTime):i._node&&(i._node.playbackRate=o);const a=e.seek(r[t]),s=1e3*((e._sprite[i._sprite][0]+e._sprite[i._sprite][1])/1e3-a)/Math.abs(i._rate);!e._endTimers[r[t]]&&i._paused||(e._clearTimer(r[t]),e._endTimers[r[t]]=setTimeout(e._ended.bind(e,i),s)),e._emit("rate",i._id)}return e},seek(){const e=this,t=arguments;let o,r;if(0===t.length)r=e._sounds[0]._id;else if(1===t.length){e._getSoundIds().indexOf(t[0])>=0?r=parseInt(t[0],10):e._sounds.length&&(r=e._sounds[0]._id,o=parseFloat(t[0]))}else 2===t.length&&(o=parseFloat(t[0]),r=parseInt(t[1],10));if(void 0===r)return e;if("loaded"!==e._state)return e._queue.push({event:"seek",action(){e.seek.apply(e,t)}}),e;const i=e._soundById(r);if(i){if(!("number"==typeof o&&o>=0)){if(e._webAudio){const t=e.playing(r)?n.ctx.currentTime-i._playStart:0,o=i._rateSeek?i._rateSeek-i._seek:0;return i._seek+(o+t*Math.abs(i._rate))}return i._node.currentTime}{const n=e.playing(r);if(n&&e.pause(r,!0),i._seek=o,i._ended=!1,e._clearTimer(r),n&&e.play(r,!0),!e._webAudio&&i._node&&(i._node.currentTime=o),n&&!e._webAudio){var a=function(){e._playLock?setTimeout(a,0):e._emit("seek",r)};setTimeout(a,0)}else e._emit("seek",r)}}return e},playing(e){const n=this;if("number"==typeof e){const t=n._soundById(e);return!!t&&!t._paused}for(let e=0;e<n._sounds.length;e++)if(!n._sounds[e]._paused)return!0;return!1},duration(e){const n=this;let t=n._duration;const o=n._soundById(e);return o&&(t=n._sprite[o._sprite][1]/1e3),t},state(){return this._state},unload(){let e=this;const t=e._sounds;for(var o=0;o<t.length;o++){if(t[o]._paused||e.stop(t[o]._id),!e._webAudio){/MSIE |Trident\//.test(n._navigator&&n._navigator.userAgent)||(t[o]._node.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"),t[o]._node.removeEventListener("error",t[o]._errorFn,!1),t[o]._node.removeEventListener(n._canPlayEvent,t[o]._loadFn,!1)}delete t[o]._node,e._clearTimer(t[o]._id);const r=n._howls.indexOf(e);r>=0&&n._howls.splice(r,1)}let i=!0;for(o=0;o<n._howls.length;o++)if(n._howls[o]._src===e._src){i=!1;break}return r&&i&&delete r[e._src],n.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on(e,n,t,o){const r=this["_on"+e];return"function"==typeof n&&r.push(o?{id:t,fn:n,once:o}:{id:t,fn:n}),this},off(e,n,t){const o=this,r=o["_on"+e];let i=0;if("number"==typeof n&&(t=n,n=null),n||t)for(i=0;i<r.length;i++){const e=t===r[i].id;if(n===r[i].fn&&e||!n&&e){r.splice(i,1);break}}else if(e)o["_on"+e]=[];else{const e=Object.keys(o);for(i=0;i<e.length;i++)0===e[i].indexOf("_on")&&Array.isArray(o[e[i]])&&(o[e[i]]=[])}return o},once(e,n,t){return this.on(e,n,t,1),this},_emit(e,n,t){const o=this,r=o["_on"+e];for(let i=r.length-1;i>=0;i--)r[i].id&&r[i].id!==n&&"load"!==e||(setTimeout(function(e){e.call(this,n,t)}.bind(o,r[i].fn),0),r[i].once&&o.off(e,r[i].fn,r[i].id));return o._loadQueue(e),o},_loadQueue(e){const n=this;if(n._queue.length>0){const t=n._queue[0];t.event===e&&(n._queue.shift(),n._loadQueue()),e||t.action()}return n},_ended(e){const t=this,o=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;const r=Boolean(e._loop||t._sprite[o][2]);if(t._emit("end",e._id),!t._webAudio&&r&&t.stop(e._id,!0).play(e._id),t._webAudio&&r){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=n.ctx.currentTime;const o=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),o)}return t._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),n._autoSuspend()),t._webAudio||r||t.stop(e._id),t},_clearTimer(e){const n=this;if(n._endTimers[e]){if("function"!=typeof n._endTimers[e])clearTimeout(n._endTimers[e]);else{const t=n._soundById(e);t&&t._node&&t._node.removeEventListener("ended",n._endTimers[e],!1)}delete n._endTimers[e]}return n},_soundById(e){const n=this;for(let t=0;t<n._sounds.length;t++)if(e===n._sounds[t]._id)return n._sounds[t];return null},_inactiveSound(){const e=this;e._drain();for(let n=0;n<e._sounds.length;n++)if(e._sounds[n]._ended)return e._sounds[n].reset();return new o(e)},_drain(){const e=this,n=e._pool;let t=0,o=0;if(!(e._sounds.length<n)){for(o=0;o<e._sounds.length;o++)e._sounds[o]._ended&&t++;for(o=e._sounds.length-1;o>=0;o--){if(t<=n)return;e._sounds[o]._ended&&(e._webAudio&&e._sounds[o]._node&&e._sounds[o]._node.disconnect(0),e._sounds.splice(o,1),t--)}}},_getSoundIds(e){const n=this;if(void 0===e){const e=[];for(let t=0;t<n._sounds.length;t++)e.push(n._sounds[t]._id);return e}return[e]},_refreshBuffer(e){return e._node.bufferSource=n.ctx.createBufferSource(),e._node.bufferSource.buffer=r[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,n.ctx.currentTime),this},_cleanBuffer(e){if(n._scratchBuffer){e.bufferSource.addEventListener("ended",null),e.bufferSource.disconnect(0);try{e.bufferSource.buffer=n._scratchBuffer}catch(e){}}return e.bufferSource=null,this}};var o=function(e){this._parent=e,this.init()};o.prototype={init(){const e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++n._counter,e._sounds.push(this),this.create(),this},create(){const e=this,t=e._parent,o=n._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),e._node.gain.setValueAtTime(o,n.ctx.currentTime),e._node.paused=!0,e._node.connect(n.masterGain)):(e._node=new Audio,e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(n._canPlayEvent,e._loadFn,!1),e._node.src=t._src,e._node.preload="auto",e._node.volume=o*n.volume(),e._node.load()),e},reset(){const e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._rateSeek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++n._counter,this},_errorListener(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener(){const e=this._parent;e._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),this._node.removeEventListener(n._canPlayEvent,this._loadFn,!1)}};var r={},i=function(e){const n=e._src;if(r[n])return e._duration=r[n].duration,void d(e);if(/^data:[^;]+;base64,/.test(n)){const t=atob(n.split(",")[1]),o=new Uint8Array(t.length);for(let e=0;e<t.length;++e)o[e]=t.charCodeAt(e);s(o.buffer,e)}else{const t=new XMLHttpRequest;t.open("GET",n,!0),t.withCredentials=e._xhrWithCredentials,t.responseType="arraybuffer",t.addEventListener("load",()=>{const n=String(t.status)[0];"0"===n||"2"===n||"3"===n?s(t.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+t.status+".")}),t.addEventListener("error",()=>{e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete r[n],e.load())}),a(t)}},a=function(e){try{e.send()}catch(n){e.onerror()}},s=function(e,t){n.ctx.decodeAudioData(e,e=>{e&&t._sounds.length>0&&(r[t._src]=e,d(t,e))},()=>{t._emit("loaderror",null,"Decoding audio data failed.")})},d=function(e,n){n&&!e._duration&&(e._duration=n.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},u=function(){try{"undefined"!=typeof AudioContext?n.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?n.ctx=new webkitAudioContext:n.usingWebAudio=!1}catch(e){n.usingWebAudio=!1}const e=/iP(hone|od|ad)/.test(n._navigator&&n._navigator.platform),t=n._navigator&&n._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),o=t?parseInt(t[1],10):null;if(e&&o&&o<9){const e=/safari/.test(n._navigator&&n._navigator.userAgent.toLowerCase());(n._navigator&&n._navigator.standalone&&!e||n._navigator&&!n._navigator.standalone&&!e)&&(n.usingWebAudio=!1)}n.usingWebAudio&&(n.masterGain=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),n.masterGain.gain.setValueAtTime(n._muted?0:1,n.ctx.currentTime),n.masterGain.connect(n.ctx.destination)),n._setup()};"function"==typeof define&&define.amd&&define([],()=>({Howler:n,Howl:t})),"undefined"!=typeof window?(window.HowlerGlobal=e,window.Howler=n,window.Howl=t,window.Sound=o):"undefined"!=typeof global&&(global.HowlerGlobal=e,global.Howler=n,global.Howl=t,global.Sound=o)}(),function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){const n=this;if(!n.ctx||!n.ctx.listener)return n;for(let t=n._howls.length-1;t>=0;t--)n._howls[t].stereo(e);return n},HowlerGlobal.prototype.pos=function(e,n,t){const o=this;return o.ctx&&o.ctx.listener?(n="number"!=typeof n?o._pos[1]:n,t="number"!=typeof t?o._pos[2]:t,"number"!=typeof e?o._pos:(o._pos=[e,n,t],o.ctx.listener.setPosition(o._pos[0],o._pos[1],o._pos[2]),o)):o},HowlerGlobal.prototype.orientation=function(e,n,t,o,r,i){const a=this;if(!a.ctx||!a.ctx.listener)return a;const s=a._orientation;return n="number"!=typeof n?s[1]:n,t="number"!=typeof t?s[2]:t,o="number"!=typeof o?s[3]:o,r="number"!=typeof r?s[4]:r,i="number"!=typeof i?s[5]:i,"number"!=typeof e?s:(a._orientation=[e,n,t,o,r,i],a.ctx.listener.setOrientation(e,n,t,o,r,i),a)},Howl.prototype.init=(e=Howl.prototype.init,function(n){return this._orientation=n.orientation||[1,0,0],this._stereo=n.stereo||null,this._pos=n.pos||null,this._pannerAttr={coneInnerAngle:void 0!==n.coneInnerAngle?n.coneInnerAngle:360,coneOuterAngle:void 0!==n.coneOuterAngle?n.coneOuterAngle:360,coneOuterGain:void 0!==n.coneOuterGain?n.coneOuterGain:0,distanceModel:void 0!==n.distanceModel?n.distanceModel:"inverse",maxDistance:void 0!==n.maxDistance?n.maxDistance:1e4,panningModel:void 0!==n.panningModel?n.panningModel:"HRTF",refDistance:void 0!==n.refDistance?n.refDistance:1,rolloffFactor:void 0!==n.rolloffFactor?n.rolloffFactor:1},this._onstereo=n.onstereo?[{fn:n.onstereo}]:[],this._onpos=n.onpos?[{fn:n.onpos}]:[],this._onorientation=n.onorientation?[{fn:n.onorientation}]:[],e.call(this,n)}),Howl.prototype.stereo=function(e,t){const o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"stereo",action(){o.stereo(e,t)}}),o;const r=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===t){if("number"!=typeof e)return o._stereo;o._stereo=e,o._pos=[e,0,0]}const i=o._getSoundIds(t);for(let t=0;t<i.length;t++){const a=o._soundById(i[t]);if(a){if("number"!=typeof e)return a._stereo;a._stereo=e,a._pos=[e,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||n(a,r),"spatial"===r?a._panner.setPosition(e,0,0):a._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),o._emit("stereo",a._id)}}return o},Howl.prototype.pos=function(e,t,o,r){const i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"pos",action(){i.pos(e,t,o,r)}}),i;if(t="number"!=typeof t?0:t,o="number"!=typeof o?-.5:o,void 0===r){if("number"!=typeof e)return i._pos;i._pos=[e,t,o]}const a=i._getSoundIds(r);for(let r=0;r<a.length;r++){const s=i._soundById(a[r]);if(s){if("number"!=typeof e)return s._pos;s._pos=[e,t,o],s._node&&(s._panner&&!s._panner.pan||n(s,"spatial"),s._panner.setPosition(e,t,o)),i._emit("pos",s._id)}}return i},Howl.prototype.orientation=function(e,t,o,r){const i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"orientation",action(){i.orientation(e,t,o,r)}}),i;if(t="number"!=typeof t?i._orientation[1]:t,o="number"!=typeof o?i._orientation[2]:o,void 0===r){if("number"!=typeof e)return i._orientation;i._orientation=[e,t,o]}const a=i._getSoundIds(r);for(let r=0;r<a.length;r++){const s=i._soundById(a[r]);if(s){if("number"!=typeof e)return s._orientation;s._orientation=[e,t,o],s._node&&(s._panner||(s._pos||(s._pos=i._pos||[0,0,-.5]),n(s,"spatial")),s._panner.setOrientation(e,t,o)),i._emit("orientation",s._id)}}return i},Howl.prototype.pannerAttr=function(){const e=this,t=arguments;let o,r,i;if(!e._webAudio)return e;if(0===t.length)return e._pannerAttr;if(1===t.length){if("object"!=typeof t[0])return(i=e._soundById(parseInt(t[0],10)))?i._pannerAttr:e._pannerAttr;o=t[0],void 0===r&&(o.pannerAttr||(o.pannerAttr={coneInnerAngle:o.coneInnerAngle,coneOuterAngle:o.coneOuterAngle,coneOuterGain:o.coneOuterGain,distanceModel:o.distanceModel,maxDistance:o.maxDistance,refDistance:o.refDistance,rolloffFactor:o.rolloffFactor,panningModel:o.panningModel}),e._pannerAttr={coneInnerAngle:void 0!==o.pannerAttr.coneInnerAngle?o.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:void 0!==o.pannerAttr.coneOuterAngle?o.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:void 0!==o.pannerAttr.coneOuterGain?o.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:void 0!==o.pannerAttr.distanceModel?o.pannerAttr.distanceModel:e._distanceModel,maxDistance:void 0!==o.pannerAttr.maxDistance?o.pannerAttr.maxDistance:e._maxDistance,refDistance:void 0!==o.pannerAttr.refDistance?o.pannerAttr.refDistance:e._refDistance,rolloffFactor:void 0!==o.pannerAttr.rolloffFactor?o.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:void 0!==o.pannerAttr.panningModel?o.pannerAttr.panningModel:e._panningModel})}else 2===t.length&&(o=t[0],r=parseInt(t[1],10));const a=e._getSoundIds(r);for(let t=0;t<a.length;t++)if(i=e._soundById(a[t])){let t=i._pannerAttr;t={coneInnerAngle:void 0!==o.coneInnerAngle?o.coneInnerAngle:t.coneInnerAngle,coneOuterAngle:void 0!==o.coneOuterAngle?o.coneOuterAngle:t.coneOuterAngle,coneOuterGain:void 0!==o.coneOuterGain?o.coneOuterGain:t.coneOuterGain,distanceModel:void 0!==o.distanceModel?o.distanceModel:t.distanceModel,maxDistance:void 0!==o.maxDistance?o.maxDistance:t.maxDistance,refDistance:void 0!==o.refDistance?o.refDistance:t.refDistance,rolloffFactor:void 0!==o.rolloffFactor?o.rolloffFactor:t.rolloffFactor,panningModel:void 0!==o.panningModel?o.panningModel:t.panningModel};const r=i._panner;r?(r.coneInnerAngle=t.coneInnerAngle,r.coneOuterAngle=t.coneOuterAngle,r.coneOuterGain=t.coneOuterGain,r.distanceModel=t.distanceModel,r.maxDistance=t.maxDistance,r.refDistance=t.refDistance,r.rolloffFactor=t.rolloffFactor,r.panningModel=t.panningModel):(i._pos||(i._pos=e._pos||[0,0,-.5]),n(i,"spatial"))}return e},Sound.prototype.init=function(e){return function(){const n=this,t=n._parent;n._orientation=t._orientation,n._stereo=t._stereo,n._pos=t._pos,n._pannerAttr=t._pannerAttr,e.call(this),n._stereo?t.stereo(n._stereo):n._pos&&t.pos(n._pos[0],n._pos[1],n._pos[2],n._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){const n=this._parent;return this._orientation=n._orientation,this._pos=n._pos,this._pannerAttr=n._pannerAttr,e.call(this)}}(Sound.prototype.reset);var n=function(e,n){"spatial"===(n=n||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}(),"undefined"!=typeof exports&&(exports.Howler=Howler,exports.Howl=Howl);
},{}],3:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.KeyboardInput=void 0;var e=require("jquery"),s=h(e),t=require("./tts");function h(e){return e&&e.__esModule?e:{default:e}}class r{constructor(){this.keyDown=[],this.justPressed=[],this.chars=[],this.justReleased=[],this.justPressedEventCallback=null,this.charEventCallback=null}init(){const e=this;document.addEventListener("keydown",s=>{e.handleKeyDown(s)}),document.addEventListener("keyup",s=>{e.handleKeyUp(s)}),document.addEventListener("keypress",s=>{e.handleChar(s)})}handleKeyDown(e){1==this.keyDown[e.which]&&void 0!==this.keyDown[e.which]||(this.keyDown[e.which]=!0,this.justPressed[e.which]=!0,this.justReleased[e.which]=!1,void 0!==this.justPressedEventCallback&&null!=this.justPressedEventCallback&&this.justPressedEventCallback(e.which))}handleChar(e){e.which<48||e.which>122||""!=String.fromCharCode(e.which)&&(this.chars+=String.fromCharCode(e.which),void 0!==this.charEventCallback&&null!=this.charEventCallback&&this.charEventCallback(String.fromCharCode(e.which)))}handleKeyUp(e){1==this.keyDown[e.which]&&(this.keyDown[e.which]=!1,this.justPressed[e.which]=!1,this.justReleased[e.which]=!0),this.chars=""}isDown(e){return this.keyDown[e]}isJustPressed(e){return 1==this.justPressed[e]&&(this.justPressed[e]=!1,!0)}isJustReleased(e){return!!this.justReleased[e]&&(this.justReleased[e]=!1,!0)}keysDown(){const e=[];return this.keyDown.forEach((s,t)=>{s&&e.push(t)}),e}getChars(){const e=this.chars;return this.chars="",e}keysPressed(){const e=[];return this.justPressed.forEach((s,t)=>{s&&e.push(t)}),this.justPressed.splice(),e}releaseAllKeys(){}keysReleased(){const e=[];return this.justReleased.forEach((s,t)=>{s&&e.push(t)}),this.justReleased.splice(),e}}exports.KeyboardInput=r;
},{"./tts":12}],15:[function(require,module,exports) {
"use strict";if(Object.defineProperty(exports,"__esModule",{value:!0}),void 0===_)var _={DOM_VK_CANCEL:3,DOM_VK_HELP:6,DOM_VK_BACK_SPACE:8,DOM_VK_TAB:9,DOM_VK_CLEAR:12,DOM_VK_RETURN:13,DOM_VK_ENTER:14,DOM_VK_SHIFT:16,DOM_VK_CONTROL:17,DOM_VK_ALT:18,DOM_VK_PAUSE:19,DOM_VK_CAPS_LOCK:20,DOM_VK_ESCAPE:27,DOM_VK_SPACE:32,DOM_VK_PAGE_UP:33,DOM_VK_PAGE_DOWN:34,DOM_VK_END:35,DOM_VK_HOME:36,DOM_VK_LEFT:37,DOM_VK_UP:38,DOM_VK_RIGHT:39,DOM_VK_DOWN:40,DOM_VK_PRINTSCREEN:44,DOM_VK_INSERT:45,DOM_VK_DELETE:46,DOM_VK_0:48,DOM_VK_1:49,DOM_VK_2:50,DOM_VK_3:51,DOM_VK_4:52,DOM_VK_5:53,DOM_VK_6:54,DOM_VK_7:55,DOM_VK_8:56,DOM_VK_9:57,DOM_VK_SEMICOLON:59,DOM_VK_EQUALS:61,DOM_VK_A:65,DOM_VK_B:66,DOM_VK_C:67,DOM_VK_D:68,DOM_VK_E:69,DOM_VK_F:70,DOM_VK_G:71,DOM_VK_H:72,DOM_VK_I:73,DOM_VK_J:74,DOM_VK_K:75,DOM_VK_L:76,DOM_VK_M:77,DOM_VK_N:78,DOM_VK_O:79,DOM_VK_P:80,DOM_VK_Q:81,DOM_VK_R:82,DOM_VK_S:83,DOM_VK_T:84,DOM_VK_U:85,DOM_VK_V:86,DOM_VK_W:87,DOM_VK_X:88,DOM_VK_Y:89,DOM_VK_Z:90,DOM_VK_CONTEXT_MENU:93,DOM_VK_NUMPAD0:96,DOM_VK_NUMPAD1:97,DOM_VK_NUMPAD2:98,DOM_VK_NUMPAD3:99,DOM_VK_NUMPAD4:100,DOM_VK_NUMPAD5:101,DOM_VK_NUMPAD6:102,DOM_VK_NUMPAD7:103,DOM_VK_NUMPAD8:104,DOM_VK_NUMPAD9:105,DOM_VK_MULTIPLY:106,DOM_VK_ADD:107,DOM_VK_SEPARATOR:108,DOM_VK_SUBTRACT:109,DOM_VK_DECIMAL:110,DOM_VK_DIVIDE:111,DOM_VK_F1:112,DOM_VK_F2:113,DOM_VK_F3:114,DOM_VK_F4:115,DOM_VK_F5:116,DOM_VK_F6:117,DOM_VK_F7:118,DOM_VK_F8:119,DOM_VK_F9:120,DOM_VK_F10:121,DOM_VK_F11:122,DOM_VK_F12:123,DOM_VK_F13:124,DOM_VK_F14:125,DOM_VK_F15:126,DOM_VK_F16:127,DOM_VK_F17:128,DOM_VK_F18:129,DOM_VK_F19:130,DOM_VK_F20:131,DOM_VK_F21:132,DOM_VK_F22:133,DOM_VK_F23:134,DOM_VK_F24:135,DOM_VK_NUM_LOCK:144,DOM_VK_SCROLL_LOCK:145,DOM_VK_COMMA:188,DOM_VK_PERIOD:190,DOM_VK_SLASH:191,DOM_VK_BACK_QUOTE:192,DOM_VK_OPEN_BRACKET:219,DOM_VK_BACK_SLASH:220,DOM_VK_CLOSE_BRACKET:221,DOM_VK_QUOTE:222,DOM_VK_META:224};exports.KeyEvent=_;
},{}],13:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class e{progressPan(e,r){return(200*e/r-100)/100}progressPitch(e,r){return 200*e/r/100}distance3D(e,r,t,n,a,h){return Math.sqrt((n-e)*(n-e)+(a-r)*(a-r)+(h-t)*(h-t))}distance(e,r,t,n){return Math.sqrt((e-t)*(e-t)+(r-n)*(r-n))}calculateAngle(e,r,t,n){let a=Math.atan2(n-r,t-e);return a=a>=0?0:2*Math.PI+a}isCollide3D(e,r){return e.x<=r.x+r.width&&e.x+e.width>=r.x&&e.y<=r.y+r.height&&e.y+e.height>=r.y&&e.z<=r.z+r.depth&&e.z+e.depth>=r.z}randomInt(e,r){return Math.floor(Math.random()*(r-e+1))+e}getRandomArbitrary(e,r){return Math.random()*(r-e)+e}sleep(e){return new Promise(r=>setTimeout(r,e))}percent(e,r){return 100*e/r}percentOf(e,r){return r*e/100}average(e,r=0){let t=e.length,n=0,a=0;if(e.length<r)return-1;for(let t=r;t<e.length;t++)n+=e[t];return a=n/(t-r)}averageInt(e,r=0){let t=e.length,n=0,a=0;if(e.length<r)return-1;for(let t=r;t<e.length;t++)n+=e[t];return a=n/(t-r),Math.floor(a)}neg(e){return e>=0?0==e?0:1:-1}numericSort(e,r){return e<r?-1:e==r?0:1}shuffle(e){for(let r=e.length-1;r>0;r--){const t=Math.floor(Math.random()*(r+1));[e[r],e[t]]=[e[t],e[r]]}return e}objSize(e){var r,t=0;for(r in e)e.hasOwnProperty(r)&&t++;return t}}var r=exports.utils=new e;
},{}],14:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.so=void 0;var s=require("./howler"),e=require("./input"),t=require("./keycodes"),o=require("./utilities"),n=require("./tts");const u=!0;let i;class d{constructor(e,t=0,o=0,n=!1){const u=this;this.fileName=e,this.sound=new s.Howl({src:e,html5:n,onload(){u.doneLoading()}}),this.timeout=setTimeout(()=>{u.checkProgress()},2e3),this.loaded=!1,this.callback=t,this.timeToLoad=performance.now(),this.tag=o}checkProgress(){if("loaded"==this.sound.state())this.doneLoading();else{const s=this;this.timeout=setTimeout(()=>{s.checkProgress()},500)}}doneLoading(){clearTimeout(this.timeout),this.loaded=!0,0!=this.callback&&this.callback()}play(){this.sound.play()}playSync(){let s=new e.KeyboardInput;return s.init(),this.sound.play(),s.justPressedEventCallback=(e=>{e!=t.KeyEvent.DOM_VK_Q&&e!=t.KeyEvent.DOM_VK_X||(this.sound.stop(),s.justPressedEventCallback=null)}),new Promise((e,t)=>{this.sound.once("end",()=>{this.sound.unload(),e("ok"),s.justPressedEventCallback=null}),this.sound.once("stop",()=>{this.sound.unload(),e("ok"),s.justPressedEventCallback=null})})}stop(){this.sound.stop()}pause(){this.sound.pause()}destroy(){this.sound.unload()}unload(){this.sound.unload()}get volume(){return this.sound.volume()}set volume(s){return this.sound.volume(s)}get pan(){return this.sound.stereo()}set pan(s){return this.sound.stereo(s)}set loop(s){return this.sound.loop(s)}get active(){return"unloaded"!=this.sound.state()&&("loaded"==this.sound.state()||("loading"==this.sound.state()||void 0))}get loop(){return this.sound.loop()}get playing(){return this.sound.playing()}get playbackRate(){return this.sound.rate()}set playbackRate(s){return this.sound.rate(s)}get pitch(){return this.sound.rate()}set pitch(s){return this.sound.rate(s)}get currentTime(){return this.sound.seek()}get duration(){return 1e3*this.sound.duration()}get position(){return this.sound.seek()}set currentTime(s){return this.sound.seek(s)}seek(s){return this.sound.seek(s)}}class h{constructor(){this.sounds=new Array,this.oneShots=new Array,this.debug=!1,this.loadingQueue=!1,this.queueCallback=0,this.loadedSounds=0,this.loadingSounds=0,this.loadedCallback=0,this.queue=new Array,this.queueLength=0,this.statusCallback=null,this.extension=".ogg",1==u?this.directory="./sounds/":(this.directory="../soundsopus/",this.extension=".opus"),this.oneShotSound=null}setStatusCallback(s){this.statusCallback=s}findSound(s){for(const e in this.sounds)if(this.sounds[e].fileName==s)return this.sounds[e];return-1}findSoundIndex(s){for(const e in this.sounds)if(this.sounds[e].fileName==s)return e;return-1}resetQueuedInstance(){for(let s=0;s<this.sounds.length;s++)void 0!==this.sounds[s]&&1==this.sounds[s].tag&&(this.sounds[s].sound.unload(),this.sounds.splice(s,1));this.loadingQueue=!1,this.queueCallback=0,this.loadedSounds=0,this.loadingSounds=0,this.loadedCallback=0,this.queue=new Array,this.queueLength=0,this.statusCallback=null}create(s,e=!1){s=this.directory+s+this.extension;let t=null;const o=this;return t=new d(s,()=>{o.doneLoading()},0,e),this.sounds.push(t),t}enqueue(s){s=this.directory+s+this.extension,this.queue.push(s),this.queueLength=this.queue.length}loadQueue(){this.handleQueue(),this.loadingQueue=!0}setQueueCallback(s){this.queueCallback=s}resetQueue(){this.queue=new Array,this.loadingQueue=!1}handleQueue(){if(this.queue.length>0){const s=this;if(void 0!==this.statusCallback&&null!=this.statusCallback&&this.statusCallback(1-this.queue.length/this.queueLength),-1!=this.findSound(this.queue[0]))return this.queue.splice(0,1),void this.handleQueue();this.sounds.push(new d(this.queue[0],()=>{s.handleQueue()},1)),this.queue.splice(0,1)}else this.loadingQueue=!1,void 0!==this.queueCallback&&0!=this.queueCallback&&this.queueCallback()}setCallback(s){this.loadedCallback=s}doneLoading(){1==this.isLoading()&&void 0!==this.loadedCallback&&0!=this.loadedCallback&&null!=this.loadedCallback&&this.loadedCallback()}isLoading(){this.loadedSounds=0,this.loadingSounds=0;new Array;for(let s=0;s<this.sounds.length;s++)void 0!==this.sounds[s]&&(0==this.sounds[s].loaded?this.loadingSounds++:this.loadedSounds++);return this.loadedSounds/this.sounds.length}playOnce(s){this.oneShotSound=l.create(s),this.oneShots.push(this.oneShotSound),this.oneShotSound.play();const e=new Array,t=this;this.oneShotSound.on("ended",()=>{for(var s=0;s<t.oneShots.length;s++)0==t.oneShots[s].playing&&(t.oneShots[s].unload(),e.push(s));for(s=0;s<e.length;s++)0==t.oneShotSounds[s].playing&&(t.oneShotSounds.splice(e[s],1),n.speech.speak("destroyed."+e[s]))})}destroy(s,e=0){let t=!1;const o=this.directory+s+this.extension;for(;!t;){const s=this.findSoundIndex(o);-1==s?t=!0:(this.sounds[s].sound.unload(),this.sounds.splice(s,1))}0!=e&&e()}kill(e=0){for(;this.sounds.length>0;)this.sounds.splice(0,1);s.Howler.unload(),0!=e&&e()}}const l=new h;exports.so=l;
},{"./howler":21,"./input":3,"./keycodes":15,"./utilities":13,"./tts":12}],20:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SoundSource=void 0;var t=require("./howler"),s=require("./soundObject.js");class e{constructor(t,e=0,i=0,h=0,o=!0){this.x=e,this.y=i,this.z=h,this.loop=o,this.sound=s.so.create(t),this.sound.loop=o,this.sound.pos(this.x,this.y,this.z),this.rate=1,this.speed=0,this.minRate=.8,this.maxRate=1.2,this.toDestroy=!1,this.rateShiftSpeed=.015,this.sound.currentPosition=0}play(){this.sound.play()}pos(t,s,e){this.x=t,this.y=s,this.z=e,this.sound.pos(this.x,this.y,this.z)}update(){}setDoppler(t,s,e){if(s>=0)if(-1==e){var i=44100*(1-(s+=this.speed)/240);this.rate=i/44100}else{i=44100/(1-(s+=this.speed)/240);this.rate=i/44100}else this.rate=1;this.rate>this.sound.playbackRate+this.rateShiftSpeed?this.sound.playbackRate+=this.rateShiftSpeed:this.rate<this.sound.playbackRate-this.rateShiftSpeed&&(this.sound.playbackRate-=this.rateShiftSpeed)}setSpeed(t){this.speed=t}destroy(){this.sound.unload(),this.toDestroy=!0}}exports.SoundSource=e;
},{"./howler":21,"./soundObject.js":14}],11:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SoundHandler=void 0;var t=require("./soundSource.js"),i=require("./soundObject.js");class s{constructor(t=!1){this.staticSounds=[],this.dynamicSounds=[],this.currentDynamicSound=0,this.maxDynamicSounds=512,this.currentStaticSound=0,this.maxStaticSounds=512,this.reuseSounds=!0,this.x=0,this.y=0,this.z=0,this.directional=t}playStatic(t,i=1,s=-1,d=!1){return(s=-1)&&(s=this.findFreeStaticSlot()),this.staticSounds[s]=new n(t,this.directional,d),1==i&&(this.staticSounds[s].sound.loop=!0),this.staticSounds[s].sound.play(),s}findFreeStaticSlot(){for(let t=0;t<this.maxStaticSounds;t++)if(-1==this.staticSounds[t]||void 0===this.staticSounds[t])return t;return this.currentStaticSound<this.maxStaticSounds?(this.currentStaticSound++,this.currentStaticSound):(this.currentStaticSound=0,this.currentStaticSound)}findFreeDynamicSlot(){for(let t=0;t<this.maxDynamicSounds;t++)if(-1==this.dynamicSounds[t]||void 0===this.dynamicSounds[t])return t;return this.currentDynamicSound<this.maxDynamicSounds?(this.currentDynamicSound++,this.currentDynamicSound):(this.currentDynamicSound=0,this.currentDynamicSound)}findDynamicSound(t){for(let i=0;i<this.dynamicSounds.length;i++)if(this.dynamicSounds[i].file==t)return i;return-1}play(t){let i=0,s=0;this.reuseSounds&&(i=this.findDynamicSound(t),s=!0),-1!=i&&0!=this.reuseSounds||(i=this.findFreeDynamicSlot(),s=!1),void 0===this.dynamicSounds[i]?0==s&&(this.dynamicSounds[i]=new n(t,this.directional)):0==s&&(this.dynamicSounds[i].sound.destroy(),this.dynamicSounds[i]=new n(t,directional)),this.dynamicSounds[i].sound.play()}update(t){if(1==this.directional)for(let i=0;i<this.dynamicSounds.length;i++)this.dynamicSounds[i].sound.pos(t.x,t.y,t.z)}destroy(){for(var t=0;t<this.dynamicSounds.length;t++)this.dynamicSounds[t].destroy(),this.dynamicSounds.splice(t,1);for(t=0;t<this.staticSounds.length;t++)this.staticSounds[t].destroy(),this.staticSounds.splice(t,1)}}class n{constructor(s,n=!1,d=!1){this.file=s,this.threeD=n,1==this.threeD?this.sound=new t.SoundSource(s,0,0,0):this.sound=i.so.create(s,d)}destroy(){this.sound.destroy()}}exports.SoundHandler=s;
},{"./soundSource.js":20,"./soundObject.js":14}],6:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MenuTypes=exports.SelectorItem=exports.SliderItem=exports.MenuItem=void 0;var t=require("./tts");if(void 0===e)var e=new t.TTS;const s={NORMAL:0,SELECTOR:1,SLIDER:2,EDIT:3};class i{constructor(t,e){this.name=e,this.id=t,this.type=s.NORMAL}speak(){e.speak(this.name)}select(){return this.id}}class r extends i{constructor(t,e,i,r=0,n){super(),this.id=t,this.name=e,this.options=i,this.type=s.SELECTOR,this.currentOption=r,this.selectCallback=n}speak(){e.speak(this.name+". Selector. Set to "+this.options[this.currentOption])}increase(){this.currentOption<this.options.length-1&&this.currentOption++,e.speak(this.options[this.currentOption]),void 0!==this.selectCallback&&this.selectCallback(this.options[this.currentOption])}decrease(){this.currentOption>0&&this.currentOption--,e.speak(this.options[this.currentOption]),void 0!==this.selectCallback&&this.selectCallback(this.options[this.currentOption])}select(){return this.id}}class n extends i{constructor(t,e,i,r,n=0,h=1){super(),this.id=t,this.name=e,this.minValue=i,this.maxValue=r,this.currentValue=n,this.increaseBy=h,this.type=s.SLIDER}speak(){e.speak(this.name+". Slider. Set to "+this.currentValue)}increase(){this.currentValue<this.maxValue&&(this.currentValue+=this.increaseBy),this.currentValue>this.maxValue&&(this.currentValue=this.maxValue),e.speak(this.currentValue)}decrease(){this.currentValue>this.minValue&&(this.currentValue-=this.increaseBy),this.currentValue<this.minValue&&(this.currentValue=this.minValue),e.speak(this.currentValue)}select(){return this.id}}class h extends i{constructor(t,e,i=""){super(),this.id=t,this.name=e,this.text=i,this.type=s.EDIT}speak(){e.speak(this.name+". Editable. "+(""==this.text?"Nothing entered.":"Set to "+this.text))}addChar(t){this.text+=t,e.speak(t)}removeChar(){this.text=this.text.substring(0,this.text.length-1),e.speak(this.text)}select(){return this.text}}exports.MenuItem=i,exports.SliderItem=n,exports.SelectorItem=r,exports.MenuTypes=s;
},{"./tts":12}],9:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.speech=exports.ScrollingText=void 0;var e=require("jquery"),t=r(e),s=require("./keycodes"),i=require("./soundObject"),n=require("./tts");function r(e){return e&&e.__esModule?e:{default:e}}if(void 0===a)var a=new n.TTS;if(void 0==h)var h=0;class c{constructor(e,t="\n",s=0){this.callback=s,this.text=e,this.delimiter=t,this.splitText=this.text.split(t),this.currentLine=0,this.sndOpen=i.so.create("UI/textOpen"),this.sndContinue=i.so.create("UI/textScroll"),this.sndClose=i.so.create("UI/textClose");document.getElementById("touchArea");if(this.init(),0==this.callback)return this.prom=new Promise((e,t)=>{this.res=e})}init(){h=this,document.addEventListener("keydown",this.handleKeys),this.sndOpen.play(),this.currentLine=0,this.readCurrentLine()}handleKeys(e){switch(e.which){case s.KeyEvent.DOM_VK_UP:case s.KeyEvent.DOM_VK_DOWN:case s.KeyEvent.DOM_VK_LEFT:case s.KeyEvent.DOM_VK_RIGHT:h.readCurrentLine();break;case s.KeyEvent.DOM_VK_RETURN:h.advance()}}handleTap(e){0==e&&this.readCurrentLine(),1==e&&this.advance()}readCurrentLine(){if("!"==this.splitText[this.currentLine][0]){let e=this.splitText[this.currentLine].substr(1),t=i.so.create(e,!0);t.play(),t.sound.once("end",()=>{this.advance()})}else a.speak(this.splitText[this.currentLine])}advance(){this.currentLine<this.splitText.length-1?(this.currentLine++,this.sndContinue.play(),this.readCurrentLine()):(this.sndClose.play(),this.sndClose.unload(),this.sndOpen.unload(),this.sndContinue.unload(),document.removeEventListener("keydown",this.handleKeys),0!=this.callback?this.callback():this.res())}}exports.ScrollingText=c,exports.speech=a;
},{"./keycodes":15,"./soundObject":14,"./tts":12}],10:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.strings=void 0;var e=require("./main"),a=require("./utilities"),o=require("./tts"),s=require("./scrollingText");class n{constructor(){this.strings={},this.strings[1]={mRev:"Beat Reverse",football:"soccer kick",achfw:"Premier League Team",achfl:"Bad loser: You suck!",achidle:"Pay attention",saveFeature:"Congratulations, you have unlocked the saved games feature!\nPress the s key for save during a game to save its current state so that you can continue later.\nNote that this is not like the old insurance. The state is only saved until you win or fail, and you will destroy your save if you play minigames, buy packs or safeguards.\nHave fun!",saved:"Game saved!",killSave:"This will destroy your save file for the pack %1 at level %2. Continue?",achdl:"Loser times 2",achdw:"winner times 2!",double:"Double or nothing",newach:"You have obtained the achievement: %1",achMenu:"Achievements: Use arrows to browse your achievements and enter to play one. You can interrupt a playing achievement by pressing q.",noach:"You have no achievements yet. Go get some!",mAch:"Browse achievements",achw1:"beat newbie",achw5:"it's time for a beer",achw10:"time for another beer",achw25:"25 makes 7",achw50:"addicted to beatstar",achusepinky:"Just using my pinky",achlactions:"Go learn the actions",achfingr:"Rhythmical fingers",achbulk:"Vicious downloader",achintro:"Get to work",achslotwin:"Slots winner",achfrust:"Frustration unavoidable",achevils:"slots are evil and I can prove it",achcatslots:"Slots catastrophe",achrobber:"Bank robber",collect:"Collect beatcoins and leave",highlow:"Higher or lower",hw:"Welcome to high or low!",yourCard:"Your card is the %1",nextCard:"Will the next card be higher or lower than the %1? Current bet %2 beatcoins",higher:"Higher",lower:"Lower",card:"%1 of %2",K:"king",K:"queen",A:"ace",J:"jack",cspades:"spades",cdiamonds:"diamonds",cclubs:"clubs",chearts:"hearts",dq:"This is a game of risk. You will risk losing %1 beatcoins. Continue?",contPack:"Continue where you left off (level %1)",mPackTut:"Pack making tutorial",packtut:"Welcome to the pack editor!\nFirst, thank you very much for wanting to create a pack.\nIt is very simple. You will be instructed to select whether you want to create a pack from the beginning or, if you already have a times file, called bpm.txt in your pack, you can change one of the levels by using the menu.\nOnce you have selected what to do, you will hear the music for the selected levels.\nYou will have to press the space bar at the speed you wish the level to go. Each press of the space bar is one cycle of the game, meaning that you have this amount of time to press the correct key\nHit q at any time to exit the pack editor and write your changes.\nAfter you do this 10 times, the music will restart and you will hear your result.\nYou will hear a sound which will play on every cycle. Think of this cycle as if you were playing the game. Is this enough time for you to press the key? Is it in sync with the music?\nIf you are not satisfied with the result, you can press the space bar again to reset the time and start again.\nOnce you are satisfied, press enter. The next music will play.\nOnce all the levels are done, the file bpm.txt will be created (or voerwritten).\nNote that you will have to put the pack in your user folder/beatpacks if you want to play it, and unlock it as normal.\nYou can upload your pack via the website by making a zip file of the pack's folder and sending it via the upload form.",startOver:"Start from the first level",mSelectEdit:"Please select which level to edit, or start over",selectPack:"Please select a pack to edit",floop:"Music for the main menu",fa1:"Sound for the freeze action, also known as quiet action or stop action. This has no o sound because no key is needed",fa2:"Sound for the space key action instruction",fo2:"Sound for the space key action",fa3:"Sound for the tab key action instruction",fo3:"Sound for the tab key action",fselect:"Sound played when an action of the main menu is pressed",fa4:"Sound for the enter key action instruction",fo4:"Sound for the enter key action",fa5:"Sound for the backspace key action instruction",fo5:"Sound for the backspace key action",fa6:"Sound for the up arrow key action instruction",fo6:"Sound for the up arrow key action",fa7:"Sound for the down arrow key action instruction",fo7:"Sound for the down arrow key action",fa8:"Sound for the right arrow key action instruction",fo8:"Sound for the right arrow key action",fa9:"Sound for the left arrow key action instruction",fo9:"Sound for the left arrow key action",fwin:"Sound played upon completing all levels",fnlevel:"Sound which is played at the beginning of each level for which there is no pre sound. If neither pre nor nlevel are provided no extra sounds will be played before a level",fpre1:"pre + a level's number (pre1,pre2) will be played before a level begins. Can be useful in certain situations. If neither pre nor nlevel.ogg is provided, the game will continue with the next level with no extra sounds.",fcredits:"The credits are played only once, after playing the pack one time.",missingFiles:"The following files are missing and must be added before your pack can be edited",missingOptional:"The following files are missing from your pack, but are not strictly required to play. You can skip the arrow key actions, as most packs only have the usual 4 actions.",fname:"File which contains the preview sound used in menus",fboot:"This fail is played when the pack is ran for the first time, before reaching the main menu.",ffail:"This file is played upon failing, when the game ends",f1music:"Levels for the game. They must be loops so that the game can synchronize properly. At least 3 levels are required. The format is levelnumber+music, like 1music, 2music, 3music, 4music...",f2music:"Levels for the game. They must be loops so that the game can synchronize properly. At least 3 levels are required. The format is levelnumber+music, like 1music, 2music, 3music, 4music...",f3music:"Levels for the game. They must be loops so that the game can synchronize properly. At least 3 levels are required. The format is levelnumber+music, like 1music, 2music, 3music, 4music...",safeget:"You get %1 safeguards... cool!",lang:"English",langs:"Select your language",codescracked:"You managed to crack %1 codes, with %2 different actions!",mEdit:"Pack Editor",tutslot:"Welcome!\nEvil slots is very evil indeed.\nThis game uses the action sounds from your pack to play a 3 wheel slot machine.\nIf the pack you are currently playing has more than 5 actions, don't worry only the first 5 will be used.\nThe first thing you will need to do is place a bet. The minimum is 5000 beatcoins. When you place a bet, those beatcoins will be deducted from your current beatcoins.\nOnce you have done that, a wheel will spin, and 3 action sounds will play.\nBut this is not a normal slots! This game is evil and, if you lose, the rest of your beatcoins will not be left alone.\nIf you get 3 of different types, you lose beatcoins based on your bet and how much you still have. If you have 0, of course nothing will happen.\n!slot_lose_2\nIf you get 2 of the same type and 1 of a different type, you will get your bet back, but nothing more.\n!slot_lose_1\nIf the first 2 are of the same type, there is a small chance that the third one will be the quiet action (the action of the pack where you must not press any key). If this happens you will get around 25% of your bet back. Because I am evil.\n!slot_lose_3\nHowever, if you get 3 of the same type, you will win your bet + 80 to 100 percent of the original bet!\n!slot_win_3\nHave fun playing evil slots!",mFound:"Found %1 new packs: what do you wish to do?",mGames:"minigames",mGameTuts:"Minigame tutorials",sGames:"Select a minigame to play",sTuts:"Select a minigame to view help",cost:"Price",slot:"Evil slots",unlocked:"Already bought",buygame:"Do  you want to buy %1 for %2 beatcoins?",bet:"Please place your bet with the left and right arrow keys and press enter when you have decided.",nogame:"You don't have the required %1 beatcoins for this game, you only have %2.",mainmenu:"main menu",mSelect:"Please select",mSafeSelect:"Please select, with the right and left arrow keys, how many safeguards you want to buy and press enter.",level:"Level %1",codes:"Number of keys in the code: %1",packprice:"This pack costs %1 beatcoins, please confirm",mReady:"Please wait...",code:"Beat the code",mDownloadAll:"Download all uninstalled packs (size: %1 %2)",mUnlocked:"Listen to unlocked music for this pack (%1 levels)",mSafeguards:"Buy safeguards (now %1)",dfiles:"Downloading %1 files. Press any key to obtain percentage",packno:"Not enough beatcoins to get this pack, it costs %1.",retrieving:"Retrieving data ",nodown:"No downloads are available. So sorry! Check back soon",mDownloadList:"List all new available packs (%1)",buy:"buy",mBack:"go back",safequestion:"How many safeguards would you like? They cost %1 each. You have %2 beatcoins. You can get a maximum of %3. Remember, you can get a maximum of 100. If you want more, run me again.",mDownloadInstructions:"Press arrow keys to browse packs, the space bar to select a pack, p to preview its sound, and enter to begin downloading selected packs. Press escape or the left arrow to cancel",mListen:"Ready: %1 levels unlocked. you can go back to the main menu with the left arrow key.",mStart:"Start Game",mLearn:"Learn the pack",mActions:"This pack has %1 actions. Typical keys are space, tab, enter, backspace, and optionally arrows up, down, left, right. If you have mapped your keyboard differently, use your custom keys instead. To hear the stop action, press the period key (to the right of comma). To exit press Q",yes:"Yes",noGameCash:"The minimum bet is %1 beatcoins, you don't have enough right now. Go play!",doublecash:"Double or nothing requires at least 5000 beatcoins. Sorry!",no:"no",ok:"ok",dling:"Downloading %2 packs please wait...",dlprog:"downloading pack %1 of %2...",dlingdone:"Done! Rebuilding database...",keymapChoose:"Press the key to replace this action: You can't use q, p, escape, enter or space.",packError:"No packs were found on your computer. I will now proceed to download the default pack, please wait...",intro:"Welcome to beatstar!\nThis is a world of music, fun and games.\nPlease read the online instructions to learn how to play.\nYou will now be put into the main menu, where you will find different options.\nI recommend you get some beatcoins by playing the default pack!\nIf you want to change the language, you will need to delete your save file found in your username folder/beatpacks/save.dat",keymapStart:"We will now remap your keyboard. You will hear the sounds for the different actions, and you will be prompted to press the key you want to associate to the new actions.",tamperWarning:"This pack has been tampered with and is no longer unlocked. Press enter to continue.",mNew:"Get new packs",nopacks:"No packs are available. If you think this is a bug, please contact me.",noGuardCash:"You need %1 beatcoins to buy one safeguard. You have %2.",mBrowse:"buy new packs (You have %1 beatcoins )",mBrowseIncompleted:"Browse uncompleted packs",mBrowseUnlocked:"Change to different unlocked pack",youwin:"You win %1 coins!",youlose:"You lose %1 coins.",mHashes:"Rebuild packs folder",mDownload:"Download new packs"},this.strings[2]={mRev:"beatrevés",football:"Lanzamiento de penaltis",doublecash:"El mínimo para jugar son 5000 monedas. Lo siento!",achfw:"Equipo de primera",achfl:"Equipo de segunda",achidle:"Te has quedao empanao!",saveFeature:"Felicidades, has desbloqueado la opción guardar juego!\n\t\tPulsa la s (de save, guardar en inglés) durante un juego para guardar el estado y el nivel actuales para que puedas continuar después.\nTen en cuenta que esto no es como el antiguo seguro, el estado se guarda solo hasta que ganes o falles. se perderá el juego si compras packs, antifallos o juegas algún minijuego.\nA disfrutar!",saved:"Guardado!",killSave:"Esto eliminará tu juego guardado para el pack %1. Estás en el nivel %2. Continuar?",achdl:"Doble perdedor",achdw:"Doble ganador!",double:"Doble o nada",newach:"Has obtenido el logro: %1!",noach:"No tienes logros... qué raro!",mAch:"Ver tus logros",achw1:"Novatillo",achw5:"Una cervecita",achw10:"Otra cervecita",achw25:"25 son 7",achw50:"Beatadicto",achusepinky:"Sin fallos",achlactions:"Vete a aprender las acciones",achfingr:"Al ritmo",achbulk:"Descargador Viciosillo",achintro:"A trabajar!",achslotwin:"Ganador afortunado",achfrust:"Frustración inevitable",achevils:"Los tragaperras son malbados y lo puedo demostrar",achcatslots:"tragaperras catastrófico",achrobber:"Ladrón de bancos",highlow:"La carta más alta",hw:"Bienvenido a la carta más alta!",yourCard:"Tu carta es el %1",nextCard:"Crees que la próxima carta será más alta o más baja que el %1?",higher:"Más alta",lower:"Más baja",collect:"Obtener monedas y salir",achMenu:"Logros: Pulsa las flechas para moverte por tus logros, enter para reproducir uno. Puedes detener la reproducción de un logro pulsando la q.",card:"%1 de %2",K:"rey",Q:"reina",A:"as",J:"sota",cspades:"picas",cdiamonds:"diamantes",cclubs:"bastos",chearts:"corazones",dq:"Este es un juego de riesgo. Te arriesgas a perder %1 monedas. Continuar?",contPack:"Continuar donde lo dejaste (nivel %1)",mPackTut:"Tutorial de cómo hacer packs",packtut:"Bienvenido al editor de packs!\nPrimero, darte las gracias por querer crear un pack.\nEs muy fácil. Primero, deberás seleccionar si editar uno de los niveles (si ya existe un archivo de tiempos llamado bpm.txt) o empezar de 0.\nCuando hayas seleccionado qué hacer, escucharás la música de los niveles seleccionados.\nDeberás pulsar la barra espaciadora a la velocidad que quieres que corra el nivel. Cada pulsación del espacio es un ciclo del juego, lo que significa que tienes esa cantidad de tiempo para pulsar la tecla correcta.\nCuando hayas hecho eso 10 veces, escucharás que la música se reinicia y tu resultado.\nEscucharás un sonido que se reproducirá cada ciclo. Piensa en esos ciclos como si estuvieras jugando. ¿Está sincronizado con la música? ¿Tienes suficiente tiempo para pulsar la tecla correcta?\nSi no estás satisfecho con el resultado, puedes pulsar de nuevo el espacio para reiniciar la música y comenzar de nuevo con el mismo nivel.\nCuando el resultado te parezca bien, pulsa enter. Si has seleccionado más de un nivel, este se reproducirá.\nCuando estén hechos todos los niveles, se creará automáticamente el archivo bpm.txt en el pack (o se reemplazará si ya existía).\nSi quieres jugar, tendrás que ponerlo en tu carpeta de usuario/beatpacks, y desbloquearlo con beatcoins.\nPuedes subirlo a la web haciendo un archivo zip de la carpeta del pack y enviándolo con el formulario de subida",startOver:"Comenzar desde el primer nivel",mSelectEdit:"Por favor selecciona el nivel a editar, o empezar de 0",selectPack:"Selecciona un pack a editar",floop:"Música del menú",fa1:"Sonido para la acción freeze, también se le llama acción de quieto. No necesita sonido o ya que no hay tecla que pulsar",fa2:"Sonido de indicación de la acción para el espacio o barra espaciadora",fo2:"Sonido de la acción para el espacio o barra espaciadora",fa3:"Sonido de indicación de la acción para el tabulador",fo3:"Sonido para la acción del tabulador",fselect:"Sonido que se reproduce cuando se selecciona una opción del menú",fa4:"sonido para la acción de la tecla enter",fo4:"sonido para la acción de la tecla enter",fa5:"sonido para la acción de la indicación de la tecla borrar",fo5:"sonido para la acción de la tecla borrar",fa6:"sonido para la indicación de la acción de la flecha arriba",fo6:"sonido para la acción de la flecha arriba",fa7:"sonido para la indicación de la acción de la flecha abajo",fo7:"sonido para la acción de la flecha abajo",fa8:"Sonido para la indicación de la acción de la flecha derecha",fo8:"sonido para la acción de la flecha derecha",fa9:"sonido para la indicación de la acción de la flecha izquierda",fo9:"Sonido para la acción de la flecha izquierda",fwin:"Sonido que se reproduce al completar todos los niveles",fnlevel:"Sonido que se reproduce al cambiar de nivel, si no existe un sonido pre para ese nivel. Si no se proporciona ni nlevel ni pre, se pasa al siguiente nivel sin sonidos extra.",fpre1:"Pre y el número de un nivel (como pre1.ogg o pre2.ogg), se reproduce antes de que comience un nivel. Si no se proporciona ni nlevel.ogg ni pre, el juego saltará al siguiente nivel sin más sonidos extra.",fcredits:"Los créditos se reproducen cuando el juego termina, solo una vez.",fname:"Archivo utilizado como vista previa en los menús",fboot:"Archivo que se reproduce al abrir el pack por primera vez, antes de jugar",ffail:"Archivo que se reproduce cuando termina el juego, al fallar",f1music:"Los niveles del juego (se requieren al menos 3 para que un pack se considere válido y deben ser loops para que el juego se sincronice. Siguen el formato <númeroNivel>music, por ejemplo 1music, 2music, 3music.",f2music:"Los niveles del juego (se requieren al menos 3 para que un pack se considere válido y deben ser loops para que el juego se sincronice. Siguen el formato <númeroNivel>music, por ejemplo 1music, 2music, 3music.",f3music:"Los niveles del juego (se requieren al menos 3 para que un pack se considere válido y deben ser loops para que el juego se sincronice. Siguen el formato <númeroNivel>music, por ejemplo 1music, 2music, 3music.",missingFiles:"Los siguientes archivos no están presentes en el pack y son necesarios para poder editarlo:",missingOptional:"Los siguientes archivos son opcionales y no están presentes en el pack, pero no son estrictamente necesarios. Puedes saltarte las acciones de las flechas ya que la mayoría de packs solo tienen las 4 acciones básicas.",lang:"Español",langs:"Selecciona tu idioma",mFound:"Hemos encontrado %1 packs nuevos: ¿Qué quieres hacer?",mReady:"Espera, por favor...",mDownloadAll:"Descargar todos los packs no instalados (tamaño: %1 %2)",level:"Nivel %1",nodown:"No hay descargas disponibles por el momento. prueba pronto!",mDownloadList:"Lista todos los packs no instalados (%1 en total)",buy:"comprar",mBack:"volver",mDownloadInstructions:"Pulsa las flechas para moverte por los packs, barra espaciadora para seleccionar un pack, la p para previsualizarlo, y enter para empezar la descarga de los seleccionados. pulsa escape o la flecha izquierda para cancelar",mStart:"jugar",mLearn:"aprender el pack",mActions:"Este pack tiene %1 acciones. Las teclas normales son espacio, tabulador, enter, retroceso/borrar, y opcionalmente las flechas. Si has cambiado la distribución del teclado puedes usarla. Para escuchar la acción de quedarse quieto, pulsa la tecla del punto. Para salir pulsa la q.",dling:"Descargando %2 packs por favor espera...",dlingdone:"¡Hecho! Reconstruyendo base de datos...",keymapChoose:"Pulsa la tecla que quieras que reemplace a No puedes usar la q, escape, enter o espacio.",packError:"No hemos encontrado packs en tu pc, vamos a bajar el pack por defecto, espera por favor...",intro:"Bienvenido a beat star!\nEste es un mundo de música y diversión!\nPor favor, lee el manual en internet para aprender a jugar.\nAhora te llevaré al menú principal, donde encontrarás diferentes opciones.\nTe recomiendo que consigas unas monedas jugando el pack por defecto!\nSi quieres cambiar el idioma del juego, deberás borrar tu archivo de datos que encontrarás en tu carpeta de usuario/beatpacks/save.dat",keymapStart:"Vamos a cambiar la distribución del teclado. Vas a escuchar los sonidos de las acciones y vas a tener que pulsar la tecla que quieres que corresponda para la acción.",dlprog:"descargando pack %1 de %2...",tamperWarning:"Este pack ha sido modificado y ya no está desbloqueado. Pulsa enter para continuar.",mUnlocked:"Escuchar la música desbloqueada de este pack (%1 niveles)",mBrowseIncompleted:"Ver packs comprados no completados",yes:"sí",youwin:"Ganas %1 monedas!",noGuardCash:"No tienes suficientes monedas. Cada antifallo cuesta %1 y tienes %2.",youlose:"Pierdes %1 monedas!",no:"no",mNew:"Conseguir nuevos packs",safeget:"Consigues %1 antifallos... Que guay!",nopacks:"No hay packs disponibles. Si crees que hay un error en el juego, ponte en contacto conmigo.",codes:"Número de teclas en el código: %1",unlocked:"Ya lo has comprado",mBrowse:"comprar un pack (tienes %1 monedas)",mBrowseUnlocked:"Cambiar a otro pack comprado",mHashes:"Reconstruir base de datos de packs",codescracked:"Has podido desbloquear %1 códigos, con %2 acciones diferentes!",mainmenu:"menú principal",mSelect:"Por favor selecciona",mSafeSelect:"Por favor selecciona, con las flechas izquierda y derecha, cuántos antifallos quieres y pulsa enter.",mSafeguards:"Comprar antifallos (ahora %1)",noGameCash:"Oooh, lo siento. La apuesta mínima es de %1 monedas, no tienes suficiente. Vete a jugar!",bet:"selecciona tu apuesta con las flechas izquierda y derecha. Cuando te hayas decidido, pulsa enter.",packprice:"Este pack cuesta %1 monedas, confirma que quieres comprarlo.",packno:"No tienes monedas suficientes para este pack, cuesta %1.",safequestion:"Cuántos antifallos quieres comprar? Cuestan %1 cada una y tienes %2 monedas. Puedes comprar %3. Recuerda que solo puedes comprar 100 de una tirada. Si quieres más, dale otra vez a la opción del menú.",code:"rompecódigos",mListen:"listo: %1 niveles desbloqueados, flecha izquierda vuelve al menú principal",dfiles:"Descargando %1 archivos. Pulsa cualquier tecla para obtener porcentaje",retrieving:"Recopilando datos ",mDownload:"Descargar packs",ok:"ok",mEdit:"Editor de packs",mGames:"minijuegos",buygame:"Quieres comprar %1 por %2 monedas?",nogame:"No tienes las %1 monedas que necesitas para este juego, solo tienes %2",mGameTuts:"tutoriales de minijuegos",sGames:"Selecciona un minijuego:",sTuts:"Selecciona un minijuego para ver la ayuda",cost:"Precio",slot:"tragamonedas de las tinieblas"}}get(a,o=[]){let s;if(void 0!==this.strings[e.lang][a])s=this.strings[e.lang][a];else{if(void 0===this.strings[1][a])return a;s=this.strings[1][a]}return o.forEach((e,a)=>{const o=Number(a)+1;s=s.replace("%"+o,e)}),s}speak(a,s=[]){let n;void 0!==this.strings[e.lang][a]?n=this.strings[e.lang][a]:void 0!==this.strings[1][a]?n=this.strings[1][a]:o.speech.speak(a),s.forEach((e,a)=>{const o=Number(a)+1;n=n.replace("%"+o,e)}),o.speech.speak(n)}async check(e){a.utils.objSize(this.strings);for(let a in this.strings[1])this.strings[e].hasOwnProperty(a)||await new s.ScrollingText(a+": "+this.strings[1][a])}}var i=exports.strings=new n;
},{"./main":1,"./utilities":13,"./tts":12,"./scrollingText":9}],7:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Menu=void 0;var e=require("./utilities"),s=require("./strings"),t=require("./tts"),i=require("jquery"),u=o(i),a=require("./soundObject.js"),n=require("./menuItem"),r=require("./keycodes"),h=require("./input");function o(e){return e&&e.__esModule?e:{default:e}}class c{constructor(e,s,t){this.menuData=s,this.first=!0,this.cursor=0,this.name=e,this.sndKeyChar=a.so.create("ui/keyChar"),this.sndKeyDelete=a.so.create("ui/keyDelete"),this.sndSliderLeft=a.so.create("ui/menuSliderLeft"),this.sndSliderRight=a.so.create("ui/menuSliderRight"),this.sndBoundary=a.so.create("ui/menuBoundary"),this.sndChoose=a.so.create("ui/menuChoose"),this.sndMove=a.so.create("ui/menuMove"),this.sndOpen=a.so.create("ui/menuOpen"),this.sndSelector=a.so.create("ui/menuSelector"),this.sndWrap=a.so.create("ui/menuWrap"),this.selectCallback=null,void 0!==t&&(this.music=t);document.getElementById("touchArea")}nextItem(){this.first?(this.sndMove.play(),this.first=!1):this.cursor<this.menuData.length-1?(this.sndMove.play(),this.cursor++):(this.sndWrap.play(),this.cursor=0),this.menuData[this.cursor].speak()}previousItem(){this.first&&(this.first=!1,this.sndMove.play()),this.cursor>0?(this.sndMove.play(),this.cursor--):(this.cursor=this.menuData.length-1,this.sndWrap.play()),this.menuData[this.cursor].speak()}increase(){this.menuData[this.cursor].type!=n.MenuTypes.SLIDER&&this.menuData[this.cursor].type!=n.MenuTypes.SELECTOR||(this.menuData[this.cursor].increase(),this.menuData[this.cursor].type==n.MenuTypes.SLIDER?this.sndSliderRight.play():this.sndSelector.play())}decrease(){this.menuData[this.cursor].type!=n.MenuTypes.SLIDER&&this.menuData[this.cursor].type!=n.MenuTypes.SELECTOR||(this.menuData[this.cursor].decrease(),this.menuData[this.cursor].type==n.MenuTypes.SLIDER?this.sndSliderLeft.play():this.sndSelector.play())}insertCharacter(e){this.menuData[this.cursor].type==n.MenuTypes.EDIT&&(this.menuData[this.cursor].addChar(String.fromCharCode(e)),this.sndKeyChar.play())}removeCharacter(){this.menuData[this.cursor].type==n.MenuTypes.EDIT&&(this.menuData[this.cursor].removeChar(),this.sndKeyDelete.play())}handleInput(e){this.insertCharacter(e.which)}destroySounds(){this.sndKeyChar.unload(),this.sndKeyDelete.unload(),this.sndSliderLeft.unload(),this.sndSliderRight.unload(),this.sndBoundary.unload(),this.sndChoose.unload(),this.sndMove.unload(),this.sndOpen.unload(),this.sndSelector.unload(),this.sndWrap.unload(),void 0!==this.music&&this.music.unload()}async fade(){for(let s=this.music.volume;s>0;s-=.06)this.music.volume=s,await e.utils.sleep(50);this.music.unload()}destroy(){(0,u.default)(document).off("keydown"),(0,u.default)(document).off("keypress");const e=this;setTimeout(()=>{e.destroySounds()},500)}handleKeys(e){switch(e.which){case r.KeyEvent.DOM_VK_RETURN:this.select();break;case r.KeyEvent.DOM_VK_PAGE_UP:this.music.volume+=.03;break;case r.KeyEvent.DOM_VK_PAGE_DOWN:this.music.volume-=.03;break;case r.KeyEvent.DOM_VK_BACK_SPACE:this.removeCharacter();break;case r.KeyEvent.DOM_VK_DOWN:this.nextItem();break;case r.KeyEvent.DOM_VK_UP:this.previousItem();break;case r.KeyEvent.DOM_VK_RIGHT:this.increase();break;case r.KeyEvent.DOM_VK_LEFT:this.decrease()}}run(e){"object"==typeof this.music?(this.music.volume=.5,this.music.loop=!0,this.music.play()):"string"==typeof this.music&&(this.music=a.so.create(this.music,!0),this.music.volume=.5,this.music.loop=!0,this.music.play()),this.selectCallback=e;const s=this;(0,u.default)(document).on("keypress",e=>{s.handleInput(e)}),(0,u.default)(document).on("keydown",e=>{s.handleKeys(e)}),t.speech.speak(this.name),this.sndOpen.play()}handleSwipe(e){3==e&&this.decrease(),4==e&&this.increase(),0==e&&this.previousItem(),1==e&&this.nextItem(),2==e&&this.select()}select(){const e=this.menuData[this.cursor].id,s=[];for(let e=0;e<this.menuData.length;e++){let t=null;this.menuData[e].type==n.MenuTypes.SLIDER&&(t={id:this.menuData[e].id,value:this.menuData[e].currentValue}),this.menuData[e].type==n.MenuTypes.EDIT&&(t={id:this.menuData[e].id,value:this.menuData[e].text}),this.menuData[e].type==n.MenuTypes.SELECTOR&&(t={id:this.menuData[e].id,value:this.menuData[e].currentOption,name:this.menuData[e].options[this.menuData[e].currentOption]}),s.push(t)}const t={selected:e,cursor:this.cursor,items:s};this.sndChoose.play(),(0,u.default)(document).off("keydown"),(0,u.default)(document).off("keypress"),this.musicDuration=0,this.musicDuration=this.sndChoose.duration,this.musicDuration>3e3&&(this.musicDuration=3e3),void 0!==this.music&&this.fade();const i=this;setTimeout(()=>{i.selectCallback(t)},this.musicDuration)}}exports.Menu=c;
},{"./utilities":13,"./strings":10,"./tts":12,"./soundObject.js":14,"./menuItem":6,"./keycodes":15,"./input":3}],8:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mainMenu=u;var e=require("./soundObject"),s=require("./main"),t=require("./stateMachine"),n=require("./strings"),r=require("./menuItem"),a=require("./menu");async function u(){const u=require("fs");speech.webTTS=!0;const i=new Array;i.push(new r.MenuItem(0,n.strings.get("mStart"))),i.push(new r.MenuItem(13,n.strings.get("mRev"))),i.push(new r.MenuItem(8,n.strings.get("mSafeguards",[s.data.safeguards]))),i.push(new r.MenuItem(1,n.strings.get("mLearn"))),i.push(new r.MenuItem(12,n.strings.get("mAch"))),i.push(new r.MenuItem(11,n.strings.get("mEdit"))),i.push(new r.MenuItem(9,n.strings.get("mGames"))),i.push(new r.MenuItem(2,n.strings.get("mBrowse",[s.data.beatcoins]))),i.push(new r.MenuItem(5,n.strings.get("mBrowseUnlocked"))),i.push(new r.MenuItem(7,n.strings.get("mBrowseIncompleted"))),i.push(new r.MenuItem(4,n.strings.get("mDownload"))),i.push(new r.MenuItem(6,n.strings.get("mUnlocked",[s.data.unlocks[s.pack].level]))),i.push(new r.MenuItem(10,n.strings.get("mGameTuts"))),i.push(new r.MenuItem(3,n.strings.get("mHashes"))),e.so.directory="./sounds/";const c=new a.Menu(n.strings.get("mainmenu"),i);e.so.directory="",c.music=s.packdir+"loop",u.existsSync(s.packdir+"select.ogg")&&(c.sndChoose.unload(),c.sndChoose=e.so.create(s.packdir+"select")),c.run(r=>{switch(e.so.directory="./sounds/",c.destroy(),r.selected){case 0:t.st.setState(3);break;case 1:t.st.setState(4);break;case 2:t.st.setState(5);break;case 3:(0,s.rebuildHashes)();break;case 4:(0,s.downloadPacks)();break;case 5:t.st.setState(6);break;case 6:t.st.setState(7);break;case 7:t.st.setState(8);break;case 8:(0,s.buySafeguards)();break;case 9:(0,s.minigames)();break;case 10:(0,s.minituts)();break;case 11:const{dialog:a}=require("electron").remote;require("electron").remote;a.showOpenDialog({title:n.strings.get("selectPack"),properties:["openDirectory"]},function(e){(0,s.editPack)(e)});break;case 12:(0,s.browseAch)();break;case 13:t.st.setState(21)}})}
},{"./soundObject":14,"./main":1,"./stateMachine":16,"./strings":10,"./menuItem":6,"./menu":7}],24:[function(require,module,exports) {
function n(n,e){let t,o=0,i=!1,r=0,u=0,a=e||1/120;function c(e){if(null!==o)for(r+=(e-o)/1e3;r>a;)n.update(a,u),u+=1,r-=a;o=e,n.render(),i&&(t=requestAnimationFrame(c))}function l(){o=null,i=!0,t=requestAnimationFrame(c)}function f(){i=!1,cancelAnimationFrame(t),console.log(t)}return{start:l,stop:f,change:function(n){r=a=n||1/120,u=0,f(),l()}}}module.exports=n;
},{}],22:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Game=void 0;var e=require("fs"),s=m(e),t=require("./strings"),i=require("os"),a=m(i),o=require("./tts"),l=require("./main"),r=require("jquery"),c=m(r),n=require("./oldtimer"),u=require("./soundHandler"),h=require("./utilities"),d=require("./soundObject"),p=require("./stateMachine"),v=require("./timer"),y=m(v),f=require("./scrollingText"),g=require("./input.js"),k=require("./keycodes.js");function m(e){return e&&e.__esModule?e:{default:e}}class S{constructor(e,s=1){this.totalScore=[],this.volume=1,this.totalAverage=[],this.cash=0,d.so.directory="./sounds/",this.scoreAverage=[],this.levelAverage=[],this.scoreCounter=d.so.create("cling"),d.so.directory="",this.canPause=!0,this.actionCompleted=!1,this.toDestroy=new Array,this.scoreTimer=new n.OldTimer;this.pauseTime=0,this.timer=null,this.music=null,this.score=0,this.pool=new u.SoundHandler,this.bpms=null,this.level=0,this.fileData=null,this.input=new g.KeyboardInput,this.input.init(),this.levels=null;this.setup(e,s)}async setup(e,t){if(this.forceLevel=1,1==t&&(this.rev=!1),2==t&&(this.rev=!0),void 0!==l.data.save.pack)if(l.data.save.pack!=l.pack){if(!await questionSync("killSave",[l.data.save.pack,l.data.save.level]))return void p.st.setState(2);l.data.save={},(0,l.save)()}else this.forceLevel=l.data.save.level;if(this.credits=e,this.getscore=0,this.safeuse=!1,s.default.existsSync(l.packdir+"bpm.txt"))this.fileData=s.default.readFileSync(l.packdir+"bpm.txt","utf8");else{new f.ScrollingText("There was an error loading the pack "+this.pack+".","\n",()=>{p.st.setState(2)})}this.bpms=this.fileData.split(","),d.so.directory="./sounds/",this.safe=d.so.create("safe"),d.so.directory="",this.levels=this.bpms.length-1,""==this.bpms[this.levels]&&this.levels--,this.level=this.forceLevel-1,this.level++,l.data.save={},(0,l.save)(),d.so.directory="./sounds/",d.so.enqueue("safe"),d.so.directory="",s.default.existsSync(l.packdir+"nlevel.ogg")&&d.so.enqueue(l.packdir+"nlevel"),s.default.existsSync(l.packdir+"win.ogg")&&d.so.enqueue(l.packdir+"win"),s.default.existsSync(l.packdir+"fail.ogg")&&d.so.enqueue(l.packdir+"fail");for(let e=1;e<=10;e++)s.default.existsSync(l.packdir+"a"+e+".ogg")&&(d.so.enqueue(l.packdir+"a"+e),this.actions=e),s.default.existsSync(l.packdir+"o"+e+".ogg")&&d.so.enqueue(l.packdir+"o"+e);this.keys=l.actionKeys;const i=this;this.timer=(0,y.default)({update(e){i.update(e)},render(){i.render()}},this.bpms[this.level]/1e3),d.so.setQueueCallback(()=>{d.so.directory="./sounds/",i.setupLevel()}),this.queueLevels(),d.so.loadQueue()}update(e){if(0!=this.currentAction){if(!this.actionCompleted&&this.action>1){if(l.data.safeguards<=0)return void this.fail(!0);l.data.safeguards--,this.safeuse=!0,this.currentAction--,(0,l.save)(),this.actionCompleted=!0,l.data.safeguards>3&&(this.safe.pitch=1),l.data.safeguards<=3&&(this.safe.pitch=1.5),this.safe.play()}if(this.currentAction++,this.currentAction>=this.numberOfActions)return d.so.directory="",d.so.destroy(l.packdir+this.level+"music"),d.so.destroy(l.packdir+"pre"+this.level),d.so.directory="./sounds/",this.level++,this.timer.stop(),void this.setupLevel();this.action=h.utils.randomInt(1,this.actions),this.actionCompleted=!1,d.so.directory="",rev||this.pool.playStatic(l.packdir+"a"+this.action,0),rev&&this.pool.playStatic(l.packdir+"o"+this.action,0),d.so.directory="./sounds/",this.scoreTimer.reset()}else this.currentAction++}async doScore(){this.getscore>=6&&await(0,l.getAch)("fingr"),(0,l.addCash)(this.cash,0,function(){p.st.setState(2)})}async fail(e=!1){if(l.data.safeguards>=1&&!e)return l.data.safeguards--,this.safeuse=!0,(0,l.save)(),this.actionCompleted=!0,this.currentAction--,l.data.safeguards>3&&(this.safe.pitch=1),l.data.safeguards<=3&&(this.safe.pitch=1.4),void this.safe.play();this.timer.stop();const t=this.music;d.so.directory="";const i=this.pool.playStatic(l.packdir+"fail",0);d.so.directory="./sounds/";for(let e=t.playbackRate;e>0;e-=.05)t.playbackRate=e,await h.utils.sleep(30);for(t.unload();this.pool.staticSounds[i].sound.playing;)await h.utils.sleep(10),this.input.isDown(k.KeyEvent.DOM_VK_RETURN)&&this.pool.staticSounds[i].sound.unload();d.so.resetQueue(),d.so.resetQueuedInstance();var a=this;1==this.level&&await(0,l.getAch)("lactions"),d.so.kill(()=>{if(s.default.existsSync(l.packdir+"credits.ogg")&&this.credits){let e=new g.KeyboardInput;e.init(),d.so.directory="";let s=d.so.create(l.packdir+"credits");s.play(),s.sound.once("end",function(){e.justPressedEventCallback=null,a.doScore()}),d.so.directory="./sounds/",e.justPressedEventCallback=function(t){s.sound.off("end"),s.stop(),s.destroy(),e.justPressedEventCallback=null,a.doScore()}}else a.doScore()})}async quit(){this.timer.stop();const e=this.music;for(let s=e.playbackRate;s>0;s-=.045)e.playbackRate=s,await h.utils.sleep(30);e.unload(),d.so.resetQueue(),d.so.resetQueuedInstance();var t=this;d.so.kill(()=>{if(s.default.existsSync(l.packdir+"credits.ogg")&&this.credits){console.log("found credits");let e=new g.KeyboardInput;e.init(),d.so.directory="";let s=d.so.create(l.packdir+"credits");s.play(),s.sound.once("end",function(){e.justPressedEventCallback=null,t.doScore()}),d.so.directory="./sounds/",e.justPressedEventCallback=function(i){s.sound.off("end"),s.stop(),s.destroy(),e.justPressedEventCallback=null,t.doScore()}}else t.doScore()})}async save(){if(!l.data.allowSave)return;this.timer.stop();const e=this.music;for(let s=e.playbackRate;s>0;s-=.045)e.playbackRate=s,await h.utils.sleep(30);e.unload(),d.so.resetQueue(),d.so.resetQueuedInstance();d.so.kill(async()=>{l.data.save={pack:l.pack,level:this.level},(0,l.save)(),await new f.ScrollingText("saved"),this.doScore()})}render(){if(this.input.isJustPressed(k.KeyEvent.DOM_VK_Q))this.quit();else if(this.input.isJustPressed(k.KeyEvent.DOM_VK_C)&&o.speech.speak(this.cash),this.input.isJustPressed(k.KeyEvent.DOM_VK_S))this.save();else if(this.input.isJustPressed(k.KeyEvent.DOM_VK_P))this.pause();else{if(this.input.isJustPressed(k.KeyEvent.DOM_VK_PAGE_UP))return this.volume+=.08,void(this.music.volume=this.volume);this.input.isJustPressed(k.KeyEvent.DOM_VK_PAGE_DOWN)&&(this.volume-=.08,this.music.volume=this.volume),this.handleKeys()}}handleKeys(){if(this.actionCompleted)return;const e=this.input.keysPressed();if(e.length>0&&1==this.action)this.fail();else{if(!(e.length>1))return 1==e.length&&e[0]==this.keys[this.action]?(d.so.directory="",rev||this.pool.playStatic(l.packdir+"o"+this.action,0),rev&&this.pool.playStatic(l.packdir+"a"+this.action,0),d.so.directory="./sounds/",this.actionCompleted=!0,void this.calculateScore()):void(1==e.length&&e[0]!=this.keys[this.action]&&this.fail());this.fail()}}async setupLevel(){if(this.level>1&&this.level!=this.forceLevel&&(this.actionPercentage=Math.ceil(h.utils.percentOf(this.numberOfActions*this.level,h.utils.averageInt(this.levelAverage))),h.utils.averageInt(this.scoreAverage)>90&&(this.getscore++,this.cash+=h.utils.averageInt(this.levelAverage)),h.utils.averageInt(this.scoreAverage)<90&&this.getscore--,this.cash+=h.utils.averageInt(this.levelAverage)+h.utils.averageInt(this.levelAverage)+this.actionPercentage),this.scoreAverage=[],this.levelAverage=[],this.level>this.levels){if(s.default.existsSync(l.packdir+"win.ogg"))for(d.so.directory="",this.winSound=d.so.create(l.packdir+"win"),this.winSound.play();1==this.winSound.playing;)await h.utils.sleep(5),this.input.isJustPressed(k.KeyEvent.DOM_VK_RETURN)&&this.winSound.stop();this.safeuse||await(0,l.getAch)("usepinky"),l.data.unlocks[l.pack].win=!0;let e=0;for(let s in l.data.unlocks)l.data.unlocks[s].win&&e++;if(console.log("wins"+e),1==e){await(0,l.getAch)("w1"),d.so.directory="./sounds/";let e=d.so.create("saveUnlock");await e.playSync(),l.data.allowSave=!0,(0,l.save)(),await new f.ScrollingText(t.strings.get("saveFeature"))}5==e&&await(0,l.getAch)("w5"),10==e&&await(0,l.getAch)("w10"),25==e&&await(0,l.getAch)("w25"),50==e&&await(0,l.getAch)("w50");let i=this;return d.so.resetQueue(),d.so.resetQueuedInstance(),this.levels>9&&(this.cash+=2*this.cash),void d.so.kill(()=>{i.doScore()})}if(this.canPause=!0,l.data.unlocks[l.pack].level<this.level&&(l.data.unlocks[l.pack].level=this.level,(0,l.save)()),this.playing=!1,s.default.existsSync(l.packdir+"pre"+this.level+".ogg")&&(d.so.directory="",this.preSound=d.so.create(l.packdir+"pre"+this.level),d.so.directory="./sounds/",this.preSound.play(),this.playing=!0),s.default.existsSync(l.packdir+"nlevel.ogg")&&!this.playing&&this.level>1&&this.level!=this.forceLevel&&(d.so.directory="",this.preSound=d.so.create(l.packdir+"nlevel"),d.so.directory="./sounds/",this.preSound.play(),this.playing=!0),this.playing)for(this.queueLevels();this.preSound.playing;)await h.utils.sleep(5),this.input.isJustPressed(k.KeyEvent.DOM_VK_RETURN)&&this.preSound.stop();d.so.directory="";const e=this;this.music=d.so.create(l.packdir+this.level+"music",!1),this.music.loop=!0,this.music.volume=this.volume,d.so.directory="./sounds/",this.music.play(),this.music.sound.once("play",()=>{this.timer.change(e.bpms[e.level]/1e3)}),!this.playing&&this.level>1&&this.level!=this.forceLevel&&this.queueLevels(),this.action=0,this.actionCompleted=!1,this.currentAction=0,!this.playing&&this.level,this.numberOfActions=h.utils.randomInt(6+this.level,2*this.level+5),this.forceLevel=0}unload(){}async pause(){if(!this.canPause)return;let e=new n.OldTimer;this.canPause=!1;const s=this.music;this.timer.stop(),this.scoreTimer.pause(),this.pauseTime=s.currentTime;for(let e=s.playbackRate;e>0;e-=.05)s.playbackRate=e,await h.utils.sleep(30);for(s.pause(),e.reset();!this.input.isDown(k.KeyEvent.DOM_VK_P);)await h.utils.sleep(10),e.elapsed>=6e4&&await(0,l.getAch)("idle");this.unpause()}async unpause(){const e=this.music;e.play();for(let s=e.playbackRate;s<=1;s+=.05)e.playbackRate=s,await h.utils.sleep(8);e.seek(this.pauseTime),this.timer.start(),this.scoreTimer.resume(),this.input.keysPressed()}calculateScore(){const e=this.bpms[this.level],s=this.scoreTimer.elapsed,t=Math.ceil((e/2-Math.abs(e/2-s))/(e/2)*100);this.scoreCounter.pitch=h.utils.progressPitch(t,100),this.scoreCounter.stop(),this.scoreCounter.play(),this.scoreAverage.push(t);const i=Math.ceil(3500*t/e);this.score+=i,this.levelAverage.push(i)}queueLevels(){let e=this.level+1;this.levels<e&&(e=this.levels),d.so.directory="";for(let t=this.level;t<=e;t++)d.so.enqueue(l.packdir+t+"music"),s.default.existsSync(l.packdir+"pre"+t+".ogg")&&d.so.enqueue(l.packdir+"pre"+t);this.level>1&&this.level!=this.forceLevel&&(d.so.setQueueCallback(0),d.so.loadQueue(),d.so.directory="./sounds/")}}exports.Game=S;
},{"./strings":10,"./tts":12,"./main":1,"./oldtimer":4,"./soundHandler":11,"./utilities":13,"./soundObject":14,"./stateMachine":16,"./timer":24,"./scrollingText":9,"./input.js":3,"./keycodes.js":15}],16:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.st=void 0;var e=require("./input"),t=require("./tts"),s=require("./main"),r=require("./menuHandler"),a=require("jquery"),n=c(a),u=require("./soundObject"),i=require("./keycodes"),o=require("./game");function c(e){return e&&e.__esModule?e:{default:e}}let d=new e.KeyboardInput;class l{constructor(){this.state=0,this.currentState=0}setState(t){if(1==t){(d=new e.KeyboardInput).init();const s=u.so.create("logo"),r=this;s.volume=.5,s.play(),s.sound.once("end",()=>{s.unload(),(0,n.default)(document).off("keydown"),r.setState(2)}),(0,n.default)(document).keydown(e=>{e.which!=i.KeyEvent.DOM_VK_SPACE&&e.which!=i.KeyEvent.DOM_VK_ESCAPE&&e.which!=i.KeyEvent.DOM_VK_RETURN||(s.unload(),(0,n.default)(document).off("keydown"),r.setState(20))}),this.state=t}else 2==t?(d=null,(0,s.checkPack)(),this.state=t):21==t?(this.currentState=new o.Game(s.credits,2),this.state=t):3==t?(this.currentState=new o.Game(s.credits),this.state=t):20==t?(d=null,(0,s.checkPack)(!1),this.state=t):4==t?(0,s.learnPack)():7==t?(0,s.listenPack)():5==t?((0,s.browsePacks)(),this.state=t):6==t?((0,s.browsePacks)(2),this.state=t):8==t&&((0,s.browsePacks)(3),this.state=t)}}const h=new l;exports.st=h;
},{"./input":3,"./tts":12,"./main":1,"./menuHandler":8,"./soundObject":14,"./keycodes":15,"./game":22}],2:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.betSync=g,exports.minibet=S,exports.playSlots=h,exports.playCode=k,exports.playDeck=M,exports.takeCard=q,exports.playDouble=K,exports.playFootball=x;var e=require("./main"),t=require("52-deck"),a=require("./oldtimer"),s=require("./soundHandler"),l=require("./menuItem"),n=require("./menu"),i=require("os"),o=b(i),r=require("./scrollingText"),c=require("./strings"),u=require("./tts"),p=require("./utilities"),d=require("./soundObject"),w=require("./keycodes"),y=require("./input"),_=require("./stateMachine"),m=require("fs"),f=b(m);function b(e){return e&&e.__esModule?e:{default:e}}async function g(e=5e3,t=500){return new Promise((a,s)=>{S(function(e){return a(e),e},e,t)})}function S(t=null,a=5e3,s=500){if(e.data.beatcoins<a){new r.ScrollingText(c.strings.get("noGameCash",[a,e.data.beatcoins]),"\n",function(){void 0!==t&&t(-1)})}else{const i=new Array;let o=new l.SliderItem(0,c.strings.get("bet",[]),a,e.data.beatcoins,a,s);i.push(o),i.push(new l.MenuItem(1,c.strings.get("ok"))),i.push(new l.MenuItem(2,c.strings.get("mBack"))),d.so.directory="./sounds/";let r=new n.Menu(c.strings.get("bet"),i),u=0;r.run(a=>{d.so.directory="./sounds/",u=a.items[0].value,r.destroy(),2==a.selected?void 0!==t&&t(u):(0,e.addCash)(0,u,function(){void 0!==t&&t(u)})})}}async function h(){let t;S(function(a){if(a<=0)return void _.st.setState(2);t=a,d.so.directory="./sounds/";let s,l=d.so.create("slot_wheel",!0),n=0;l.play();let i=[],o=setInterval(()=>{if(n<3){if(d.so.directory="",i[n]=p.utils.randomInt(2,5),2==n&&i[0]==i[1]){let e;1==(e=p.utils.randomInt(1,10))&&(i[2]=1)}(s=d.so.create(e.packdir+"a"+i[n])).play(),n++}else if(clearInterval(o),l.stop(),d.so.directory="./sounds/",i[0]==i[1]&&i[1]==i[2]){let a=d.so.create("slot_win_"+p.utils.randomInt(1,4));a.play(),a.sound.once("end",async()=>{await(0,e.getAch)("slotwin");let a=t;console.log(a);let s=Math.ceil(p.utils.percentOf(p.utils.randomInt(80,100),a)+t);console.log("perc"+s),(0,e.addCash)(s,0,function(){d.so.kill(function(){_.st.setState(2)})})})}else if(1==i[2]){let a=d.so.create("slot_lose_3");a.play(),a.sound.once("end",async function(){await(0,e.getAch)("evils");let a=t;console.log(a),a>e.data.beatcoins&&(a=e.data.beatcoins);let s=Math.ceil(p.utils.percentOf(p.utils.randomInt(15,25),a));console.log("perc"+s),(0,e.addCash)(0,s,function(){d.so.kill(function(){_.st.setState(2)})})})}else if(i[0]==i[1]||i[1]==i[2]||i[0]==i[2]){let a=d.so.create("slot_lose_1");a.play(),a.sound.once("end",async function(){await(0,e.getAch)("frust");let a=t;console.log(a);let s=a;console.log("perc"+s),(0,e.addCash)(s,0,function(){d.so.kill(function(){_.st.setState(2)})})})}else{let a=d.so.create("slot_lose_2");a.play(),a.sound.once("end",async function(){await(0,e.getAch)("catslots");let a=t;a>e.data.beatcoins&&(a=e.data.beatcoins),console.log(a);let s=Math.ceil(p.utils.percentOf(p.utils.randomInt(20,60),a));console.log("perc"+s),(0,e.addCash)(0,s,function(){d.so.kill(function(){_.st.setState(2)})})})}},p.utils.randomInt(2500,3100))},2500,500)}function I(){d.so.directory=e.packdir+"/"}function v(){d.so.directory="./sounds/"}async function k(){const t=require("fs");let l=new s.SoundHandler,n=0;for(let a=1;a<=10;a++)t.existsSync(e.packdir+"a"+a+".ogg")&&(n=a);let i,o=new a.OldTimer,m=42e3;v(),i=d.so.create("codetick"),I();let f,b=!0,g=0,S=0,h=[],k=[];for(let e=2;e<=n;e++)k.push("a"+e);let M=new y.KeyboardInput;M.init();let q=!1;v(),f=d.so.create("codego");let K=!0;for(;b;){if(await p.utils.sleep(5),g++,m=35e3+500*n,h.splice(),h=k,g+n-1>n){let e=g-1;for(let t=1;t<=e;t++)h.push("a"+p.utils.randomInt(2,n))}h=p.utils.shuffle(h);let t=0;for(v(),q||(u.speech.speak(c.strings.get("level",[g])),await p.utils.sleep(700),u.speech.speak(c.strings.get("codes",[h.length])),await p.utils.sleep(p.utils.randomInt(800,1250)),f.play(),I(),o.reset());o.elapsed<m&&b;){if(await p.utils.sleep(5),o.elapsed%1e3<=10&&K){let e=(m-o.elapsed)/1e3;i.pitch=(120-e)/100,K=!1,i.play()}else K=!0;if(M.justPressedEventCallback=function(a){a==w.KeyEvent.DOM_VK_Q&&(b=!1),e.actionKeys.includes(a)&&(a==e.actionKeys[h[t].substr(1)]?(I(),l.playStatic(h[t],0),v(),l.playStatic("code_ok",0),I(),t++):(t=0,v(),l.playStatic("code_wrong",0),I()))},t==h.length){v(),M.justPressedEventCallback=null,l.playStatic("code_complete",0),I(),await p.utils.sleep(600),i.stop(),S++,o.restart(),h.splice();break}}if(o.elapsed>=m){let e;M.justPressedEventCallback=null,v(),q=!0,b=!1,(e=d.so.create("fumble")).play(),await p.utils.sleep(400)}}let x=p.utils.randomInt(0,g-1);new r.ScrollingText(c.strings.get("codescracked",[S,n]),"\n",async function(){S>=3&&await(0,e.getAch)("robber"),(0,e.safeget)(x,function(){d.so.kill(()=>{M.justPressedEventCallback=null,_.st.setState(2)})})})}async function M(){let a=(0,t.shuffle)((0,t.newDecks)(1));d.so.directory="./sounds/";let i,o,r=d.so.create("hl_intro"),w=await g(1500,500);if(u.speech.speak(w),w<=0)return void d.so.kill(()=>{_.st.setState(2)});c.strings.speak("hw"),await r.playSync();let y,m=new s.SoundHandler,f=!0,b=w;w+=b,d.so.directory="./sounds/";let S=d.so.create("hl_card");for(;0!=w;)await p.utils.sleep(8),await new Promise((t,s)=>{y=q(a),S.playSync(),a.splice(0,1),i=y[1],o=y[0].value;let r=!1,g=new Array;g.push(new l.MenuItem(0,c.strings.get("nextCard",[i,w]))),o<13&&g.push(new l.MenuItem(0,c.strings.get("higher"))),o>1&&g.push(new l.MenuItem(1,c.strings.get("lower"))),f?f=!1:g.push(new l.MenuItem(2,c.strings.get("collect"))),d.so.directory="./sounds/";let h=new n.Menu(c.strings.get("nextCard",[i,w]),g);u.speech.speak("ok"),h.run(async s=>{switch(d.so.directory="./sounds/",s.selected){case 0:h.destroy(),r=!0;break;case 1:h.destroy(),r=!1;break;case 2:return h.destroy(),await(0,e.addCashSync)(w,0),_.st.setState(2),t(),void(w=0)}let l=q(a);return await p.utils.sleep(p.utils.randomInt(1e3,1900)),u.speech.speak(l[1]+"!"),await p.utils.sleep(p.utils.randomInt(400,800)),l[0].value<o&&!r?(w+=b,m.playStatic("hl_right",0),await p.utils.sleep(p.utils.randomInt(100,300)),m.playStatic("hl_crowdwin",0),await p.utils.sleep(p.utils.randomInt(800,1600)),void t()):l[0].value>o&&r?(w+=b,m.playStatic("hl_right",0),await p.utils.sleep(p.utils.randomInt(100,300)),m.playStatic("hl_crowdwin",0),await p.utils.sleep(p.utils.randomInt(800,1600)),void t()):l[0].value==o?(m.playStatic("hl_equal",0),await p.utils.sleep(p.utils.randomInt(100,300)),m.playStatic("hl_crowdequal",0),await p.utils.sleep(p.utils.randomInt(800,1600)),void t()):(m.playStatic("hl_wrong",0),await p.utils.sleep(p.utils.randomInt(100,300)),m.playStatic("hl_crowdlose",0),await p.utils.sleep(3400),_.st.setState(2),t(),void(w=0))})})}function q(e){let t=e[0];"J"==t.text&&(t.value=11),"Q"==t.text&&(t.value=12),"K"==t.text&&(t.value=13);let a=c.strings.get("card",[c.strings.get(t.text),c.strings.get("c"+t.suite)]);return console.log(a),[t,a]}async function K(){if(e.data.beatcoins<5e3)return await new r.ScrollingText(c.strings.get("doublecash")),void _.st.setState(2);if(!await(0,e.questionSync)("dq",[e.data.beatcoins]))return void _.st.setState(2);let t=e.data.beatcoins;d.so.directory="./sounds/";let a=d.so.create("doub_intro");await a.playSync(),await(0,e.addCashSync)(0,e.data.beatcoins);let s=!1;1==p.utils.randomInt(1,2)&&(s=!0),v(),s?s&&(a=d.so.create("doub_winner"),await a.playSync(),await(0,e.addCashSync)(2*t),await(0,e.getAch)("dw")):(a=d.so.create("doub_loser"),await a.playSync(),await(0,e.getAch)("dl")),_.st.setState(2)}async function x(){d.so.directory="./sounds/"+e.lang+"/";d.so.directory;let t,a,s,l,n=0,i=0;(l=d.so.create("bw_background",!0)).loop=!0,l.play();let o=p.utils.randomInt(1,10),r=p.utils.randomInt(1,10);for(;r==o;)r=p.utils.randomInt(1,10);l.volume=.7,s=d.so.create("bw_intro"+p.utils.randomInt(1,3)),await s.playSync(),s=d.so.create("bw_team_"+o+"_1"),await s.playSync(),s=d.so.create("bw_vs"),await s.playSync(),s=d.so.create("bw_team_"+r+"_2"),await s.playSync();let c=o,u=new y.KeyboardInput;for(u.init();n<5&&i<5;){let y=2;if(s=d.so.create("bw_turn"),await s.playSync(),s=d.so.create("bw_team_"+c+"_2"),await s.playSync(),c==o){for(s=d.so.create("bw_where"),await s.playSync();!u.isJustPressed(w.KeyEvent.DOM_VK_RETURN);)u.isJustPressed(w.KeyEvent.DOM_VK_LEFT)&&((y-=1)<1&&(y=1),1==y&&((t=d.so.create("bw_left")).pan=-.8,t.play()),2==y&&((t=d.so.create("bw_center")).pan=0,t.play()),3==y&&((t=d.so.create("bw_right")).pan=.8,t.play())),u.isJustPressed(w.KeyEvent.DOM_VK_RIGHT)&&((y+=1)>3&&(y=3),1==y&&((t=d.so.create("bw_left")).pan=-.8,t.play()),2==y&&((t=d.so.create("bw_center")).pan=0,t.play()),3==y&&((t=d.so.create("bw_right")).pan=.8,t.play())),await p.utils.sleep(5);let e,_=p.utils.randomInt(1,3);if(l.volume=.3,a=d.so.create("bw_chuta"+p.utils.randomInt(1,4)),1==y&&(a.pan=-.8),2==y&&(a.pan=0),3==y&&(a.pan=.8),a.play(),await p.utils.sleep(220),y==_?(e=d.so.create("bw_parar"+p.utils.randomInt(1,3)),1==_&&(e.pan=-.8),2==_&&(e.pan=0),3==_&&(e.pan=.8),e.play(),await p.utils.sleep(300)):(e=d.so.create("bw_portero"+p.utils.randomInt(1,2)),1==_&&(e.pan=-.8),2==_&&(e.pan=0),3==_&&(e.pan=.8),e.play(),await p.utils.sleep(200)),y==_){let e;for((s=d.so.create("bw_paradon"+p.utils.randomInt(1,3))).play(),e=d.so.create("bw_mal"+p.utils.randomInt(1,3)),await e.playSync();s.playing;)await p.utils.sleep(5);l.volume=.7,await p.utils.sleep(700)}else{if(1==p.utils.randomInt(1,4)){let e,t;for(e=d.so.create("bw_falta"+p.utils.randomInt(1,7)),1==y&&(e.pan=-.8),3==y&&(e.pan=.8),2==y&&(e.pan=0),e.play(),await p.utils.sleep(400),(s=d.so.create("bw_falton"+p.utils.randomInt(1,4))).play(),t=d.so.create("bw_cfalta"+p.utils.randomInt(1,3)),await t.playSync();s.playing;)await p.utils.sleep(5);await p.utils.sleep(400)}else{let e;for(n+=1,(s=d.so.create("bw_sgol"+p.utils.randomInt(1,7))).play(),e=d.so.create("bw_gol"+p.utils.randomInt(1,6)),await e.playSync();s.playing;)await p.utils.sleep(5);l.volume=.6,s=d.so.create("bw_marc"+p.utils.randomInt(1,3)),await s.playSync(),s=d.so.create("bw_team_"+o+"_2"),await s.playSync(),s=d.so.create("bw_"+n+"_1"),await s.playSync(),s=d.so.create("bw_team_"+r+"_1"),await s.playSync(),s=d.so.create("bw_"+i+"_2"),await s.playSync()}}c=r}else{for(s=d.so.create("bw_dwhere"),await s.playSync();!u.isJustPressed(w.KeyEvent.DOM_VK_RETURN);)u.isJustPressed(w.KeyEvent.DOM_VK_LEFT)&&((y-=1)<1&&(y=1),1==y&&((t=d.so.create("bw_left")).pan=-.8,t.play()),2==y&&((t=d.so.create("bw_center")).pan=0,t.play()),3==y&&((t=d.so.create("bw_right")).pan=.8,t.play())),u.isJustPressed(w.KeyEvent.DOM_VK_RIGHT)&&((y+=1)>3&&(y=3),1==y&&((t=d.so.create("bw_left")).pan=-.8,t.play()),2==y&&((t=d.so.create("bw_center")).pan=0,t.play()),3==y&&((t=d.so.create("bw_right")).pan=.8,t.play())),await p.utils.sleep(5);s=d.so.create("bw_prepara"+p.utils.randomInt(1,4)),await s.playSync(),await p.utils.sleep(p.utils.randomInt(2e3,3800));let _,m=p.utils.randomInt(1,3);if(l.volume=.3,a=d.so.create("bw_chuta"+p.utils.randomInt(1,4)),1==m&&(a.pan=-.8),2==m&&(a.pan=0),3==m&&(a.pan=.8),a.play(),await p.utils.sleep(220),y==m?(_=d.so.create("bw_parar"+p.utils.randomInt(1,3)),1==m&&(_.pan=-.8),2==m&&(_.pan=0),3==m&&(_.pan=.8),_.play(),await p.utils.sleep(300)):(_=d.so.create("bw_portero"+p.utils.randomInt(1,2)),1==y&&(_.pan=-.8),2==y&&(_.pan=0),3==y&&(_.pan=.8),_.play(),await p.utils.sleep(200)),y==m){let t;for(void 0===e.data.safeguards&&(e.data.safeguards=0),e.data.safeguards+=1,(0,e.save)(),(s=d.so.create("bw_paradon"+p.utils.randomInt(1,3))).play(),t=d.so.create("bw_mal"+p.utils.randomInt(1,3)),await t.playSync();s.playing;)await p.utils.sleep(5);l.volume=.7,await p.utils.sleep(700)}else{if(1==p.utils.randomInt(1,4)){let e,t;for(e=d.so.create("bw_falta"+p.utils.randomInt(1,7)),1==y&&(e.pan=-.8),3==y&&(e.pan=.8),2==y&&(e.pan=0),e.play(),await p.utils.sleep(400),(s=d.so.create("bw_falton"+p.utils.randomInt(1,4))).play(),t=d.so.create("bw_cfalta"+p.utils.randomInt(1,3)),await t.playSync();s.playing;)await p.utils.sleep(5);await p.utils.sleep(400)}else{let e;for(i+=1,(s=d.so.create("bw_sgol"+p.utils.randomInt(1,7))).play(),e=d.so.create("bw_gol"+p.utils.randomInt(1,6)),await e.playSync();s.playing;)await p.utils.sleep(5);l.volume=.7,s=d.so.create("bw_marc"+p.utils.randomInt(1,3)),await s.playSync(),s=d.so.create("bw_team_"+o+"_2"),await s.playSync(),s=d.so.create("bw_"+n+"_1"),await s.playSync(),s=d.so.create("bw_team_"+r+"_1"),await s.playSync(),s=d.so.create("bw_"+i+"_2"),await s.playSync()}}c=o}if(u.isJustPressed(w.KeyEvent.DOM_VK_ESCAPE))return void d.so.kill(function(){_.st.setState(2)});await p.utils.sleep(5)}l.volume=.3,s=d.so.create("bw_ganador"),await s.playSync(),await p.utils.sleep(p.utils.randomInt(500,1200)),5==n&&(s=d.so.create("bw_team_"+o+"_2")),5==i&&(s=d.so.create("bw_team_"+r+"_2")),await s.playSync();let m,f=d.so.create("bw_ganar");f.volume=.4,l.stop(),f.loop=!0,f.play(),5==n&&(m=d.so.create("bw_himno"+o)),5==i&&(m=d.so.create("bw_himno"+r)),await m.playSync(),l.stop(),f.stop(),s.stop(),m.stop(),5==i&&(0,e.getAch)("fl"),5==n&&(0,e.getAch)("fw"),d.so.kill(function(){_.st.setState(2)})}
},{"./main":1,"./oldtimer":4,"./soundHandler":11,"./menuItem":6,"./menu":7,"./scrollingText":9,"./strings":10,"./tts":12,"./utilities":13,"./soundObject":14,"./keycodes":15,"./input":3,"./stateMachine":16}],5:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Player=void 0;var e=require("fs"),t=a(e),s=require("os"),r=a(s),i=require("./keycodes"),_=require("./main"),n=require("./scrollingText");function a(e){return e&&e.__esModule?e:{default:e}}class l{constructor(){this.beatcoins=0,this.pack="default",this.allowSave=!1,this.save={},this.actionKeys=[0,0,i.KeyEvent.DOM_VK_SPACE,i.KeyEvent.DOM_VK_TAB,i.KeyEvent.DOM_VK_RETURN,i.KeyEvent.DOM_VK_BACK_SPACE,i.KeyEvent.DOM_VK_UP,i.KeyEvent.DOM_VK_DOWN,i.KeyEvent.DOM_VK_RIGHT,i.KeyEvent.DOM_VK_LEFT],this.unlocks={},this.unlocks.default={level:0,fails:0,win:!1,average:0}}}exports.Player=l;
},{"./keycodes":15,"./main":1,"./scrollingText":9}],1:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.packdir=exports.data=exports.pack=exports.langs=exports.mangle=exports.actionKeys=exports.minis=exports.credits=exports.editing=exports.lang=void 0,exports.learnPack=A,exports.browsePacks=j,exports.rebuildHashes=F,exports.questionSync=L,exports.question=N,exports.checkPack=z,exports.downloadPacks=B,exports.save=U,exports.listenPack=H,exports.booter=W,exports.addCashSync=G,exports.addCash=Q,exports.buySafeguards=X,exports.minigames=Y,exports.runGame=Z,exports.minituts=$,exports.safeget=te,exports.editPack=se,exports.getAch=oe,exports.browseAch=re;var e=require("./oldtimer"),t=require("jquery"),s=b(t),n=require("./minis.js"),o=require("cryptr"),r=b(o),a=require("./player"),i=require("./menuItem"),l=require("./menu"),c=require("fs-walk"),u=b(c),d=require("os"),p=b(d),g=require("./menuHandler"),f=require("./scrollingText"),h=require("./strings"),y=require("./soundHandler"),m=require("./tts"),v=require("./utilities"),k=require("./soundObject"),w=require("./keycodes"),S=require("./stateMachine"),x=require("./input.js");function b(e){return e&&e.__esModule?e:{default:e}}var E=exports.lang=0,M=exports.editing=!1;let K=!1;var P=exports.credits=!1;let _=exports.minis={slot:8500,code:1e4,highlow:15e3,double:1e4,football:12e3};var T=exports.actionKeys=[0,0,w.KeyEvent.DOM_VK_SPACE,w.KeyEvent.DOM_VK_TAB,w.KeyEvent.DOM_VK_RETURN,w.KeyEvent.DOM_VK_BACK_SPACE,w.KeyEvent.DOM_VK_UP,w.KeyEvent.DOM_VK_DOWN,w.KeyEvent.DOM_VK_RIGHT,w.KeyEvent.DOM_VK_LEFT],O=exports.mangle=new r.default("sdf jkl wer uio"),q=exports.langs=["","english","spanish"],D=exports.pack="default",I=exports.data="",C=exports.packdir=p.default.homedir()+"/beatpacks/"+D+"/";async function V(){S.st.setState(1)}function J(){const e=k.so.create("memtest");e.volume=.3,e.play(),k.so.destroy("memtest")}async function A(){k.so.directory="";const e=require("fs"),t=new y.SoundHandler;let s=0;for(let t=1;t<=10;t++)e.existsSync(C+"a"+t+".ogg")&&(s=t);m.speech.speak(h.strings.get("mActions",[s]));const n=new x.KeyboardInput;for(n.init(),k.so.directory="";!n.isJustPressed(w.KeyEvent.DOM_VK_Q);)await v.utils.sleep(10),n.isJustPressed(T[2])&&t.playStatic(C+"a2",0),n.isJustPressed(T[3])&&t.playStatic(C+"a3",0),n.isJustPressed(T[4])&&t.playStatic(C+"a4",0),n.isJustPressed(T[5])&&t.playStatic(C+"a5",0),n.isJustPressed(T[6])&&t.playStatic(C+"a6",0),n.isJustPressed(T[7])&&t.playStatic(C+"a7",0),n.isJustPressed(T[8])&&t.playStatic(C+"a8",0),n.isJustPressed(T[9])&&t.playStatic(C+"a9",0),n.isJustPressed(w.KeyEvent.DOM_VK_PERIOD)&&t.playStatic(C+"a1",0);t.destroy(),k.so.directory="./sounds/",S.st.setState(2)}async function j(e=1){if(void 0!==I.save.pack){if(!await L("killSave",[I.save.pack,I.save.level]))return void S.st.setState(2);I.save={},U()}const t=require("fs");if(!t.existsSync(p.default.homedir()+"/beatpacks/hashes.db")){return 1==E&&new f.ScrollingText("The packs folder hashes need to be rebuilt to continue. This can take a few seconds...","\n",()=>{F()}),void(2==E&&new f.ScrollingText("Para continuar, debo reconstruir la carpeta de packs. Esto puede tardar unos segundos...","\n",()=>{F()}))}try{var s=JSON.parse(O.decrypt(t.readFileSync(p.default.homedir()+"/beatpacks/hashes.db")))}catch(e){return 1==E&&new f.ScrollingText("The packs folder hashes need to be rebuilt to continue. This can take a long while, so go get a coffee or something...","\n",()=>{F()}),void(2==E&&new f.ScrollingText("Para continuar, debo reconstruir la carpeta de packs. Esto puede tardar un buen rato así que ves a por un café o algo...","\n",()=>{F()}))}let n=-1;const o=[];let r=-1;if(e>0&&s.forEach((s,n)=>{t.existsSync(p.default.homedir()+"/beatpacks/"+s.name+"/bpm.txt")&&(1==e?void 0===I.unlocks[s.name]&&o.push(s):2==e?void 0!==I.unlocks[s.name]&&o.push(s):3==e&&(void 0===I.unlocks[s.name]||I.unlocks[s.name].win||o.push(s)))}),k.so.directory="",0===o.length)return k.so.directory="./sounds/",void new f.ScrollingText(h.strings.get("nopacks"),"\n",function(){S.st.setState(2)});o.sort((e,t)=>{const s=e.name.toLowerCase(),n=t.name.toLowerCase();return s<n?-1:s>n?1:0});const a=new x.KeyboardInput;let i;a.init(),1==E&&m.speech.speak("ready. showing "+o.length+" packs. Press arrows to move, left arrow to exit, enter to choose a pack, or the first letter of a packs name."),2==E&&m.speech.speak("listo. Mostrando "+o.length+" packs. Pulsa flechas para moverte, flecha izquierda para salir, enter para elegir uno, o la primera letra del nombre de un pack.");for(;!a.isJustPressed(w.KeyEvent.DOM_VK_LEFT)&&e>0;){if(a.isJustPressed(w.KeyEvent.DOM_VK_RETURN)){if(-1==r)return void S.st.setState(2);if(void 0!==i&&i.destroy(),-1!=n&&clearTimeout(n),e>0){if(1==e){let e=500*o[r].levels;return void(I.beatcoins<e?new f.ScrollingText(h.strings.get("packno",[e]),"\n",function(){S.st.setState(2)}):N("packprice",[e],function(t){if(t){if(t){k.so.directory="./sounds/";let t=k.so.create("buypack");t.play(),t.sound.once("end",function(){Q(0,e,function(){exports.pack=D=o[r].name,K=!1,exports.credits=P=!0,I.pack=D,void 0===I.unlocks[D]&&(I.unlocks[D]={level:0,fails:0,win:!1,average:0}),exports.packdir=C=p.default.homedir()+"/beatpacks/"+D+"/",K=!1,exports.credits=P=!0,k.so.directory="./sounds/",U(),k.so.kill(()=>{S.st.setState(20)})})})}}else S.st.setState(2)}))}exports.pack=D=o[r].name,K=!1,exports.credits=P=!0,I.pack=D,void 0===I.unlocks[D]&&(I.unlocks[D]={level:0,fails:0,win:!1,average:0}),exports.packdir=C=p.default.homedir()+"/beatpacks/"+D+"/",K=!1,exports.credits=P=!0,k.so.directory="./sounds/",U(),k.so.kill(()=>{S.st.setState(20)})}return}a.isJustPressed(w.KeyEvent.DOM_VK_DOWN)&&(void 0!==i&&i.destroy(),-1!=n&&clearTimeout(n),++r>o.length-1&&(r=0),m.speech.speak(r),1==E&&m.speech.speak(o[r].name+". "+o[r].levels+" levels."),2==E&&m.speech.speak(o[r].name+". "+o[r].levels+" niveles."),n=setTimeout(()=>{(i=k.so.create(o[r].preview)).play()},1e3));var l=a.getChars();if(""!=l){var c=!1;o.forEach((e,t)=>{e.name.toLowerCase().slice(0,1)==l[0]&&(c||(r=t),c=!0)}),void 0!==i&&i.destroy(),-1!=n&&clearTimeout(n),1==E&&m.speech.speak(o[r].name+". "+o[r].levels+" levels."),2==E&&m.speech.speak(o[r].name+". "+o[r].levels+" niveles."),n=setTimeout(()=>{(i=k.so.create(o[r].preview)).play()},1e3)}a.isJustPressed(w.KeyEvent.DOM_VK_UP)&&(void 0!==i&&i.destroy(),-1!=n&&clearTimeout(n),--r<0&&(r=o.length-1),1==E&&m.speech.speak(o[r].name+". "+o[r].levels+" levels."),2==E&&m.speech.speak(o[r].name+". "+o[r].levels+" niveles."),n=setTimeout(()=>{(i=k.so.create(o[r].preview)).play()},1e3)),await v.utils.sleep(5)}-1!=n&&clearTimeout(-1),k.so.directory="./sounds/",k.so.kill(()=>{S.st.setState(2)})}async function F(e=!1){const t=require("fs");let s="",n=0;const o=new Array;k.so.directory="",u.default.dirsSync(p.default.homedir()+"/beatpacks",(e,r,a,i)=>{if(!t.existsSync(e+"/"+r+"/bpm.txt"))return void(s+="\n"+r);let l=0;const c=e+"/"+r+"/";u.default.filesSync(c,(e,t,s)=>{l+=s.size}),n=l;const d=t.readFileSync(c+"bpm.txt","utf8").split(",");let p=d.length-1;""==d[p]&&p--;const g={name:r,preview:c+"name",levels:p,hash:n};o.push(g)}),k.so.directory="./sounds/";let r=JSON.stringify(o);if(r=O.encrypt(r),t.writeFileSync(p.default.homedir()+"/beatpacks/hashes.db",r),e)return o;""!=s?(1==E&&(e||new f.ScrollingText("one thing before you go... the following packs are corrupt and should be looked at."+s,"\n",()=>{e||S.st.setState(2)})),2==E&&(e||new f.ScrollingText("Antes de que te vayas... los siguientes packs están corruptos y deberías echar un vistazo a ver qué pasa."+s,"\n",()=>{e||S.st.setState(2)}))):e||S.st.setState(2)}async function L(e,t=[]){return new Promise((s,n)=>{N(e,t,function(e){s(e)})})}function N(e,t=[],s=null){let n=!1,o=new Array;o.push(new i.MenuItem(0,h.strings.get(e,t))),o.push(new i.MenuItem(0,h.strings.get("yes"))),o.push(new i.MenuItem(1,h.strings.get("no"))),k.so.directory="./sounds/";let r=new l.Menu(h.strings.get(e,t),o);k.so.directory="",r.run(e=>{switch(console.log("ok"),k.so.directory="./sounds/",e.selected){case 0:r.destroy(),n=!0;break;case 1:r.destroy(),n=!1}void 0!==s&&s(n)})}async function z(e=!0,t=!1){exports.editing=M=!1;const s=require("fs");try{exports.data=I=JSON.parse(O.decrypt(s.readFileSync(p.default.homedir()+"/beatpacks/save.dat")))}catch(e){exports.data=I=new a.Player;let t=!0,s="";for(let e in h.strings.strings)s+=h.strings.strings[e].langs+". ";let n=[],o=1;for(let e in h.strings.strings)n.push(new i.MenuItem(o,h.strings.strings[e].lang)),o++;let r=new l.Menu(s,n);for(r.run(e=>{exports.lang=E=e.selected,I.lang=E,r.destroy(),new f.ScrollingText(h.strings.get("intro"),"\n",async function(){await oe("intro"),t=!1})});t;)await v.utils.sleep(10)}if(exports.pack=D=I.pack,exports.lang=E=I.lang,e||(K=!1,exports.credits=P=!0),e&&(K=!0,exports.credits=P=!1),exports.packdir=C=p.default.homedir()+"/beatpacks/"+D+"/",exports.actionKeys=T=I.actionKeys,U(),s.existsSync(C+"bpm.txt")||(exports.pack=D="default",exports.packdir=C=p.default.homedir()+"/beatpacks/"+D+"/"),s.existsSync(C+"bpm.txt")){if(t)return I.beatcoins=1e6,void S.st.setState(2);W()}else{new f.ScrollingText(h.strings.get("packError"),"\n",()=>{B(["default"])})}}document.addEventListener("DOMContentLoaded",V);var R=function(e,t,s){const n=require("http");var o=require("fs").createWriteStream(t);n.get(e,function(e){e.pipe(o),o.on("finish",function(){o.close(),s()})})};async function B(e=[]){const t=require("fs");if(0==e.length){new Array;let e,t;t=await F(!0),await fetch("http://oriolgomez.com/beatpacks/hashes.db").then(e=>e.text()).then(t=>{e=JSON.parse(O.decrypt(t)),console.log("remote"+e.length)});const s=[];let n=0;if(e.forEach((e,o)=>{let r=!1;for(let s=0;s<t.length;s++){if(e.name==t[s].name&&e.hash==t[s].hash){r=!1;break}r=!0}r&&(s.push(e),n+=e.hash)}),s.length<1)return void new f.ScrollingText(h.strings.get("nodown"),"\n",function(){S.st.setState(2)});new Array;let o;o="mb",(n=n/1024/1024)>1024&&(n/=1024,o="gb"),n=n.toFixed(2);const r=new Array;r.push(new i.MenuItem(-1,h.strings.get("mFound",[s.length]))),r.push(new i.MenuItem(0,h.strings.get("mDownloadAll",[n,o]))),r.push(new i.MenuItem(1,h.strings.get("mDownloadList",[s.length]))),r.push(new i.MenuItem(2,h.strings.get("mBack"))),k.so.directory="./sounds/";let a=new l.Menu(h.strings.get("mSelect"),r);k.so.directory="";let c=!1;if(a.run(async e=>{switch(k.so.directory="./sounds/",e.selected){case 0:a.destroy();let n=new Array;await oe("bulk"),s.forEach(function(e){n.push(e.name)}),B(n);break;case 2:a.destroy(),c=!0,S.st.setState(2);break;case 1:a.destroy();let o=-1;s.forEach(e=>{e.selected=!1});var t=[];k.so.directory="./sounds/";let r=k.so.create("ui/selected");k.so.directory="",s.sort((e,t)=>{const s=e.name.toLowerCase(),n=t.name.toLowerCase();return s<n?-1:s>n?1:0});let i,l=new x.KeyboardInput;l.init(),1==E&&m.speech.speak("ready. Browsing "+s.length+" downloadable packs. Press arrows to move, space to select, p to preview, q to exit, enter to start download, or the first letter of a packs name to move to it."),2==E&&m.speech.speak("listo. tienes "+s.length+" packs disponibles. Pulsa flechas para moverte, p para previsualizar, espacio para seleccionar, q para salir, enter para empezar descarga, o pulsa la primera letra del nombre de un pack para moverte a él.");let u=1,d=0;return l.justPressedEventCallback=function(e){if(e==w.KeyEvent.DOM_VK_SPACE&&-1!=o){let e,t;s[o].selected?(s[o].selected=!1,d-=s[o].hash):0==s[o].selected&&(s[o].selected=!0,r.play(),d+=s[o].hash),d<=0&&(e="bytes"),t=d/1024/1024,console.log(t),e="mb",t>1024&&(t=d/1024,e="gb"),d<=0&&(e="bytes"),t=Math.ceil(t),m.speech.speak(t+" "+e+" total")}if(e==w.KeyEvent.DOM_VK_RETURN){if(0==u)return;if(t.splice(),s.forEach(e=>{e.selected&&t.push(e.name)}),t.length>0)return void 0!==i&&i.destroy(),u=0,l.justPressedEventCallback=null,l.charEventCallback=null,void B(t)}e==w.KeyEvent.DOM_VK_DOWN&&(void 0!==i&&i.destroy(),++o>s.length-1&&(o=0),s[o].selected&&(r.stop(),r.play()),1==E&&m.speech.speak(s[o].name+". "+s[o].levels+" levels."),2==E&&m.speech.speak(s[o].name+". "+s[o].levels+" niveles.")),e==w.KeyEvent.DOM_VK_UP&&(void 0!==i&&i.destroy(),--o<0&&(o=s.length-1),s[o].selected&&(r.stop(),r.play()),1==E&&m.speech.speak(s[o].name+". "+s[o].levels+" levels."),2==E&&m.speech.speak(s[o].name+". "+s[o].levels+" niveles."))},void(l.charEventCallback=function(e){var t=!1;s.forEach((s,n)=>{s.name.toLowerCase().slice(0,1)==e&&(t||(o=n),t=!0)}),void 0!==i&&i.destroy(),s[o].selected&&(r.stop(),r.play()),1==E&&m.speech.speak(s[o].name+". "+s[o].levels+" levels."),2==E&&m.speech.speak(s[o].name+". "+s[o].levels+" niveles.")})}}),c)return}else if(e.length>0){k.so.directory="./sounds/";k.so.create("progress");var s=[];m.speech.speak(h.strings.get("dling",[o+1,e.length]));let i=0,l=0;for(let t=0;t<e.length;t++){e[t];(i=Math.floor(v.utils.percent(t,e.length)))>l+20&&(l=i,e.length>5&&m.speech.speak(h.strings.get("retrieving")+i+"%")),await fetch(" http://oriolgomez.com/beatpacks/index.php?p="+e[t]).then(e=>e.text()).then(e=>{e.split("\n").forEach(e=>{""!=e&&s.push(e)})})}let c=p.default.homedir()+"/beatpacks/",u="http://oriolgomez.com/beatpacks/";var n=[];for(var o in s){var r=o;if(""!=(o=s[o])){c=p.default.homedir()+"/beatpacks/";var a=o.split("/");t.existsSync(c+o)&&(console.log("unlink"+c+o),t.unlinkSync(c+o)),t.existsSync(c+a[0])||t.mkdirSync(c+a[0]),c=p.default.homedir()+"/beatpacks/"+o,u="http://oriolgomez.com/beatpacks/"+o,s[r]=u,n.push(c)}}console.log("going to start download"),m.speech.speak(h.strings.get("dfiles",[s.length])),i=0,l=0;let d=0,g=new x.KeyboardInput;g.init(),g.justPressedEventCallback=function(){i=v.utils.percent(d,s.length).toFixed(1),m.speech.speak(i+"%"),console.log(i+"%")};require("async").eachOfLimit(s,3,function(e,t,s){R(e,n[t],s),d=t},function(){m.speech.speak(h.strings.get("dlingdone")),console.log("exiting function"),F(!0),g.justPressedEventCallback=null,k.so.directory="./sounds/",S.st.setState(2)})}}function U(){const e=require("fs");e.existsSync(p.default.homedir()+"/beatpacks")||e.mkdirSync(p.default.homedir()+"/beatpacks");let t=JSON.stringify(I);t=O.encrypt(t),e.writeFileSync(p.default.homedir()+"/beatpacks/save.dat",t)}function H(){const e=require("fs");let t=new x.KeyboardInput;t.init();let s,n,o,r,a=0;k.so.directory="./sounds/";let i=k.so.create("locked");k.so.directory="";let l=I.unlocks[D].level;if(0==l&&(l=1),e.existsSync(C+"bpm.txt"))""==(n=(s=e.readFileSync(C+"bpm.txt","utf8")).split(","))[r=n.length-1]&&r--,m.speech.speak(h.strings.get("mListen",[l])),t.justPressedEventCallback=function(e){if(i.stop(),void 0!==o&&o.destroy(),e==w.KeyEvent.DOM_VK_LEFT)return t.justPressedEventCallback=null,void S.st.setState(2);e==w.KeyEvent.DOM_VK_DOWN?(++a>r&&(a=1),a>l?i.play():((o=k.so.create(C+a+"music",!0)).loop=!0,o.play())):e==w.KeyEvent.DOM_VK_UP&&(--a<=0&&(a=r),a>l?i.play():((o=k.so.create(C+a+"music",!0)).loop=!0,o.play()))};else{new f.ScrollingText("There was an error loading the pack "+D+".","\n",()=>{S.st.setState(2)})}}function W(){if(I.safeguards||(I.safeguards=0),U(),require("fs").existsSync(C+"boot.ogg")&&!K){K=!0;let e=new x.KeyboardInput;e.init(),k.so.directory="";let t=k.so.create(C+"boot");t.play(),t.sound.once("end",function(){e.justPressedEventCallback=null,(0,g.mainMenu)()}),k.so.directory="./sounds/",e.justPressedEventCallback=function(s){t.sound.off("end"),t.stop(),t.destroy(),e.justPressedEventCallback=null,(0,g.mainMenu)()}}else(0,g.mainMenu)()}async function G(e,t=0,s){return new Promise((s,n)=>{Q(e,t,function(){s("ok")})})}async function Q(e,t=0,s){let n=-1,o=Math.ceil(e-t);I.beatcoins+=o,U();let r,a=!0,i=370;if(o<0&&(a=!1),o=Math.abs(o),k.so.directory="./sounds/",o>5e5?n=1e5:o<=5e5&&o>100001?n=1e3:o<=1e5&&o>10001?n=500:o<=1e4&&o>501?n=500:o<=500&&o>101?n=100:o<=100&&o>11?n=10:o<=10&&o>0&&(n=1),-1!=n){if(!a&&o>=1e3&&(n=1e3),a?(r=k.so.create("morecash"+n),m.speech.speak(h.strings.get("youwin",[o]))):a||(r=k.so.create("lesscash"),m.speech.speak(h.strings.get("youlose",[o]))),await v.utils.sleep(400),o>=n){r.play();let e=0;for(let e=o-=n;e>=n;e-=n)(i-=15)<80&&(i=80);for(let t=o;t>=n;t-=n)e++,setTimeout(function(){r.play()},i*e);k.so.directory="",void 0!==s&&setTimeout(function(){s()},i*(e+4))}}else void 0!==s&&s()}async function X(){if(void 0!==I.save.pack){if(!await L("killSave",[I.save.pack,I.save.level]))return void S.st.setState(2);I.save={},U()}void 0===I.safeguards&&(I.safeguards=0);let e=I.beatcoins;e>1e5&&(e=1e5);let t=0,s=0;if(e<700){new f.ScrollingText(h.strings.get("noGuardCash",[700,I.beatcoins]),"\n",function(){S.st.setState(2)})}else{for(let s=e;s>=700;s-=700)t++;if(t>0){const e=new Array;let n=new i.SliderItem(0,h.strings.get("safequestion",[700,I.beatcoins,t]),1,t,Math.floor(t/2));e.push(n),e.push(new i.MenuItem(1,h.strings.get("buy"))),e.push(new i.MenuItem(2,h.strings.get("mBack"))),k.so.directory="./sounds/";let o=new l.Menu(h.strings.get("mSafeSelect"),e);k.so.directory="",o.run(e=>{if(k.so.directory="./sounds/",s=e.items[0].value,o.destroy(),2==e.selected)S.st.setState(2);else{I.safeguards+=s,U();let e=k.so.create("safebuy");e.sound.once("end",function(){S.st.setState(2)}),Q(0,700*s,function(){e.play()})}})}else S.st.setState(2)}}async function Y(){if(void 0!==I.save.pack){if(!await L("killSave",[I.save.pack,I.save.level]))return void S.st.setState(2);I.save={},U()}void 0===I.minis&&(I.minis={},U());let e=[],t="",s="";for(var n in _)_.hasOwnProperty(n)&&(t="",0,t+=h.strings.get(n)+", ",void 0===I.minis[n]?t+=h.strings.get("cost")+": "+_[n]:t+=h.strings.get("unlocked"),e.push(new i.MenuItem(n,t)),console.log(t));e.push(new i.MenuItem("-1",h.strings.get("mBack"))),k.so.directory="./sounds/";let o=new l.Menu(h.strings.get("sGames"),e,k.so.create("minimusic"));o.run(function(e){o.destroy(),"-1"!=e.selected?(s=e.selected,void 0===I.minis[s]?I.beatcoins>=_[s]?N("buygame",[h.strings.get(s),_[s]],function(e){e?Q(0,_[s],function(){I.minis[s]=!0,U(),Z(s)}):S.st.setState(2)}):new f.ScrollingText(h.strings.get("nogame",[_[s],I.beatcoins]),"\n",function(){S.st.setState(2)}):Z(s)):S.st.setState(2)})}function Z(e){"slot"==e?(0,n.playSlots)():"code"==e?(0,n.playCode)():"highlow"==e?(0,n.playDeck)():"double"==e?(0,n.playDouble)():"football"==e?(0,n.playFootball)():S.st.setState(2)}function $(){void 0===I.minis&&(I.minis={},U());let e=[],t="";for(var s in _)_.hasOwnProperty(s)&&(t="",0,t+=h.strings.get(s)+", ",e.push(new i.MenuItem(s,t)),console.log(t));e.push(new i.MenuItem("-1",h.strings.get("mBack"))),k.so.directory="./sounds/";let n=new l.Menu(h.strings.get("sTuts"),e,k.so.create("minitut",!0));n.run(function(e){n.destroy(),"-1"!=e.selected?ee(e.selected):S.st.setState(2)})}function ee(e){new f.ScrollingText(h.strings.get("tut"+e),"\n",function(){S.st.setState(2)})}function te(e,t){e>0?(I.safeguards+=e,U(),new f.ScrollingText(h.strings.get("safeget",[e]),"\n",function(){t()})):t()}async function se(e){if(void 0===e||""==e)return void S.st.setState(2);await v.utils.sleep(1e3),console.log(e),e+="/";const t=require("fs");let s="";["a1","a2","a3","a4","a5","o2","o3","o4","o5","1music","2music","3music","fail","name","loop","select","win"].forEach(function(n,o){t.existsSync(e+n+".ogg")||(""==s&&(s=h.strings.get("missingFiles")),s+="\n"+n+".ogg: "+h.strings.get("f"+n))}),""==s?(s="",["boot","credits","nlevel","pre1","a6","o6","a7","o7","o8","a8","a9","o9"].forEach(function(n,o){t.existsSync(e+n+".ogg")||(""==s&&(s=h.strings.get("missingOptional")),s+="\n"+n+".ogg: "+h.strings.get("f"+n))}),""!=s?new f.ScrollingText(s,"\n",function(){ne(e)}):ne(e)):new f.ScrollingText(s,"\n",function(){S.st.setState(2)})}async function ne(t){const s=require("fs");k.so.directory=t;let n=3,o=!1;for(;!o;)s.existsSync(t+n+"music.ogg")?n++:(n--,o=!0);console.log("music levels"+n);let r=[];if(s.existsSync(t+"bpm.txt")){let e=s.readFileSync(t+"bpm.txt","utf8");""==(r=e.split(","))[r.length-1]&&r.splice(r.length-1,1)}else r.push("0");let a="";for(let e=0;e<r.length;e++)a+=r[e]+",";console.log(a),k.so.directory="./sounds/",console.log("levels"+r.length);let c=[];c.push(new i.MenuItem(-2,h.strings.get("mPackTut"))),c.push(new i.MenuItem(0,h.strings.get("startOver")));let u=!1;n>r.length-1&&c.push(new i.MenuItem(-3,h.strings.get("contPack",[r.length])));for(let e=1;e<r.length;e++)c.push(new i.MenuItem(e,h.strings.get("level",[e])));c.push(new i.MenuItem(-1,h.strings.get("mBack")));let d=-1,p=n,g=new l.Menu(h.strings.get("mSelectEdit"),c);g.run(async o=>{if(d=o.selected,g.destroy(),-1==d)return void S.st.setState(2);if(-2==d)return void new f.ScrollingText(h.strings.get("packtut"),"\n",()=>{ne(t)});-3==d&&(u=!0,d=r.length,p=n),d>0&&!u&&(p=d),0==d&&d++;let a=new e.OldTimer,i=k.so.create("positive"),l=(new y.SoundHandler,[]),c=new x.KeyboardInput;c.init();let b,E=k.so.create("pbeep",!0);k.so.directory=t;let M=0,K=!1;for(let e=d;e<=p;e++){for(M=e,l=[],a.restart(),void 0!==b&&b.stop(),b=k.so.create(e+"music"),m.speech.speak(h.strings.get("level",[e])),b.loop=!0,b.volume=.5,b.play();l.length<10&&!K;){if(await v.utils.sleep(5),c.isJustPressed(w.KeyEvent.DOM_VK_ESCAPE)||c.isJustPressed(w.KeyEvent.DOM_VK_Q)){e=p+1,K=!0;break}c.isJustPressed(w.KeyEvent.DOM_VK_SPACE)&&(l.push(a.elapsed),a.restart(),E.play(),m.speech.speak(l.length))}console.log("avg"+v.utils.averageInt(l,1)),K||(r[e]=v.utils.averageInt(l,1));let t=!1;for(b.seek(0),a.restart();!t&&!K;){if(await v.utils.sleep(5),c.isJustPressed(w.KeyEvent.DOM_VK_ESCAPE)||c.isJustPressed(w.KeyEvent.DOM_VK_Q)){e=p+1,t=!0;break}if(a.elapsed>=r[e]&&(a.restart(),E.play()),c.isJustPressed(w.KeyEvent.DOM_VK_RETURN)){l=[];break}if(c.isJustPressed(w.KeyEvent.DOM_VK_SPACE)){l=[],e--;break}}}k.so.directory="./sounds/",i.play(),b.stop(),s.existsSync(t+"bpm.txt")&&s.unlinkSync(t+"bpm.txt");let P="";for(let e=0;e<r.length;e++)""!=r[e]&&(P+=r[e]+",");s.writeFileSync(t+"bpm.txt",P),i.sound.once("end",()=>{k.so.kill(()=>{S.st.setState(2)})})})}async function oe(e,t=!1){require("fs");if(void 0===I.ach&&(I.ach={}),!I.ach[e]||t){let s;I.ach[e]=e,U();let n=k.so.directory;return k.so.directory="./sounds/",void 0!==(s=k.so.create(E+"/ach"+e))&&await s.playSync(),t||await new f.ScrollingText(h.strings.get("newach",[h.strings.get("ach"+e)])),k.so.directory=n,!0}return!1}async function re(){if(void 0===I.ach&&(I.ach={}),v.utils.objSize(I.ach)<1)return await new f.ScrollingText(h.strings.get("noach")),void S.st.setState(2);let e=[];for(let t in I.ach)e.push(new i.MenuItem(I.ach[t],h.strings.get("ach"+I.ach[t])));e.push(new i.MenuItem(0,h.strings.get("mBack")));let t=new l.Menu(h.strings.get("achMenu"),e,k.so.create("ach_music")),s=!1;for(;!s;)await v.utils.sleep(8),await new Promise((e,n)=>{t.run(async n=>{if(0==n.selected)return t.destroy(),S.st.setState(2),e(),void(s=!0);await oe(n.selected,!0),e()})})}
},{"./oldtimer":4,"./minis.js":2,"./player":5,"./menuItem":6,"./menu":7,"./menuHandler":8,"./scrollingText":9,"./strings":10,"./soundHandler":11,"./tts":12,"./utilities":13,"./soundObject":14,"./keycodes":15,"./stateMachine":16,"./input.js":3}]},{},[1])
//# sourceMappingURL=/main.map